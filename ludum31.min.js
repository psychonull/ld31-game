/*! 
* Ludum31 - v0.0.1
* Copyright (c) 2014 Psychonull 
* http:// 
*/ 

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],2:[function(a,b,c){!function(){var a={},b=null,d=!0,e=!1;try{"undefined"!=typeof AudioContext?b=new AudioContext:"undefined"!=typeof webkitAudioContext?b=new webkitAudioContext:d=!1}catch(f){d=!1}if(!d)if("undefined"!=typeof Audio)try{new Audio}catch(f){e=!0}else e=!0;if(d){var g="undefined"==typeof b.createGain?b.createGainNode():b.createGain();g.gain.value=1,g.connect(b.destination)}var h=function(a){this._volume=1,this._muted=!1,this.usingWebAudio=d,this.ctx=b,this.noAudio=e,this._howls=[],this._codecs=a,this.iOSAutoEnable=!0};h.prototype={volume:function(a){var b=this;if(a=parseFloat(a),a>=0&&1>=a){b._volume=a,d&&(g.gain.value=a);for(var c in b._howls)if(b._howls.hasOwnProperty(c)&&b._howls[c]._webAudio===!1)for(var e=0;e<b._howls[c]._audioNode.length;e++)b._howls[c]._audioNode[e].volume=b._howls[c]._volume*b._volume;return b}return d?g.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,d&&(g.gain.value=a?0:b._volume);for(var c in b._howls)if(b._howls.hasOwnProperty(c)&&b._howls[c]._webAudio===!1)for(var e=0;e<b._howls[c]._audioNode.length;e++)b._howls[c]._audioNode[e].muted=a},codecs:function(a){return this._codecs[a]},_enableiOSAudio:function(){var a=this;if(!b||!a._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){a._iOSEnabled=!1;var c=function(){var d=b.createBuffer(1,1,22050),e=b.createBufferSource();e.buffer=d,e.connect(b.destination),"undefined"==typeof e.start?e.noteOn(0):e.start(0),setTimeout(function(){(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)&&(a._iOSEnabled=!0,a.iOSAutoEnable=!1,window.removeEventListener("touchstart",c,!1))},0)};return window.addEventListener("touchstart",c,!1),a}}};var i=null,j={};e||(i=new Audio,j={mp3:!!i.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var k=new h(j),l=function(a){var c=this;c._autoplay=a.autoplay||!1,c._buffer=a.buffer||!1,c._duration=a.duration||0,c._format=a.format||null,c._loop=a.loop||!1,c._loaded=!1,c._sprite=a.sprite||{},c._src=a.src||"",c._pos3d=a.pos3d||[0,0,-.5],c._volume=void 0!==a.volume?a.volume:1,c._urls=a.urls||[],c._rate=a.rate||1,c._model=a.model||null,c._onload=[a.onload||function(){}],c._onloaderror=[a.onloaderror||function(){}],c._onend=[a.onend||function(){}],c._onpause=[a.onpause||function(){}],c._onplay=[a.onplay||function(){}],c._onendTimer=[],c._webAudio=d&&!c._buffer,c._audioNode=[],c._webAudio&&c._setupAudioNode(),"undefined"!=typeof b&&b&&k.iOSAutoEnable&&k._enableiOSAudio(),k._howls.push(c),c.load()};if(l.prototype={load:function(){var a=this,b=null;if(e)return void a.on("loaderror");for(var c=0;c<a._urls.length;c++){var d,f;if(a._format)d=a._format;else{if(f=a._urls[c],d=/^data:audio\/([^;,]+);/i.exec(f),d||(d=/\.([^.]+)$/.exec(f.split("?",1)[0])),!d)return void a.on("loaderror");d=d[1].toLowerCase()}if(j[d]){b=a._urls[c];break}}if(!b)return void a.on("loaderror");if(a._src=b,a._webAudio)m(a,b);else{var g=new Audio;g.addEventListener("error",function(){g.error&&4===g.error.code&&(h.noAudio=!0),a.on("loaderror",{type:g.error?g.error.code:0})},!1),a._audioNode.push(g),g.src=b,g._pos=0,g.preload="auto",g.volume=k._muted?0:a._volume*k.volume();var i=function(){a._duration=Math.ceil(10*g.duration)/10,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play(),g.removeEventListener("canplaythrough",i,!1)};g.addEventListener("canplaythrough",i,!1),g.load()}return a},urls:function(a){var b=this;return a?(b.stop(),b._urls="string"==typeof a?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;return"function"==typeof a&&(c=a),a&&"function"!=typeof a||(a="_default"),d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f=e._pos>0?e._pos:d._sprite[a][0]/1e3,g=0;d._webAudio?(g=d._sprite[a][1]/1e3-e._pos,e._pos>0&&(f=d._sprite[a][0]/1e3+f)):g=d._sprite[a][1]/1e3-(f-d._sprite[a][0]/1e3);var h,i=!(!d._loop&&!d._sprite[a][2]),j="string"==typeof c?c:Math.round(Date.now()*Math.random())+"";if(function(){var b={id:j,sprite:a,loop:i};h=setTimeout(function(){!d._webAudio&&i&&d.stop(b.id).play(a,b.id),d._webAudio&&!i&&(d._nodeById(b.id).paused=!0,d._nodeById(b.id)._pos=0,d._clearEndTimer(b.id)),d._webAudio||i||d.stop(b.id),d.on("end",j)},1e3*g),d._onendTimer.push({timer:h,id:b.id})}(),d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=j,e.paused=!1,p(d,[i,l,m],j),d._playStart=b.currentTime,e.gain.value=d._volume,"undefined"==typeof e.bufferSource.start?e.bufferSource.noteGrainOn(0,f,g):e.bufferSource.start(0,f,g)}else{if(4!==e.readyState&&(e.readyState||!navigator.isCocoonJS))return d._clearEndTimer(j),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.readyState=4,e.id=j,e.currentTime=f,e.muted=k._muted||e.muted,e.volume=d._volume*k.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),"function"==typeof c&&c(j),d}),d):("function"==typeof c&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.pause(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=b.pos(null,a),b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else c.pause();return b.on("pause"),b},stop:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.stop(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=0,b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else isNaN(c.duration)||(c.pause(),c.currentTime=0);return b},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.muted=!0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.muted=!1),b},volume:function(a,b){var c=this;if(a=parseFloat(a),a>=0&&1>=a){if(c._volume=a,!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*k.volume()),c}return c._volume},loop:function(a){var b=this;return"boolean"==typeof a?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return"object"==typeof a?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),"number"==typeof a?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return a>=0?(d.pause(c),e._pos=a,d.play(e._sprite,c),d):d._webAudio?e._pos+(b.currentTime-d._playStart):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&4===d._audioNode[f].readyState)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;if(b="undefined"!=typeof b&&b?b:0,c="undefined"!=typeof c&&c?c:-.5,!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(!(a>=0||0>a))return e._pos3d;if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c),f.panner.panningModel=e._model||"HRTF")}return e},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;i>=k;k++)!function(){var a=f._volume+("up"===h?.01:-.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)}()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){for(var b=this,c=b._audioNode[0],d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){for(var a=this,b=null,c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){for(var b=this,c=null,d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&4===b._audioNode[d].readyState){a(b._audioNode[d]),c=!0;break}if(b._drainPool(),!c){var e;if(b._webAudio)e=b._setupAudioNode(),a(e);else{b.load(),e=b._audioNode[b._audioNode.length-1];var f=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",g=function(){e.removeEventListener(f,g,!1),a(e)};e.addEventListener(f,g,!1)}}},_drainPool:function(){var a,b=this,c=0;for(a=0;a<b._audioNode.length;a++)b._audioNode[a].paused&&c++;for(a=b._audioNode.length-1;a>=0&&!(5>=c);a--)b._audioNode[a].paused&&(b._webAudio&&b._audioNode[a].disconnect(0),c--,b._audioNode.splice(a,1))},_clearEndTimer:function(a){for(var b=this,c=0,d=0;d<b._onendTimer.length;d++)if(b._onendTimer[d].id===a){c=d;break}var e=b._onendTimer[c];e&&(clearTimeout(e.timer),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]="undefined"==typeof b.createGain?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(g),c[d].panner=b.createPanner(),c[d].panner.panningModel=a._model||"equalpower",c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if("function"==typeof b)d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){var c=this,d=c["_on"+a],e=b?b.toString():null;if(e){for(var f=0;f<d.length;f++)if(e===d[f].toString()){d.splice(f,1);break}}else c["_on"+a]=[];return c},unload:function(){for(var b=this,c=b._audioNode,d=0;d<b._audioNode.length;d++)c[d].paused||(b.stop(c[d].id),b.on("end",c[d].id)),b._webAudio?c[d].disconnect(0):c[d].src="";for(d=0;d<b._onendTimer.length;d++)clearTimeout(b._onendTimer[d].timer);var e=k._howls.indexOf(b);null!==e&&e>=0&&k._howls.splice(e,1),delete a[b._src],b=null}},d)var m=function(b,c){if(c in a)return b._duration=a[c].duration,void o(b);if(/^data:[^;]+;base64,/.test(c)){for(var d=atob(c.split(",")[1]),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);n(e.buffer,b,c)}else{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){n(g.response,b,c)},g.onerror=function(){b._webAudio&&(b._buffer=!0,b._webAudio=!1,b._audioNode=[],delete b._gainNode,delete a[c],b.load())};try{g.send()}catch(h){g.onerror()}}},n=function(c,d,e){b.decodeAudioData(c,function(b){b&&(a[e]=b,o(d,b))},function(){d.on("loaderror")})},o=function(a,b){a._duration=b?b.duration:a._duration,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},p=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:k,Howl:l}}),"undefined"!=typeof c&&(c.Howler=k,c.Howl=l),"undefined"!=typeof window&&(window.Howler=k,window.Howl=l)}()},{}],3:[function(a,b){b.exports={create:function(){var a=document.createElement("div");a.id="loading",a.className="loading",a.innerHTML='<div class="cyborg levitate"></div><div class="bar-ctn"><div id="bar">  <div id="prg"></div></div></div>',document.body.appendChild(a)},update:function(a){var b=document.getElementById("prg");b.style.width=100*a+"%"},ready:function(a,b){window.setTimeout(function(){var a=document.getElementById("loading");a.style.display="none",b()},a)}}},{}],4:[function(a,b){var c=a("./Walker"),d=a("./WalkerCommand"),e=a("./Command");b.exports=pac.Action.extend({name:"Activable",requires:[pac.actions.Hoverable,pac.actions.Clickable],init:function(a){this.nearness=a&&a.nearness||50,this.command=pac._.clone(a.command||{},!0)},onStart:function(){var a=this.actions.owner;this.floor=a.game.findOne("floor"+a.floor)},onEnd:function(){},update:function(){var a=this.actions.owner,b=!1;if(a.isClicked){if(a.isActivated){if(this.command.duration!==!0)return;b=!0}var c=a.shape.getBounds(a.position).getCenter();if(this.walker=this.floor.getWalker(c),!this.walker||this.walker&&!this.walker.active)return;if(c.x-=this.walker.shape.size.width/2,c.y=this.walker.position.y,c.subtract(this.walker.position).length()<=this.nearness)return b?void this.actions.removeAll(e):void this.actions.pushFront(new e(this.command));this._walkToObject(c,b)}},_walkToObject:function(a,b){if(!this.actions.has(d)){var e;this.walker.actions.each(function(a){return a instanceof c?(e=a,!1):void 0}),e&&(this.walker.actions.removeAll(pac.actions.WalkTo).insertAfter(new pac.actions.WalkTo({velocity:e.velocity,target:a,nearness:this.nearness}),e),this.actions.pushFront(new d(this.walker,this.command,b)))}}})},{"./Command":5,"./Walker":8,"./WalkerCommand":9}],5:[function(a,b){b.exports=pac.Action.extend({name:"Command",init:function(a){a=a||{},this.env=a.env||{},this.state=a.state||{},this.animation=a.animation||null,this.duration=a.duration||0,this.changeInterval=a.changeInterval||0,this.interval=this.changeInterval,this.elapsed=0},onStart:function(){var a=this.actions.owner;this.floor=a.game.findOne("floor"+a.floor),this.animation&&(this.animateAction&&this.actions._endAction(this.animateAction,!0),this.animateAction=new pac.actions.Animate(this.animation),this.actions.pushFront(this.animateAction)),pac._.forIn(this.env,function(b,c){a.game.env[c]||(a.game.env[c]=0),a.game.env[c]+=b},this),a.isActivated=!0,this.floor.onActivateObject(a)},onEnd:function(){var a=this.actions.owner;pac._.forIn(this.env,function(b,c){a.game.env[c]-=b,(!a.game.env[c]||a.game.env[c]<0)&&(a.game.env[c]=0)},this),this.animateAction&&(this.actions._endAction(this.animateAction,!0),this.animateAction=null,a.animations._playDefault()),a.isActivated=!1,this.floor.onDeactivateObject(a)},update:function(a){var b=this.actions.owner;this.elapsed+=a,this.interval+=a,this.interval>=this.changeInterval&&(this.floor.stats.mind+=this.state.mind||0,this.floor.stats.body+=this.state.body||0,this.interval=0),this.duration!==!0&&(b.commandRemainingTime=this.duration-this.elapsed),this.duration!==!0&&this.elapsed>=this.duration&&(this.isFinished=!0,b.commandRemainingTime=null)}})},{}],6:[function(a,b){b.exports=pac.Action.extend({name:"Living",init:function(a,b){this.lose=a,this.time=b,this.elapsed=0},onStart:function(){},onEnd:function(){},update:function(a){if(this.elapsed+=a,this.elapsed>=this.time){var b=this.actions.owner;b.stats.mind+=this.lose.mind,b.stats.body+=this.lose.body;var c=b.game.env;pac._.forIn(b.env,function(a,d){b.stats.mind+=a.mind*(c[d]||0),b.stats.body+=a.body*(c[d]||0)}),b.stats.mind=b.stats.mind>1?1:b.stats.mind,b.stats.mind=b.stats.mind<0?0:b.stats.mind,b.stats.body=b.stats.body>1?1:b.stats.body,b.stats.body=b.stats.body<0?0:b.stats.body,this.elapsed=0}}})},{}],7:[function(a,b){var c=a("../prefabs/VerticalMenu.js"),d=a("./Activable.js");b.exports=pac.Action.extend({name:"MenuCommander",requires:[pac.actions.Clickable],init:function(a){this.options=a},onStart:function(){var a=this.actions.owner;this.floor=a.game.findOne("floor"+a.floor)},onEnd:function(){},update:function(){var a=this.actions.owner;this.menu&&this.menu.menuOptionSelected()?(a.actions.pushFront(new d({command:{env:{music:.1,tv:.1},state:{mind:-.01,body:.05},duration:2,changeInterval:.5},nearness:50})),a.scene.removeObject(this.menu),this.menu=null):a.isClicked&&(this.menu=new c,a.scene.addObject(this.menu),this.menu.createMenu({menuOptions:[{text:"funciona"},{text:"bien"}],position:new pac.Point(this.options.position.x,this.options.position.y),size:{width:100,height:100}}))}})},{"../prefabs/VerticalMenu.js":47,"./Activable.js":4}],8:[function(a,b){b.exports=pac.Action.extend({name:"Walker",init:function(a){this.velocity=a&&a.velocity||10,this.feet=a&&a.feet||null,this.doOnNextTick=!1},onStart:function(){var a=this.actions.owner;this.floor=a.game.findOne("floor"+a.floor),this.bounds={min:this.floor.position.x,max:this.floor.position.x+this.floor.size.width},this.floor.walkers.add(a)},onEnd:function(){this.floor.walkers.remove(this.actions.owner)},_getTarget:function(){var a=this.actions.owner,b=a.game.inputs.cursor.position,c=new pac.Point(b.x,a.position.y),d=a.shape.size.width,e=d/2;return c.x-=e,c.x+d>this.bounds.max&&(c.x=this.bounds.max-d),c.x<this.bounds.min&&(c.x=this.bounds.min),c},update:function(){var a=this.actions.owner;if(this.floor.isClicked&&a.active){if(this.floor.walkers.length>1){var b=this.floor.getWalker(this._getTarget());if(a.cid!==b.cid)return}return this.actions.removeAll(pac.actions.WalkTo),void(this.doOnNextTick=!0)}this.doOnNextTick&&(this.doOnNextTick=!1,this.insertBehindMe(new pac.actions.WalkTo({velocity:this.velocity,target:this._getTarget()})))}})},{}],9:[function(a,b){var c=a("./Command");b.exports=pac.Action.extend({name:"WalkerCommand",init:function(a,b,c){this.walker=a,this.command=b,this.isTurnOff=c},onStart:function(){},onEnd:function(){},update:function(){this.walker.targetReached&&(this.isTurnOff?this.actions.removeAll(c):this.insertBehindMe(new c(this.command))),this.walker.walkingTo||(this.isFinished=!0)}})},{"./Command":5}],10:[function(a,b){b.exports={Walker:a("./Walker"),Living:a("./Living"),MenuCommander:a("./MenuCommander"),Activable:a("./Activable"),Command:a("./Command")}},{"./Activable":4,"./Command":5,"./Living":6,"./MenuCommander":7,"./Walker":8}],11:[function(a,b){b.exports={walkRight:new pac.Animation({fps:6,frames:["right1","right2","right3","right4","right5","right6"]}),walkLeft:new pac.Animation({fps:6,frames:["left1","left2","left3","left4","left5","left6"]}),idleRight:new pac.Animation({fps:3,frames:["idle1","idle3","idle3"]}),idleLeft:new pac.Animation({fps:2,frames:["idle4","idle5","idle6"]})}},{}],12:[function(a,b){b.exports={walkRightBoy:new pac.Animation({fps:6,frames:["right1","right2","right3","right4","right5","right6"]}),walkLeftBoy:new pac.Animation({fps:6,frames:["left1","left2","left3","left4","left5","left6"]}),idleRightBoy:new pac.Animation({fps:3,frames:["idle1","idle3","idle3"]}),idleLeftBoy:new pac.Animation({fps:2,frames:["idle4","idle5","idle6"]})}},{}],13:[function(a,b){b.exports={walkRightGirl:new pac.Animation({fps:6,frames:["right1","right2","right3","right4","right5","right6"]}),walkLeftGirl:new pac.Animation({fps:6,frames:["left1","left2","left3","left4","left5","left6"]}),idleRightGirl:new pac.Animation({fps:3,frames:["idle1","idle3","idle3"]}),idleLeftGirl:new pac.Animation({fps:2,frames:["idle4","idle5","idle6"]})}},{}],14:[function(a,b){b.exports={walkRight:new pac.Animation({fps:8,frames:["right1","right2","right3","right4","right5","right6","right7","right8"]}),walkLeft:new pac.Animation({fps:8,frames:["left1","left2","left3","left4","left5","left6","left7","left8"]}),idleLeft:new pac.Animation({fps:2,frames:["idle1","idle2","idle3"]}),idleRight:new pac.Animation({fps:2,frames:["idle4","idle5","idle6"]})}},{}],15:[function(a,b){b.exports={waterOn:new pac.Animation({fps:2,frames:["water_on_0","water_on_1","water_on_2","water_on_3","water_on_4"]})}},{}],16:[function(a,b){b.exports={bedOn:new pac.Animation({fps:1,frames:["cama_on_1","cama_on_0","cama_on_0"]}),bedOff:new pac.Animation({fps:1,frames:["cama"]}),bedHover:new pac.Animation({fps:1,frames:["cama_hover"]})}},{}],17:[function(a,b){b.exports={grandmaBroomOn:new pac.Animation({fps:6,frames:["grandma_broom_on_1","grandma_broom_on_0","grandma_broom_on_1"]}),grandmaBroomOff:new pac.Animation({fps:1,frames:["grandma_broom"]}),grandmaBroomHover:new pac.Animation({fps:1,frames:["grandma_broom_hover"]})}},{}],18:[function(a,b){b.exports={grandmaShowerOn:new pac.Animation({fps:10,frames:["grandma_shower_on_1","grandma_shower_on_0","grandma_shower_on_1"]}),grandmaShowerOff:new pac.Animation({fps:1,frames:["grandma_shower"]}),grandmaShowerHover:new pac.Animation({fps:1,frames:["grandma_shower_hover"]})}},{}],19:[function(a,b){b.exports={tv:a("./tv"),bed:a("./bed"),kitchen:a("./kitchen"),grandmaShower:a("./grandmaShower"),grandmaBroom:a("./grandmaBroom")}},{"./bed":16,"./grandmaBroom":17,"./grandmaShower":18,"./kitchen":20,"./tv":21}],20:[function(a,b){b.exports={kitchenOn:new pac.Animation({fps:5,frames:["cocina_on_0","cocina_on_1","cocina_on_2"]}),kitchenOff:new pac.Animation({fps:1,frames:["cocina"]}),kitchenHover:new pac.Animation({fps:1,frames:["cocina_hover"]})}},{}],21:[function(a,b){b.exports={tvOn:new pac.Animation({fps:6,frames:["tv_on_0","tv_on_1","tv_on_1"]}),tvOff:new pac.Animation({fps:1,frames:["tv"]}),tvHover:new pac.Animation({fps:1,frames:["tv_hover"]})}},{}],22:[function(a,b){b.exports={dudeBedOn:new pac.Animation({fps:1,frames:["dude_bed_on_1","dude_bed_on_0","dude_bed_on_1"]}),dudeBedOff:new pac.Animation({fps:1,frames:["dude_bed"]}),dudeBedHover:new pac.Animation({fps:1,frames:["dude_bed_hover"]})}},{}],23:[function(a,b){b.exports={dudeOvenOn:new pac.Animation({fps:10,frames:["dude_oven_on_1","dude_oven_on_0","dude_oven_on_1"]}),dudeOvenOff:new pac.Animation({fps:1,frames:["dude_oven"]}),dudeOvenHover:new pac.Animation({fps:1,frames:["dude_oven_hover"]})}},{}],24:[function(a,b){b.exports={dudeShowerOn:new pac.Animation({fps:10,frames:["dude_shower_on_1","dude_shower_on_0","dude_shower_on_1"]}),dudeShowerOff:new pac.Animation({fps:1,frames:["dude_shower"]}),dudeShowerHover:new pac.Animation({fps:1,frames:["dude_shower_hover"]})}},{}],25:[function(a,b){b.exports={dudeStereoOn:new pac.Animation({fps:10,frames:["dude_stereo_on_1","dude_stereo_on_0","dude_stereo_on_1"]}),dudeStereoOff:new pac.Animation({fps:1,frames:["dude_stereo"]}),dudeStereoHover:new pac.Animation({fps:1,frames:["dude_stereo_hover"]})}},{}],26:[function(a,b){b.exports={bedDude:a("./bedDude"),dudeStereo:a("./dudeStereo"),dudeOven:a("./dudeOven"),dudeShower:a("./dudeShower")}},{"./bedDude":22,"./dudeOven":23,"./dudeShower":24,"./dudeStereo":25}],27:[function(a,b){b.exports={babyOn:new pac.Animation({fps:10,frames:["baby_on_1","baby_on_0","baby_on_1"]}),babyOff:new pac.Animation({fps:1,frames:["baby"]}),babyHover:new pac.Animation({fps:1,frames:["baby_hover"]})}},{}],28:[function(a,b){b.exports={familyBedOn:new pac.Animation({fps:1,frames:["family_bed_on_1","family_bed_on_0","family_bed_on_1"]}),familyBedOff:new pac.Animation({fps:1,frames:["family_bed"]}),familyBedHover:new pac.Animation({fps:1,frames:["family_bed_hover"]})}},{}],29:[function(a,b){b.exports={familyKitchenOn:new pac.Animation({fps:5,frames:["family_kitchen_on_0","family_kitchen_on_1","family_kitchen_on_2"]}),familyKitchenOff:new pac.Animation({fps:1,frames:["family_kitchen"]}),familyKitchenHover:new pac.Animation({fps:1,frames:["family_kitchen_hover"]})}},{}],30:[function(a,b){b.exports={familyShowerOn:new pac.Animation({fps:10,frames:["family_shower_on_1","family_shower_on_0","family_shower_on_1"]}),familyShowerOff:new pac.Animation({fps:1,frames:["family_shower"]}),familyShowerHover:new pac.Animation({fps:1,frames:["family_shower_hover"]})}},{}],31:[function(a,b){b.exports={bedFamily:a("./bedFamily"),baby:a("./baby"),familyKitchen:a("./familyKitchen"),familyShower:a("./familyShower")}},{"./baby":27,"./bedFamily":28,"./familyKitchen":29,"./familyShower":30}],32:[function(a,b){b.exports={GrandMa:a("./GrandMa"),Dude:a("./Dude"),FamilyBoy:a("./FamilyBoy"),FamilyGirl:a("./FamilyGirl"),floor1:a("./floor1"),floor2:a("./floor2"),floor3:a("./floor3"),Water:a("./Water")}},{"./Dude":11,"./FamilyBoy":12,"./FamilyGirl":13,"./GrandMa":14,"./Water":15,"./floor1":19,"./floor2":26,"./floor3":31}],33:[function(a,b){var c={lucas:{texture:"assets/fonts/lucas/lucas.png",definition:"assets/fonts/lucas/font.json",type:"bitmapFont"},lucaswhite:{texture:"assets/fonts/lucaswhite/lucaswhite.png",definition:"assets/fonts/lucaswhite/font.json",type:"bitmapFont"}},d={back_building:"assets/img/back_building.png",grandma:{path:"assets/img/chars/grandma.png",atlas:"assets/img/chars/grandma.json"},dude:{path:"assets/img/chars/dude.png",atlas:"assets/img/chars/dude.json"},familyboy:{path:"assets/img/chars/familyboy.png",atlas:"assets/img/chars/familyboy.json"},familygirl:{path:"assets/img/chars/familygirl.png",atlas:"assets/img/chars/familygirl.json"},characterCard:{path:"assets/img/characterCards.png",atlas:"assets/img/characterCards.json"},infoIcon:{path:"assets/img/info_icon.png"},some_object:{path:"assets/img/chars/grandma.png",atlas:"assets/img/chars/grandma.json"},granma_tv:{path:"assets/img/granma/granma_tv.png",atlas:"assets/img/granma/granma_tv.json"},granma_bed:{path:"assets/img/granma/granma_bed.png",atlas:"assets/img/granma/granma_bed.json"},granma_kitchen:{path:"assets/img/granma/granma_kitchen.png",atlas:"assets/img/granma/granma_kitchen.json"},granma_food:{path:"assets/img/granma/granma_food.png",atlas:"assets/img/granma/granma_food.json"},grandma_shower:{path:"assets/img/granma/grandma_shower.png",atlas:"assets/img/granma/grandma_shower.json"},grandma_water:{path:"assets/img/water.png",atlas:"assets/img/water.json"},grandma_broom:{path:"assets/img/granma/grandma_broom.png",atlas:"assets/img/granma/grandma_broom.json"},dude_bed:{path:"assets/img/dude/dude_bed.png",atlas:"assets/img/dude/dude_bed.json"},dude_stereo:{path:"assets/img/dude/dude_stereo.png",atlas:"assets/img/dude/dude_stereo.json"},dude_oven:{path:"assets/img/dude/dude_oven.png",atlas:"assets/img/dude/dude_oven.json"},dude_food:{path:"assets/img/dude/dude_food.png",atlas:"assets/img/dude/dude_food.json"},dude_shower:{path:"assets/img/dude/dude_shower.png",atlas:"assets/img/dude/dude_shower.json"},dude_water:{path:"assets/img/water.png",atlas:"assets/img/water.json"},family_bed:{path:"assets/img/family/family_bed.png",atlas:"assets/img/family/family_bed.json"},baby:{path:"assets/img/family/baby.png",atlas:"assets/img/family/baby.json"},family_kitchen:{path:"assets/img/family/family_kitchen.png",atlas:"assets/img/family/family_kitchen.json"},family_shower:{path:"assets/img/family/family_shower.png",atlas:"assets/img/family/family_shower.json"},family_food:{path:"assets/img/family/family_food.png",atlas:"assets/img/family/family_food.json"}};b.exports=pac._.merge(c,d)},{}],34:[function(a,b){var c=a("./prefabs/CharacterCard.js"),d=pac._;b.exports=function(){this.env={};var a=new c({frame:"family",caption:"Family",avatarFrame:"family_pic",position:{x:932,y:0},popup:{title:"Family",content:"They like to chill, thought order and homeworks come first.\n Lil guy is growing up and demanding tons of love.",footer:""},mentalDisasterTextValue:d.sample(["EXHAUSTED"]),bodyProblemsTextValue:d.sample(["EXHAUSTED"])}),b=new c({frame:"dude",avatarFrame:"dude_pic",caption:"Richard McWeed",position:{x:932,y:200},popup:{title:"Richard McWeed",content:"He is in a constant search of fun and the meaning of the life, withouth worrying too much.",footer:""},mentalDisasterTextValue:d.sample(["FRIED"]),bodyProblemsTextValue:d.sample(["UNHEALTHY"])}),e=new c({frame:"granma",avatarFrame:"granma_pic",caption:"Grandma Dorothy",position:{x:932,y:400},popup:{title:"Grandma Dorothy",content:"She is an aged conservative girl who likes to keep things in perfect order. She is cool after all, but...",footer:""},mentalDisasterTextValue:d.sample(["INSANE"]),bodyProblemsTextValue:d.sample(["WRECKED"])});
this.familyCard=a,this.dudeCard=b,this.granmaCard=e,this.addObject([a,b,e])}},{"./prefabs/CharacterCard.js":38}],35:[function(a,b){b.exports=function(a){function b(){"polygon-offset"===h&&console.log("offset: "+i.x+","+i.y);var a="new ";a+="pac.Polygon([",j.forEach(function(b,c){c>0&&(a+=","),a+=b.x+","+b.y}),a+="])",console.log(a),j=[],i=null,h=null,e.style.color="white",f.style.color="white"}var c=document.getElementById("editor");c.style.display="";var d=document.getElementById("pos"),e=document.getElementById("polygon"),f=document.getElementById("polygon-offset"),g=document.getElementById("done"),h=null,i=null,j=[];g.addEventListener("click",function(){b()}),e.addEventListener("click",function(){b(),h="polygon",e.style.color="yellow"}),f.addEventListener("click",function(){b(),h="polygon-offset",f.style.color="yellow"}),a.on("update",function(){var b=a.inputs.cursor.position;if(d.innerText=b.x+" : "+b.y,h&&this.inputs.cursor.isDown){if("polygon-offset"===h&&!i)return void(i=b);j.push(i?b.subtract(i):b)}})}},{}],36:[function(a){var b=a("./Loading.js"),c=a("./scenes"),d=a("./scenes/Stats");window.pac=a("../../pac/src/"),window.document.title+=" [pac  v"+pac.VERSION+"]",pac.DEBUG=!1;var e=window.document.getElementById("content"),f={width:1067,height:600},g=pac.create(),h=Math.min(e.clientWidth/f.width,e.clientHeight/f.height);g.stats=d,g.use("loader",pac.Loader,a("./assets.js")),g.use("renderer",pac.PixiRenderer,{container:e,backgroundColor:"#00FF00",size:f,scale:h,layers:["background","objects","front","gui","overlay"]}),g.use("input",pac.MouseInput,{enabled:!0,scale:h}),g.use("scenes",{oneScreen:new c.OneScreen,reset:new c.Reset}),g.loader.on("progress",b.update),g.loader.on("complete",function(){b.update(1),b.ready(100,function(){g.start("oneScreen")})}),g.on("ready",a("./createGameObjects.js")),g.sounds=a("./soundManager.js"),pac.DEBUG&&window.addEventListener("load",function(){a("./editor")(g)}),b.create(),g.loader.load(),window.game=g},{"../../pac/src/":133,"./Loading.js":3,"./assets.js":33,"./createGameObjects.js":34,"./editor":35,"./scenes":62,"./scenes/Stats":54,"./soundManager.js":64}],37:[function(a,b){b.exports=pac.Sprite.extend({layer:"objects",zIndex:50,shape:!0,size:{width:100,height:100},walkAnim:null,init:function(a){this.floor=a&&a.floor||this.floor,this.walkAnim=pac._.defaults(a.walkAnim||this.walkAnim,{idleLeft:"idle",idleRight:"idle",walkLeft:"walkLeft",walkRight:"walkRight"}),this.wasWalking=!1,this.doOnNextTick=!1},update:function(){this.walkingTo?(this.wasWalking=!0,this.walkingTo.x>=0?(this.animations.play(this.walkAnim.walkRight),this.lastSide="Right"):(this.animations.play(this.walkAnim.walkLeft),this.lastSide="Left")):this.wasWalking&&this.doOnNextTick?(this.doOnNextTick=!1,this.animations.play(this.walkAnim["idle"+this.lastSide])):this.doOnNextTick=!0}})},{}],38:[function(a,b){var c=pac._,d=a("./PopUpContainer.js");b.exports=pac.Sprite.extend({texture:"characterCard",layer:"gui",size:{width:135,height:200},caption:"N/A",barWidth:120,mind:1,body:1,mentalDisaster:!1,bodyProblems:!1,mentalDisasterTextValue:"WRECKED",bodyProblemsTextValue:"BROKEN DOWN",disabled:!1,popup:{title:"",content:"",footer:""},init:function(a){this.caption=a&&a.caption||this.caption,this.mind=a&&a.mind||this.mind,this.body=a&&a.body||this.body,this.popup=a&&a.popup||this.popup,this.mentalDisasterTextValue=a&&a.mentalDisasterTextValue||this.mentalDisasterTextValue,this.bodyProblemsTextValue=a&&a.bodyProblemsTextValue||this.bodyProblemsTextValue,a.avatarFrame&&(this.avatar=new pac.Sprite({texture:"characterCard",frame:a.avatarFrame,layer:"gui",size:{width:125,height:80},position:{x:5,y:5}}),this.children.add(this.avatar)),this.captionText=new pac.Text({value:this.caption,font:"12px lucaswhite",isBitmapText:!0,wordWrap:130,position:{x:5,y:90}}),this.infoIcon=new pac.Sprite({texture:"infoIcon",layer:"gui",size:{width:15,height:15},actions:[new pac.actions.Clickable],shape:new pac.Rectangle({size:{width:15,height:15}}),position:{x:110,y:90}});var b=new pac.Text({value:"Mind",font:"8px lucaswhite",isBitmapText:!0,wordWrap:130,position:{x:5,y:120}}),e=new pac.Text({value:"Body",font:"8px lucaswhite",isBitmapText:!0,wordWrap:130,position:{x:5,y:160}});this.mentalDisasterText=new pac.Text({value:this.mentalDisasterTextValue,font:"10px lucaswhite",isBitmapText:!0,wordWrap:this.barWidth,position:{x:7,y:135},visible:!1}),this.bodyProblemsText=new pac.Text({value:this.bodyProblemsTextValue,font:"10px lucaswhite",isBitmapText:!0,wordWrap:this.barWidth,position:{x:7,y:175},visible:!1}),this.mindBar=new pac.Rectangle({size:{width:this.barWidth,height:20},fill:"#00FF00",position:{x:5,y:133}}),this.bodyBar=new pac.Rectangle({size:{width:this.barWidth,height:20},fill:"#00FF00",position:{x:5,y:173}});var f=this;this.infoIcon.on("click",function(){var a=new d({zIndex:1,layer:"modals",actions:[new pac.actions.Clickable],shape:new pac.Rectangle({size:{width:1067,height:600}})});this.game.addObject(a),a.createModal(new pac.Point(this.position.x,this.position.y),{orientation:"left",title:f.popup.title,content:f.popup.content,footer:f.popup.footer,size:{width:400,height:200}}),a.on("click",function(){this.game.removeObject(a.popUpControl).removeObject(a),a.removeAllListeners("click")})}),this.disabledOverlay=new pac.Rectangle({size:c.clone(this.size),position:this.position.clone(),layer:"overlay",fill:"#000000",alpha:.7,zIndex:100,visible:!1}),this.children.add(this.captionText),this.children.add(b),this.children.add(e),this.children.add(this.mindBar),this.children.add(this.bodyBar),this.children.add(this.mentalDisasterText),this.children.add(this.bodyProblemsText),this.children.add(this.infoIcon)},update:function(){if(this.mentalDisaster&&this.bodyProblems){if(this.disabled)return;this.disabledOverlay.visible=!0,this.game.addObject(this.disabledOverlay),this.disabled=!0}this.mentalDisaster?(this.mindBar.size.width=this.barWidth,this.mindBar.fill="#FF0000",this.mentalDisasterText.visible=!0):(this.mind=Math.min(Math.max(0,this.mind),1),this.mindBar.size.width=this.mind*this.barWidth,0===this.mind&&(this.mentalDisaster=!0)),this.bodyProblems?(this.bodyBar.size.width=this.barWidth,this.bodyBar.fill="#FF0000",this.bodyProblemsText.visible=!0):(this.body=Math.min(Math.max(0,this.body),1),this.bodyBar.size.width=this.body*this.barWidth,0===this.body&&(this.bodyProblems=!0))}})},{"./PopUpContainer.js":46}],39:[function(a,b){var c=a("../animations"),d=a("../actions"),e=a("./Character"),f=b.exports=e.extend({texture:"dude",animations:new pac.AnimationList(c.Dude,{"default":"idleLeft",autoplay:!0}),actions:[new d.Walker({velocity:50})],walkAnim:{idleLeft:"idleLeft",idleRight:"idleRight",walkLeft:"walkLeft",walkRight:"walkRight"},init:function(a){this.constructor.__super__.init.call(this,a),this.actions.pushFront(new pac.actions.Speaker({textOptions:{font:"12px lucas",isBitmapText:!0,wordWrap:"220",wrapToScreen:!1,tint:1175057},offset:new pac.Point(0,-20),smartPosition:!1}))},update:function(){f.__super__.update.apply(this,arguments)}})},{"../actions":10,"../animations":32,"./Character":37}],40:[function(a,b){var c=a("../animations"),d=a("../actions"),e=a("./Character"),f=b.exports=e.extend({texture:"familyboy",animations:new pac.AnimationList(c.FamilyBoy,{"default":"idleLeftBoy",autoplay:!0}),actions:[new d.Walker({velocity:50})],walkAnim:{idleLeft:"idleLeftBoy",idleRight:"idleRightBoy",walkLeft:"walkLeftBoy",walkRight:"walkRightBoy"},init:function(a){this.constructor.__super__.init.call(this,a),this.actions.pushFront(new pac.actions.Speaker({textOptions:{font:"12px lucas",isBitmapText:!0,wordWrap:"220",wrapToScreen:!1,tint:1118702},offset:new pac.Point(0,-20),smartPosition:!1}))},update:function(){f.__super__.update.apply(this,arguments)}})},{"../actions":10,"../animations":32,"./Character":37}],41:[function(a,b){var c=a("../animations"),d=a("../actions"),e=a("./Character"),f=b.exports=e.extend({texture:"familygirl",animations:new pac.AnimationList(c.FamilyGirl,{"default":"idleLeftGirl",autoplay:!0}),actions:[new d.Walker({velocity:50})],walkAnim:{idleLeft:"idleLeftGirl",idleRight:"idleRightGirl",walkLeft:"walkLeftGirl",walkRight:"walkRightGirl"},init:function(a){this.constructor.__super__.init.call(this,a),this.actions.pushFront(new pac.actions.Speaker({textOptions:{font:"12px lucas",isBitmapText:!0,wordWrap:"220",wrapToScreen:!1,tint:15601937},offset:new pac.Point(0,-20),smartPosition:!1}))},update:function(){f.__super__.update.apply(this,arguments)}})},{"../actions":10,"../animations":32,"./Character":37}],42:[function(a,b){var c=a("../actions"),d={width:908,height:183};b.exports=function(a,b){return pac.Rectangle.extend({layer:"background",zIndex:0,shape:new pac.Rectangle({size:pac._.clone(d)}),size:pac._.clone(d),actions:[new pac.actions.Clickable,new c.Living(a.living,b)],start:null,env:null,floor:0,disabled:!1,init:function(a){this.walkers=new pac.List,this.stats=a&&a.stats||this.stats,this.env=a&&a.env||this.env,this.floor=a&&a.floor||this.floor},update:function(){switch(this.floor){case 1:this.checkCharacterCard(this.game.granmaCard);break;case 2:this.checkCharacterCard(this.game.dudeCard);break;case 3:this.checkCharacterCard(this.game.familyCard)}},checkCharacterCard:function(a){a.mind=this.stats.mind,a.body=this.stats.body,a.mentalDisaster&&!this.lostMind&&(this.onLostMind(),this.lostMind=!0),a.bodyProblems&&!this.lostBody&&(this.onLostBody(),this.lostBody=!0)},disable:function(){this.scene.objects.find({floor:this.floor}).each(function(a){a.active=!1}),this.walkers.each(function(a){a.visible=!1});var a=new pac.Rectangle({size:pac._.clone(d),position:this.position.clone().subtract(0,1),layer:"overlay",fill:"#000000",alpha:.7});this.game.addObject(a),this.disabled=!0},getWalker:function(a){if(1===this.walkers.length)return this.walkers.at(0);if(this.walkers.length>1){var b={index:-1,len:Number.POSITIVE_INFINITY};return this.walkers.each(function(c,d){var e=c.position.subtract(a).length();e<b.len&&(b.len=e,b.index=d)}),b.index>-1?this.walkers.at(b.index):null}return null}})}},{"../actions":10}],43:[function(a,b){var c=a("../animations"),d=a("../actions"),e=a("./Character"),f=b.exports=e.extend({texture:"grandma",animations:new pac.AnimationList(c.GrandMa,{"default":"idleLeft",autoplay:!0}),actions:[new d.Walker({velocity:50})],walkAnim:{idleLeft:"idleLeft",idleRight:"idleRight",walkLeft:"walkLeft",walkRight:"walkRight"},init:function(a){this.constructor.__super__.init.call(this,a),this.actions.pushFront(new pac.actions.Speaker({textOptions:{font:"12px lucas",isBitmapText:!0,wordWrap:"220",wrapToScreen:!1,tint:11141290},offset:new pac.Point(0,-20),smartPosition:!1}))},update:function(){f.__super__.update.apply(this,arguments)}})},{"../actions":10,"../animations":32,"./Character":37}],44:[function(a,b){var c=pac._,d=pac.Sprite.extend({layer:"objects",zIndex:10,shape:!0,size:{width:50,height:50},floor:1,actions:[],init:function(a){this.floor=a&&a.floor||this.floor,this.frameHover=a&&a.frameHover||this.frameHover,this.caption=a&&a.caption||this.caption||this.name,c.isArray(this.caption)||(this.caption=[this.caption]),this.frameHover&&this.texture&&this.createHover(),this.actions.pushFront(new pac.actions.Speaker({textOptions:{font:"10px lucas",isBitmapText:!0,wordWrap:"200",wrapToScreen:!1,visible:!1},offset:a&&a.captionOffset||new pac.Point(0,-10),smartPosition:!1}))},createHover:function(){this.hoverChild=new pac.Sprite({texture:this.texture,frame:this.frameHover,size:pac._.clone(this.size),visible:!1}),this.children.add(this.hoverChild)},update:function(){this._hover(),this.commandRemainingTime&&(this.speakerText.value="")},_hover:function(){this.hoverChild&&(this.speakerText.value=this.caption[this.isActivated?1:0]||this.caption[0],this.isHover&&!this.hoverChild.visible?(this.hoverChild.visible=!0,this.speakerText.visible=!0):!this.isHover&&this.hoverChild.visible&&(this.hoverChild.visible=!1,this.speakerText.visible=!1,this.speakerText.value=""))}});b.exports=d},{}],45:[function(a,b){b.exports=pac.Rectangle.extend({layer:"modals",visibe:!0,size:{width:400,height:200},fill:"#4f4f4f",content:"Content",orientation:"right",init:function(a){this.layer=a&&a.layer||this.layer,this.content=a&&a.content||this.content,this.orientation=a&&a.orientation||this.orientation,"left"===this.orientation?this.position.x=a.position.x-this.size.width:"right"===this.orientation&&(this.position.x=a.position.x),this.position.y=a.position.y,!a.titleObject&&a.title&&(a.titleObject=new pac.Text({value:a.title,font:"20px lucaswhite",isBitmapText:!0,wordWrap:380,position:{x:10,y:10}})),a.contentObject||(a.contentObject=[new pac.Text({value:this.content,font:"12px lucaswhite",isBitmapText:!0,wordWrap:380,position:{x:10,y:50}})]),!a.contentFooter&&a.footer&&(a.contentFooter=new pac.Text({value:a.footer,font:"6px lucaswhite",isBitmapText:!0,wordWrap:380,position:{x:10,y:180}})),a.titleObject&&this.children.add(a.titleObject),this.children.add(a.contentObject),a.contentFooter&&this.children.add(a.contentFooter)},update:function(){}})},{}],46:[function(a,b){var c=a("./PopUp.js");b.exports=pac.Rectangle.extend({layer:"modals",visibe:!1,position:{x:0,y:0},size:{width:1067,height:600},zIndex:1,update:function(){},createModal:function(a,b){this.popUpControl=new c({orientation:b.orientation,layer:"modals",zIndex:1e3,title:b.title,content:b.content,contentObject:b.contentObject,footer:b.footer,size:{width:b.size.width,height:b.size.height},actions:[new pac.actions.Clickable],shape:new pac.Rectangle({size:{width:b.size.width,height:b.size.height}}),position:a,visibe:!1}),this.game.addObject(this.popUpControl)},createModalMenu:function(a,b){this.popUpControl=new c({orientation:b.orientation,layer:"modals",zIndex:1e3,title:b.title,content:b.content,contentObject:b.contentObject,footer:b.footer,size:{width:b.size.width,height:b.size.height},position:a}),this.game.addObject(this.popUpControl)}})},{"./PopUp.js":45}],47:[function(a,b){{var c=a("./PopUpContainer.js");a("../actions/Activable.js")}b.exports=pac.GameObject.extend({layer:"gui",visible:!1,size:{width:100,height:200},optionsArray:[],init:function(){},createMenu:function(a){var b=new c({zIndex:1,layer:"modals"});this.game.addObject(b),this.optionsArray=this.createMenuContent(a.menuOptions),b.createModalMenu(new pac.Point(a.position.x,a.position.y),{contentObject:this.optionsArray,size:{width:a.size.width,height:a.size.height}})},createMenuContent:function(){function a(a){console.log(this.selected),console.log(this.selected),this.selected=this.optionsArray[a].value}for(var b=[],c=20,d=0;d<this.optionsArray.length;d++){var e=new pac.Text({value:this.optionsArray[d].text,font:"12px lucaswhite",isBitmapText:!0,wordWrap:150,actions:[new pac.actions.Clickable],shape:new pac.Rectangle({size:{width:100,height:20},fill:"#4f4f4f",visible:!0}),position:new pac.Point(0,0+c)});e.on("click",a.bind(this,d)),this.optionsArray[d].push(e),c+=50}return b},update:function(){},menuOptionSelected:function(){return this.selected}})},{"../actions/Activable.js":4,"./PopUpContainer.js":46}],48:[function(a,b){b.exports={Floor:a("./Floor"),GrandMa:a("./GrandMa"),Dude:a("./Dude"),FamilyBoy:a("./FamilyBoy"),FamilyGirl:a("./FamilyGirl"),VerticalMenu:a("./VerticalMenu")}},{"./Dude":39,"./FamilyBoy":40,"./FamilyGirl":41,"./Floor":42,"./GrandMa":43,"./VerticalMenu":47}],49:[function(a,b){var c=a("../prefabs"),d=(a("../actions"),a("../prefabs/InteractiveObject.js"));b.exports=function(b,e){var f=b.getFeet(),g=new c.GrandMa({floor:1}),h=g.shape.getBounds().getFeet();g.position=f.subtract(h),e.addObject(g);var i=a("./floor1Objects")(b);i.forEach(function(a){e.addObject(new d(a))}),a("./floor1Events")(b,g)}},{"../actions":10,"../prefabs":48,"../prefabs/InteractiveObject.js":44,"./floor1Events":56,"./floor1Objects":57}],50:[function(a,b){var c=a("../prefabs"),d=(a("../actions"),a("../prefabs/InteractiveObject.js"));b.exports=function(b,e){var f=b.getFeet(),g=new c.Dude({floor:2}),h=g.shape.getBounds().getFeet();g.position=f.subtract(h),e.addObject(g);var i=a("./floor2Objects")(b);i.forEach(function(a){e.addObject(new d(a))}),a("./floor2Events")(b,g)}},{"../actions":10,"../prefabs":48,"../prefabs/InteractiveObject.js":44,"./floor2Events":58,"./floor2Objects":59}],51:[function(a,b){var c=a("../prefabs"),d=(a("../actions"),a("../prefabs/InteractiveObject.js"));b.exports=function(b,e){var f=b.getFeet(),g=new c.FamilyBoy({floor:3}),h=new c.FamilyGirl({floor:3}),i=g.shape.getBounds().getFeet();g.position=f.subtract(i),h.position=f.subtract(i),h.position.x+=150,e.addObject(g),e.addObject(h);var j=a("./floor3Objects")(b);j.forEach(function(a){e.addObject(new d(a))}),a("./floor3Events")(b,g,h)}},{"../actions":10,"../prefabs":48,"../prefabs/InteractiveObject.js":44,"./floor3Events":60,"./floor3Objects":61}],52:[function(a,b){var c=a("../../../pac/src/"),d=(c._,a("../prefabs")),e=(a("./Stats"),a("../../node_modules/howler")),f=c.Scene.extend({texture:"back_building",deadCount:0,init:function(){},onEnter:function(){var b=this.game.stats,f=13;this.floor1=new(d.Floor(b.floor1,b.livingTime))({floor:1,name:"floor1",stats:b.floor1.start,env:b.floor1.env,position:new c.Point(f,407)}),this.floor2=new(d.Floor(b.floor2,b.livingTime))({floor:2,name:"floor2",stats:b.floor2.start,env:b.floor2.env,position:new c.Point(f,208)}),this.floor3=new(d.Floor(b.floor3,b.livingTime))({floor:3,name:"floor3",stats:b.floor3.start,env:b.floor3.env,position:new c.Point(f,12)}),this.muteText=new c.Text({zIndex:1e3,layer:"overlay",value:"Sound: ON",font:"10px lucaswhite",isBitmapText:!0,wordWrap:130,position:{x:825,y:15},actions:[new c.actions.Clickable],shape:new c.Rectangle({fill:"#4f4f4f",size:{width:100,height:20}})}),this.menuBackGround=new c.Rectangle({layer:"overlay",zIndex:1,position:{x:820,y:10},fill:"#000000",size:{width:102,height:25}}),this.muteText.on("click",function(){console.log("MUTEEE"),this.value.indexOf("ON")>-1?(e.Howler.mute(),this.value=this.value.replace("ON","OFF")):(e.Howler.unmute(),this.value=this.value.replace("OFF","ON"))}),this.addObject([this.floor1,this.floor2,this.floor3,this.menuBackGround,this.muteText]),a("./Floor1")(this.floor1,this),a("./Floor2")(this.floor2,this),a("./Floor3")(this.floor3,this),this.showScores=a("./showScores.js")(this.game)},onExit:function(){},update:function(){this.game.familyCard.disabled&&!this.floor3.disabled&&(this.floor3.disable(),this.deadCount++),this.game.dudeCard.disabled&&!this.floor2.disabled&&(this.floor2.disable(),this.deadCount++),this.game.granmaCard.disabled&&!this.floor1.disabled&&(this.floor1.disable(),this.deadCount++),2===this.deadCount&&this.showEnding()},showEnding:function(){this.game.pause();var a="";this.floor1.disabled?this.floor2.disabled?this.floor3.disabled||(a="You are a family hero."):a="Time to get serious, uh?":a="You behave like a sweet selfish granny.",this.showScores(["YOU LOST.",a],(this.game.time/1e3).toFixed(2)),window.setTimeout(function(){window.addEventListener("click",function(){window.location.href=window.location.href})},1e3)}});b.exports=f},{"../../../pac/src/":133,"../../node_modules/howler":2,"../prefabs":48,"./Floor1":49,"./Floor2":50,"./Floor3":51,"./Stats":54,"./showScores.js":63}],53:[function(a,b){var c=a("../../../pac/src/"),d=(c._,a("../prefabs"),a("./Stats"),c.Scene.extend({init:function(){},onEnter:function(){this.game.loadScene("OneScreen")},onExit:function(){},update:function(){}}));b.exports=d},{"../../../pac/src/":133,"../prefabs":48,"./Stats":54}],54:[function(a,b){function c(a,b){var c=.0025;return{mind:a*c,body:b*c}}b.exports={floor1:{start:{mind:1,body:1},living:c(-1,-2),env:{babyCry:c(-2,0),dudeStereo:c(-4,-2),dudeShower:c(-3,-1)}},floor2:{start:{mind:1,body:1},living:c(-2,-1),env:{babyCry:c(-3,-1),granmaBroom:c(-3,-1)}},floor3:{start:{mind:1,body:1},living:c(-2,-1),env:{dudeStereo:c(-3,-1)}},livingTime:.5}},{}],55:[function(a,b){function c(a,b,c){a.changeInterval=d.livingTime;var e=.005,f=a.duration===!0?1:a.duration;return a.state={mind:e*b/f,body:e*c/f},a}var d=a("./Stats"),e=1;b.exports={floor1:{tv:{command:c({env:{granmaTV:e},animation:"tvOn",duration:15},2,-2)},bed:{command:c({animation:"bedOn",duration:7},1,2)},kitchen:{command:c({animation:"kitchenOn",duration:8},1,-.5)},grandmaFood:{command:c({duration:.1},1,2)},grandmaShower:{command:c({animation:"grandmaShowerOn",duration:10},2,1)},grandmaBroom:{command:c({animation:"grandmaBroomOn",duration:10},2,-2)}},floor2:{dudeStereo:{command:c({env:{dudeStereo:e},animation:"dudeStereoOn",duration:!0},1.3,-.1)},bedDude:{command:c({animation:"dudeBedOn",duration:7},6,6)},dudeOven:{command:c({animation:"dudeOvenOn",duration:6},-2,-1)},dudeShower:{command:c({env:{dudeShower:e},animation:"dudeShowerOn",duration:15},0,.1)},dudeFood:{command:c({duration:.1},1,3)}},floor3:{baby:{command:c({env:{babyCry:.8},animation:"babyOn",duration:!0},-1,-2)},babySleep:{command:c({animation:"babyoff",duration:!0},0,0)},bedFamily:{command:c({animation:"familyBedOn",duration:7},6,6)},familyKitchen:{command:c({animation:"familyKitchenOn",duration:6},0,-1)},familyShower:{command:c({env:{dudeShower:e},animation:"familyShowerOn",duration:10},2,3)},familyFood:{command:c({duration:.1},2,3)}}}},{"./Stats":54}],56:[function(a,b){var c=a("../actions"),d=pac._;b.exports=function(a,b){a.onActivateObject=function(c){switch(c.name){case"Old Bed":b.visible=b.active=!1;break;case"Old Shower":b.visible=b.active=!1;break;case"Grandma Broom":b.visible=b.active=c.active=!1,c.position=a.position.add(new pac.Point(640,-20)),this.game.sounds.personaHablando1.loop(!0),this.game.sounds.golpeTecho1.loop(!0),this.game.sounds.golpeTecho1.play(),this.game.sounds.personaHablando1.play()}},a.onDeactivateObject=function(c){switch(c.name){case"Old Bed":b.visible=b.active=!0;break;case"Old Shower":b.visible=b.active=!0;break;case"Grandma Broom":c.position=a.position.add(new pac.Point(675,22)),b.visible=b.active=c.active=!0,this.game.sounds.golpeTecho1.stop(),this.game.sounds.personaHablando1.stop();break;case"Old kitchen":var d=this.scene.findOne("Grandma Food");d.visible=d.active=!0;break;case"Grandma Food":c.visible=c.active=!1}},a.onLostMind=function(){this.game.sounds.viejaHablando.play(),b.actions.pushBack(new pac.actions.Speak({text:d.sample(["I'm not crazy!","I cannot deal with this anymore"]),duration:2,isBlocking:!0,minDuration:2,after:function(){b.actions.pushBack(new pac.actions.Speak({text:"AAAAAaaaaaAAAAa!!!",duration:1,isBlocking:!0,minDuration:1}))}})),a.actions.each(function(a){a instanceof c.Living&&(a.lose.body*=4)})},a.onLostBody=function(){b.actions.pushBack(new pac.actions.Speak({text:"Ohhh my back!",duration:1,isBlocking:!0,minDuration:1})),a.actions.each(function(a){a instanceof c.Living&&(a.lose.mind*=3)}),b.actions.each(function(a){a instanceof c.Walker&&(a.velocity*=.4)})}}},{"../actions":10}],57:[function(a,b){var c=a("../actions"),d=a("./activables").floor1,e=a("../animations/floor1"),f=a("../animations");b.exports=function(a){return[{name:"Old TV",position:a.position.add(new pac.Point(488,50)),size:{width:65,height:133},frame:"tv",texture:"granma_tv",frameHover:"tv_hover",caption:["Turn ON old TV","Turn OFF old TV"],animations:new pac.AnimationList(e.tv,{"default":"tvOff",autoplay:!1}),actions:[new c.Activable(d.tv)]},{name:"Old Bed",position:a.position.add(new pac.Point(273,74)),size:{width:111,height:108},frame:"cama",texture:"granma_bed",frameHover:"cama_hover",caption:["Sleep in old bed","Wake up"],captionOffset:new pac.Point(20,20),animations:new pac.AnimationList(e.bed,{"default":"bedOff",autoplay:!1}),actions:[new c.Activable(d.bed)]},{name:"Old Shower",position:a.position.add(new pac.Point(-2,74)),size:{width:111,height:108},frame:"grandma_shower",texture:"grandma_shower",frameHover:"grandma_shower_hover",caption:["Take a shower","Take a shower"],captionOffset:new pac.Point(20,20),animations:new pac.AnimationList(e.grandmaShower,{"default":"grandmaShowerOff",autoplay:!1}),actions:[new c.Activable(d.grandmaShower)]},{name:"Old kitchen",position:a.position.add(new pac.Point(848,79)),size:{width:57,height:105},frame:"cocina",texture:"granma_kitchen",frameHover:"cocina_hover",caption:["Cook",""],captionOffset:new pac.Point(-20,10),animations:new pac.AnimationList(e.kitchen,{"default":"kitchenOff",autoplay:!1}),actions:[new c.Activable(d.kitchen)]},{name:"Old Water",position:a.position.add(new pac.Point(5,-1)),visible:!1,size:{width:200,height:200},floor:1,frame:"water_on_0",texture:"dude_water",animations:new pac.AnimationList(f.Water,{"default":"waterOn",autoplay:!0})},{name:"Grandma Food",position:a.position.add(new pac.Point(802,122)),size:{width:34,height:19},frame:"granmaFood",texture:"granma_food",visible:!1,active:!1,frameHover:"granmaFood_hover",caption:["Eat food"],captionOffset:new pac.Point(-20,-20),actions:[new c.Activable(d.grandmaFood)]},{name:"Grandma Broom",position:a.position.add(new pac.Point(675,22)),size:{width:70,height:160},frame:"grandma_broom",texture:"grandma_broom",frameHover:"grandma_broom_hover",caption:["Knock the roof"],captionOffset:new pac.Point(-20,-20),animations:new pac.AnimationList(e.grandmaBroom,{"default":"grandmaBroomOff",autoplay:!0}),actions:[new c.Activable(d.grandmaBroom)]}]}},{"../actions":10,"../animations":32,"../animations/floor1":19,"./activables":55}],58:[function(a,b){var c=pac._,d=a("../actions");b.exports=function(a,b){a.onActivateObject=function(a){switch(a.name){case"Dude Bed":b.visible=b.active=!1;break;case"Dude Shower":var c=this.scene.findOne("Old Water");c.visible=!0,b.visible=b.active=!1;break;case"Dude Stereo":this.game.sounds.musicaDude.loop(!0),this.game.sounds.musicaDude.play(),this.game.sounds.musicaDude.volume(.1)}},a.onDeactivateObject=function(a){switch(a.name){case"Dude Bed":b.visible=b.active=!0;break;case"Dude Shower":var c=this.scene.findOne("Old Water");c.visible=!1,b.visible=b.active=!0;break;case"Dude Stereo":this.game.sounds.musicaDude.stop();break;case"Dude Oven":var d=this.scene.findOne("Dude Food");d.visible=d.active=!0;break;case"Dude Food":a.active=a.visible=!1}},a.onLostMind=function(){this.game.sounds.personaHablando1.play();var e=this;b.actions.pushBack(new pac.actions.Speak({text:c.sample(["This place sucks.","STOOOOOPPP!!!!!"]),duration:1,isBlocking:!0,minDuration:1,after:function(){b.actions.pushBack(new pac.actions.Speak({text:"I just wanna leave this place.",duration:2,isBlocking:!0,minDuration:2,after:function(){e.game.sounds.personaHablando1.stop()}}))}})),a.actions.each(function(a){a instanceof d.Living&&(a.lose.body*=2)})},a.onLostBody=function(){b.actions.pushBack(new pac.actions.Speak({text:c.sample(["Who cares about the body!?","This is very hard"]),duration:1,isBlocking:!0,minDuration:1}))}}},{"../actions":10}],59:[function(a,b){var c=a("../actions"),d=a("./activables").floor2,e=a("../animations/floor2"),f=a("../animations");b.exports=function(a){return[{name:"Dude Bed",position:a.position.add(new pac.Point(522,34)),size:{width:150,height:150},floor:2,frame:"dude_bed",texture:"dude_bed",caption:["Take a nap","Wake up"],frameHover:"dude_bed_hover",captionOffset:new pac.Point(20,25),animations:new pac.AnimationList(e.bedDude,{"default":"dudeBedOff",autoplay:!1}),actions:[new c.Activable(d.bedDude)]},{name:"Dude Stereo",position:a.position.add(new pac.Point(711,-17)),size:{width:200,height:200},floor:2,frame:"dude_stereo",texture:"dude_stereo",frameHover:"dude_stereo_hover",captionOffset:new pac.Point(15,25),caption:["Play some tunes","Stop playing"],animations:new pac.AnimationList(e.dudeStereo,{"default":"dudeStereoOff",autoplay:!1}),actions:[new c.Activable(d.dudeStereo)]},{name:"Dude Oven",position:a.position.add(new pac.Point(271,48)),size:{width:70,height:70},floor:2,frame:"dude_oven",texture:"dude_oven",caption:["Cook something",""],frameHover:"dude_oven_hover",captionOffset:new pac.Point(0,20),animations:new pac.AnimationList(e.dudeOven,{"default":"dudeOvenOff",autoplay:!1}),actions:[new c.Activable(d.dudeOven)]},{name:"Dude Shower",position:a.position.add(new pac.Point(25,8)),size:{width:100,height:175},floor:2,frame:"dude_shower",texture:"dude_shower",caption:["Take a shower",""],frameHover:"dude_shower_hover",animations:new pac.AnimationList(e.dudeShower,{"default":"dudeShowerOff",autoplay:!1}),actions:[new c.Activable(d.dudeShower)]},{name:"Dude Water",position:a.position.add(new pac.Point(5,0)),visible:!1,size:{width:200,height:200},floor:2,frame:"water_on_0",texture:"dude_water",animations:new pac.AnimationList(f.Water,{"default":"waterOn",autoplay:!0})},{name:"Dude Food",position:a.position.add(new pac.Point(371,88)),size:{width:34,height:19},frame:"dudeFood",texture:"dude_food",visible:!1,active:!1,floor:2,frameHover:"dudeFood_hover",caption:["Eat food"],captionOffset:new pac.Point(-20,-20),actions:[new c.Activable(d.dudeFood)]}]}},{"../actions":10,"../animations":32,"../animations/floor2":26,"./activables":55}],60:[function(a,b){var c=pac._,d=a("../actions"),e=a("./activables").floor3;b.exports=function(a,b,f){a.onActivateObject=function(c){switch(console.log("onActivateObject > "+c.name),c.name){case"Family Bed":b.visible=b.active=!1,f.visible=f.active=!1;break;case"Family Shower":var d=this.scene.findOne("Dude Water");a.getWalker(c.position).visible=!1,d.visible=!0;break;case"Baby":this.game.sounds.babyCrying.loop(!0),this.game.sounds.babyCrying.play(),this.game.sounds.babyCrying.volume(.1)}},a.onDeactivateObject=function(c){switch(console.log("onDeactivateObject > "+c.name),c.name){case"Family Bed":b.visible=b.active=!0,f.visible=f.active=!0;break;case"Family Shower":var g=this.scene.findOne("Dude Water");a.getWalker(c.position).visible=!0,g.visible=!1;break;case"Baby":this.game.sounds.babyCrying.stop();var h,i=Math.floor(15*Math.random())+3;c.actions.each(function(a){return a instanceof d.Activable?(h=a,!1):void 0});var j=new pac.actions.Execute(function(a,b){var c=new d.Command(pac._.clone(e.baby.command,!0));return this.actions.removeAll(d.Command),b.insertBehindMe(c),this.active=!0,!0});c.actions.insertBefore(j,h).insertBefore(new pac.actions.Delay(i),j),c.active=!1;break;case"Family Kitchen":var k=this.scene.findOne("Family Food");k.visible=k.active=!0;break;case"Family Food":c.visible=c.active=!1}},a.onLostMind=function(){var d=function(a,b,d,e){return function(){a.actions.pushBack(new pac.actions.Speak({text:c.sample(b),duration:d,isBlocking:!0,minDuration:d,after:e}))}},e=c.random(0,1);d(e?b:f,["We should break up.","I'M DONE. I'm leaving"],2,d(e?f:b,["ITS ALL YOUR FAULT","Let's do this for the kids"],1.5,d(e?b:f,["yeah sure."],1,function(){a.walkers.remove(e?b:f),a.scene.removeObject(e?b:f)})))()},a.onLostBody=function(){var e=function(a,b,d,e){return function(){a.actions.pushBack(new pac.actions.Speak({text:c.sample(b),duration:d,isBlocking:!0,minDuration:d,after:e}))}};e(f,["We are a complete disaster as parents."],2,e(b,["Don't say that. This apartment is a complete disaster"],2,function(){a.actions.each(function(a){a instanceof d.Living&&(a.lose.mind*=5)})}))()}}},{"../actions":10,"./activables":55}],61:[function(a,b){var c=a("../actions"),d=a("./activables").floor3,e=a("../animations/floor3");b.exports=function(a){return[{name:"Family Bed",position:a.position.add(new pac.Point(245,73)),size:{width:110,height:110},floor:3,frame:"family_bed",texture:"family_bed",caption:["Sleep time","Wake up"],frameHover:"family_bed_hover",animations:new pac.AnimationList(e.bedFamily,{"default":"familyBedOff",autoplay:!1}),actions:[new c.Activable(d.bedFamily)]},{name:"Baby",position:a.position.add(new pac.Point(355,73)),size:{width:110,height:110},floor:3,frame:"baby",texture:"baby",caption:["","Sleep, baby"],frameHover:"baby_hover",animations:new pac.AnimationList(e.baby,{"default":"babyOff",autoplay:!1}),actions:[new pac.actions.Delay(Math.floor(15*Math.random())+8),new pac.actions.Execute(function(){var a=new c.Command(pac._.clone(d.baby.command,!0));return this.actions.removeAll(c.Command).pushFront(a).pushBack(new c.Activable(pac._.clone(d.babySleep,!0))),!0})]},{name:"Family Kitchen",position:a.position.add(new pac.Point(615,73)),size:{width:57,height:105},floor:3,frame:"family_kitchen",texture:"family_kitchen",caption:["Cook",""],frameHover:"family_kitchen_hover",animations:new pac.AnimationList(e.familyKitchen,{"default":"familyKitchenOff",autoplay:!1}),actions:[new c.Activable(d.familyKitchen)]},{name:"Family Shower",position:a.position.add(new pac.Point(-7,7)),size:{width:100,height:175},floor:3,frame:"family_shower",texture:"family_shower",caption:["Take a shower",""],frameHover:"family_shower_hover",animations:new pac.AnimationList(e.familyShower,{"default":"familyShowerOff",autoplay:!1}),actions:[new c.Activable(d.familyShower)]},{name:"Family Food",position:a.position.add(new pac.Point(500,110)),size:{width:34,height:19},frame:"familyFood",texture:"family_food",visible:!1,active:!1,floor:3,frameHover:"familyFood_hover",caption:["Eat food"],captionOffset:new pac.Point(-20,-20),actions:[new c.Activable(d.familyFood)]}]
}},{"../actions":10,"../animations/floor3":31,"./activables":55}],62:[function(a,b){b.exports={OneScreen:a("./OneScreen"),Reset:a("./Reset")}},{"./OneScreen":52,"./Reset":53}],63:[function(a,b){var c=pac._;b.exports=function(a){return function(b,d){var e,f,g,h,i=[a.scenes.current.findOne("floor3"),a.scenes.current.findOne("floor2"),a.scenes.current.findOne("floor1")];c.forEach(i,function(a){a.disabled&&(e?(f=new pac.Text({value:b[1],font:"42px lucaswhite",isBitmapText:!0,wordWrap:a.size.width-50,position:a.position.add(70,20),layer:"overlay"}),g=new pac.Text({value:(b[2]||"You lasted ")+d+"s",font:"28px lucaswhite",isBitmapText:!0,wordWrap:a.size.width-50,position:a.position.add(70,150),tint:3386111,layer:"overlay"}),h=new pac.Text({value:"Try again.",font:"28px lucaswhite",isBitmapText:!0,layer:"overlay",wordWrap:a.size.width-50,position:a.position.add(600,150),tint:1140394,shape:new pac.Rectangle({position:a.position.add(600,100),size:{width:100,height:20}}),actions:[new pac.actions.Hoverable,new pac.actions.Clickable]}),h.on("hover:in",function(){this.tint=15856113}).on("hover:out",function(){this.tint=1140394}).on("click",function(){window.alert("peton")})):e=new pac.Text({value:b[0],font:"42px lucaswhite",isBitmapText:!0,wordWrap:a.size.width-50,position:a.position.add(30,20),layer:"overlay"}))}),a.addObject(e),a.addObject(f),a.addObject(g),a.addObject(h)}}},{}],64:[function(a,b){var c=a("howler").Howl,d=a("./sounds.js"),e=pac._,f={};e.forIn(d,function(a,b){f[b]=new c({urls:a})}),b.exports=f},{"./sounds.js":65,howler:2}],65:[function(a,b){b.exports={babyCrying:["assets/sounds/baby-crying.ogg","assets/sounds/baby-crying.mp3","assets/sounds/baby-crying.wav"],golpeTecho1:["assets/sounds/golpe_techo1.ogg","assets/sounds/golpe_techo1.mp3","assets/sounds/golpe_techo1.wav"],golpe_techo2:["assets/sounds/golpe_techo2.ogg","assets/sounds/golpe_techo2.mp3","assets/sounds/golpe_techo2.wav"],gota:["assets/sounds/gota.ogg","assets/sounds/gota.mp3","assets/sounds/gota.wav"],musicaDude:["assets/sounds/musica_dude.ogg","assets/sounds/musica_dude.mp3","assets/sounds/musica_dude.wav"],personaHablando1:["assets/sounds/persona_hablando1.ogg","assets/sounds/persona_hablando1.mp3","assets/sounds/persona_hablando1.wav"],persona_hablando2:["assets/sounds/persona_hablando2.ogg","assets/sounds/persona_hablando2.mp3","assets/sounds/persona_hablando2.wav"],viejaHablando:["assets/sounds/vieja_hablando.ogg","assets/sounds/vieja_hablando.mp3","assets/sounds/vieja_hablando.wav"]}},{}],66:[function(a,b){function c(a,b){if("function"!=typeof b)throw new Error("Bad callback given: "+b);if(!a)throw new Error("No options given");var g=a.onResponse;if(a="string"==typeof a?{uri:a}:JSON.parse(JSON.stringify(a)),a.onResponse=g,a.verbose&&(c.log=f()),a.url&&(a.uri=a.url,delete a.url),!a.uri&&""!==a.uri)throw new Error("options.uri is a required argument");if("string"!=typeof a.uri)throw new Error("options.uri must be a string");for(var h=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],j=0;j<h.length;j++)if(a[h[j]])throw new Error("options."+h[j]+" is not supported");if(a.callback=b,a.method=a.method||"GET",a.headers=a.headers||{},a.body=a.body||null,a.timeout=a.timeout||c.DEFAULT_TIMEOUT,a.headers.host)throw new Error("Options.headers.host is not supported");a.json&&(a.headers.accept=a.headers.accept||"application/json","GET"!==a.method&&(a.headers["content-type"]="application/json"),"boolean"!=typeof a.json?a.body=JSON.stringify(a.json):"string"!=typeof a.body&&(a.body=JSON.stringify(a.body)));var k=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(a.qs){var l="string"==typeof a.qs?a.qs:k(a.qs);a.uri=-1!==a.uri.indexOf("?")?a.uri+"&"+l:a.uri+"?"+l}var m=function(a){var b={};b.boundry="-------------------------------"+Math.floor(1e9*Math.random());var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push("--"+b.boundry+'\nContent-Disposition: form-data; name="'+d+'"\n\n'+a[d]+"\n");return c.push("--"+b.boundry+"--"),b.body=c.join(""),b.length=b.body.length,b.type="multipart/form-data; boundary="+b.boundry,b};if(a.form){if("string"==typeof a.form)throw"form name unsupported";if("POST"===a.method){var n=(a.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(a.headers["content-type"]=n,n){case"application/x-www-form-urlencoded":a.body=k(a.form).replace(/%20/g,"+");break;case"multipart/form-data":var o=m(a.form);a.body=o.body,a.headers["content-type"]=o.type;break;default:throw new Error("unsupported encoding:"+n)}}}return a.onResponse=a.onResponse||e,a.onResponse===!0&&(a.onResponse=b,a.callback=e),!a.headers.authorization&&a.auth&&(a.headers.authorization="Basic "+i(a.auth.username+":"+a.auth.password)),d(a)}function d(a){function b(){k=!0;var b=new Error("ETIMEDOUT");return b.code="ETIMEDOUT",b.duration=a.timeout,c.log.error("Timeout",{id:i._id,milliseconds:a.timeout}),a.callback(b,i)}function d(){if(k)return c.log.debug("Ignoring timed out state change",{state:i.readyState,id:i.id});if(c.log.debug("State change",{state:i.readyState,id:i.id,timed_out:k}),i.readyState===j.OPENED){c.log.debug("Request started",{id:i.id});for(var b in a.headers)i.setRequestHeader(b,a.headers[b])}else i.readyState===j.HEADERS_RECEIVED?e():i.readyState===j.LOADING?(e(),f()):i.readyState===j.DONE&&(e(),f(),g())}function e(){if(!p.response){if(p.response=!0,c.log.debug("Got response",{id:i.id,status:i.status}),clearTimeout(i.timeoutTimer),i.statusCode=i.status,m&&0==i.statusCode){var b=new Error("CORS request rejected: "+a.uri);return b.cors="rejected",p.loading=!0,p.end=!0,a.callback(b,i)}a.onResponse(null,i)}}function f(){p.loading||(p.loading=!0,c.log.debug("Response body loading",{id:i.id}))}function g(){if(!p.end){if(p.end=!0,c.log.debug("Request done",{id:i.id}),i.body=i.responseText,a.json)try{i.body=JSON.parse(i.responseText)}catch(b){return a.callback(b,i)}a.callback(null,i,i.body)}}var i=new j,k=!1,m=h(a.uri),n="withCredentials"in i;if(l+=1,i.seq_id=l,i.id=l+": "+a.method+" "+a.uri,i._id=i.id,m&&!n){var o=new Error("Browser does not support cross-origin request: "+a.uri);return o.cors="unsupported",a.callback(o,i)}i.timeoutTimer=setTimeout(b,a.timeout);var p={response:!1,loading:!1,end:!1};return i.onreadystatechange=d,i.open(a.method,a.uri,!0),m&&(i.withCredentials=!!a.withCredentials),i.send(a.body),i}function e(){}function f(){var a,b,c={},d=["trace","debug","info","warn","error"];for(b=0;b<d.length;b++)a=d[b],c[a]=e,"undefined"!=typeof console&&console&&console[a]&&(c[a]=g(console,a));return c}function g(a,b){function c(c,d){return"object"==typeof d&&(c+=" "+JSON.stringify(d)),a[b].call(a,c)}return c}function h(a){var b,c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{b=location.href}catch(d){b=document.createElement("a"),b.href="",b=b.href}var e=c.exec(b.toLowerCase())||[],f=c.exec(a.toLowerCase()),g=!(!f||f[1]==e[1]&&f[2]==e[2]&&(f[3]||("http:"===f[1]?80:443))==(e[3]||("http:"===e[1]?80:443)));return g}function i(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}var j=XMLHttpRequest;if(!j)throw new Error("missing XMLHttpRequest");c.log={trace:e,debug:e,info:e,warn:e,error:e};var k=18e4,l=0;c.withCredentials=!1,c.DEFAULT_TIMEOUT=k,c.defaults=function(a){var b=function(b){var c=function(c,d){c="string"==typeof c?{uri:c}:JSON.parse(JSON.stringify(c));for(var e in a)void 0===c[e]&&(c[e]=a[e]);return b(c,d)};return c},d=b(c);return d.get=b(c.get),d.post=b(c.post),d.put=b(c.put),d.head=b(c.head),d};var m=["get","put","post","head"];m.forEach(function(a){var b=a.toUpperCase(),d=a.toLowerCase();c[d]=function(a){"string"==typeof a?a={method:b,uri:a}:(a=JSON.parse(JSON.stringify(a)),a.method=b);var d=[a].concat(Array.prototype.slice.apply(arguments,[1]));return c.apply(this,d)}}),c.couch=function(a,b){function d(a,c,d){if(a)return b(a,c,d);if((c.statusCode<200||c.statusCode>299)&&d.error){a=new Error("CouchDB error: "+(d.error.reason||d.error.error));for(var e in d)a[e]=d[e];return b(a,c,d)}return b(a,c,d)}"string"==typeof a&&(a={uri:a}),a.json=!0,a.body&&(a.json=a.body),delete a.body,b=b||e;var f=c(a,d);return f},b.exports=c},{}],67:[function(a,b){function c(a,b){var c,e=this;return c=a&&d.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},d.extend(c,e,b),c.prototype=Object.create(e.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),a&&d.extend(c.prototype,a),c.__super__=e.prototype,c}var d=a("lodash"),e=b.exports=function(){};e.extend=c},{lodash:68}],68:[function(a,b,c){(function(a){(function(){function d(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function e(a,b){var c=typeof b;if(a=a.cache,"boolean"==c||null==b)return a[b]?0:-1;"number"!=c&&"string"!=c&&(c="object");var e="number"==c?b:u+b;return a=(a=a[c])&&a[e],"object"==c?a&&d(a,b)>-1?0:-1:a?0:-1}function f(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:u+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function g(a){return a.charCodeAt(0)}function h(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function i(a){var b=-1,c=a.length,d=a[0],e=a[c/2|0],g=a[c-1];if(d&&"object"==typeof d&&e&&"object"==typeof e&&g&&"object"==typeof g)return!1;var h=l();h["false"]=h["null"]=h["true"]=h.undefined=!1;var i=l();for(i.array=a,i.cache=h,i.push=f;++b<c;)i.push(a[b]);return i}function j(a){return"\\"+Y[a]}function k(){return r.pop()||[]}function l(){return s.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function m(a){a.length=0,r.length<w&&r.push(a)}function n(a){var b=a.cache;b&&n(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,s.length<w&&s.push(a)}function o(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function p(a){function b(a){return a&&"object"==typeof a&&!Zd(a)&&Hd.call(a,"__wrapped__")?a:new c(a)}function c(a,b){this.__chain__=!!b,this.__wrapped__=a}function f(a){function b(){if(d){var a=o(d);Id.apply(a,arguments)}if(this instanceof b){var f=s(c.prototype),g=c.apply(f,a||arguments);return Eb(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Yd(b,a),b}function r(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Eb(a);if(!g)return a;var h=Ad.call(a);if(!U[h])return a;var i=Wd[h];switch(h){case N:case O:return new i(+a);case Q:case T:return new i(a);case S:return f=i(a.source,C.exec(a)),f.lastIndex=a.lastIndex,f}var j=Zd(a);if(b){var l=!d;d||(d=k()),e||(e=k());for(var n=d.length;n--;)if(d[n]==a)return e[n];f=j?i(a.length):{}}else f=j?o(a):ee({},a);return j&&(Hd.call(a,"index")&&(f.index=a.index),Hd.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(j?Yb:he)(a,function(a,g){f[g]=r(a,b,c,d,e)}),l&&(m(d),m(e)),f):f}function s(a){return Eb(a)?Nd(a):{}}function w(a,b,c){if("function"!=typeof a)return Zc;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Xd.funcNames&&(d=!a.name),d=d||!Xd.funcDecomp,!d)){var e=Fd.call(a);Xd.funcNames||(d=!D.test(e)),d||(d=H.test(e),Yd(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ic(a,b)}function Y(a){function b(){var a=i?g:this;if(e){var n=o(e);Id.apply(n,arguments)}if((f||k)&&(n||(n=o(arguments)),f&&Id.apply(n,f),k&&n.length<h))return d|=16,Y([c,l?d:-4&d,n,null,g,h]);if(n||(n=arguments),j&&(c=a[m]),this instanceof b){a=s(c.prototype);var p=c.apply(a,n);return Eb(p)?p:a}return c.apply(a,n)}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,l=8&d,m=c;return Yd(b,a),b}function $(a,b){var c=-1,f=ib(),g=a?a.length:0,h=g>=v&&f===d,j=[];if(h){var k=i(b);k?(f=e,b=k):h=!1}for(;++c<g;){var l=a[c];f(b,l)<0&&j.push(l)}return h&&n(b),j}function _(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Zd(h)||mb(h))){b||(h=_(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function ab(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var h=typeof a,i=typeof b;if(!(a!==a||a&&X[h]||b&&X[i]))return!1;if(null==a||null==b)return a===b;var j=Ad.call(a),l=Ad.call(b);if(j==L&&(j=R),l==L&&(l=R),j!=l)return!1;switch(j){case N:case O:return+a==+b;case Q:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case S:case T:return a==vd(b)}var n=j==M;if(!n){var o=Hd.call(a,"__wrapped__"),p=Hd.call(b,"__wrapped__");if(o||p)return ab(o?a.__wrapped__:a,p?b.__wrapped__:b,c,d,e,f);if(j!=R)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(Db(q)&&q instanceof q&&Db(r)&&r instanceof r)&&"constructor"in a&&"constructor"in b)return!1}var s=!e;e||(e=k()),f||(f=k());for(var t=e.length;t--;)if(e[t]==a)return f[t]==b;var u=0;if(g=!0,e.push(a),f.push(b),n){if(t=a.length,u=b.length,g=u==t,g||d)for(;u--;){var v=t,w=b[u];if(d)for(;v--&&!(g=ab(a[v],w,c,d,e,f)););else if(!(g=ab(a[u],w,c,d,e,f)))break}}else ge(b,function(b,h,i){return Hd.call(i,h)?(u++,g=Hd.call(a,h)&&ab(a[h],b,c,d,e,f)):void 0}),g&&!d&&ge(a,function(a,b,c){return Hd.call(c,b)?g=--u>-1:void 0});return e.pop(),f.pop(),s&&(m(e),m(f)),g}function bb(a,b,c,d,e){(Zd(b)?Yb:he)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Zd(b))||ie(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Zd(j)?j:[]:ie(j)?j:{}),d.push(b),e.push(j),l||bb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function db(a,b){return a+Ed(Vd()*(b-a+1))}function eb(a,b,c){var f=-1,g=ib(),h=a?a.length:0,j=[],l=!b&&h>=v&&g===d,o=c||l?k():j;if(l){var p=i(o);g=e,o=p}for(;++f<h;){var q=a[f],r=c?c(q,f,a):q;(b?!f||o[o.length-1]!==r:g(o,r)<0)&&((c||l)&&o.push(r),j.push(q))}return l?(m(o.array),n(o)):c&&m(o),j}function fb(a){return function(c,d,e){var f={};d=b.createCallback(d,e,3);var g=-1,h=c?c.length:0;if("number"==typeof h)for(;++g<h;){var i=c[g];a(f,i,d(i,g,c),c)}else he(c,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function gb(a,b,c,d,e,g){var h=1&b,i=2&b,j=4&b,k=16&b,l=32&b;if(!i&&!Db(a))throw new wd;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var m=a&&a.__bindData__;if(m&&m!==!0)return m=o(m),m[2]&&(m[2]=o(m[2])),m[3]&&(m[3]=o(m[3])),!h||1&m[1]||(m[4]=e),!h&&1&m[1]&&(b|=8),!j||4&m[1]||(m[5]=g),k&&Id.apply(m[2]||(m[2]=[]),c),l&&Ld.apply(m[3]||(m[3]=[]),d),m[1]|=b,gb.apply(null,m);var n=1==b||17===b?f:Y;return n([a,b,c,d,e,g])}function hb(a){return ae[a]}function ib(){var a=(a=b.indexOf)===rc?d:a;return a}function jb(a){return"function"==typeof a&&Bd.test(a)}function kb(a){var b,c;return a&&Ad.call(a)==R&&(b=a.constructor,!Db(b)||b instanceof b)?(ge(a,function(a,b){c=b}),"undefined"==typeof c||Hd.call(a,c)):!1}function lb(a){return be[a]}function mb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==L||!1}function nb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),r(a,b,"function"==typeof c&&w(c,d,1))}function ob(a,b,c){return r(a,!0,"function"==typeof b&&w(b,c,1))}function pb(a,b){var c=s(a);return b?ee(c,b):c}function qb(a,c,d){var e;return c=b.createCallback(c,d,3),he(a,function(a,b,d){return c(a,b,d)?(e=b,!1):void 0}),e}function rb(a,c,d){var e;return c=b.createCallback(c,d,3),tb(a,function(a,b,d){return c(a,b,d)?(e=b,!1):void 0}),e}function sb(a,b,c){var d=[];ge(a,function(a,b){d.push(b,a)});var e=d.length;for(b=w(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function tb(a,b,c){var d=_d(a),e=d.length;for(b=w(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function ub(a){var b=[];return ge(a,function(a,c){Db(a)&&b.push(c)}),b.sort()}function vb(a,b){return a?Hd.call(a,b):!1}function wb(a){for(var b=-1,c=_d(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function xb(a){return a===!0||a===!1||a&&"object"==typeof a&&Ad.call(a)==N||!1}function yb(a){return a&&"object"==typeof a&&Ad.call(a)==O||!1}function zb(a){return a&&1===a.nodeType||!1}function Ab(a){var b=!0;if(!a)return b;var c=Ad.call(a),d=a.length;return c==M||c==T||c==L||c==R&&"number"==typeof d&&Db(a.splice)?!d:(he(a,function(){return b=!1}),b)}function Bb(a,b,c,d){return ab(a,b,"function"==typeof c&&w(c,d,2))}function Cb(a){return Pd(a)&&!Qd(parseFloat(a))}function Db(a){return"function"==typeof a}function Eb(a){return!(!a||!X[typeof a])}function Fb(a){return Hb(a)&&a!=+a}function Gb(a){return null===a}function Hb(a){return"number"==typeof a||a&&"object"==typeof a&&Ad.call(a)==Q||!1}function Ib(a){return a&&"object"==typeof a&&Ad.call(a)==S||!1}function Jb(a){return"string"==typeof a||a&&"object"==typeof a&&Ad.call(a)==T||!1}function Kb(a){return"undefined"==typeof a}function Lb(a,c,d){var e={};return c=b.createCallback(c,d,3),he(a,function(a,b,d){e[b]=c(a,b,d)}),e}function Mb(a){var b=arguments,c=2;if(!Eb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=w(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=o(arguments,1,c),f=-1,g=k(),h=k();++f<c;)bb(a,e[f],d,g,h);return m(g),m(h),a}function Nb(a,c,d){var e={};if("function"!=typeof c){var f=[];ge(a,function(a,b){f.push(b)}),f=$(f,_(arguments,!0,!1,1));for(var g=-1,h=f.length;++g<h;){var i=f[g];e[i]=a[i]}}else c=b.createCallback(c,d,3),ge(a,function(a,b,d){c(a,b,d)||(e[b]=a)});return e}function Ob(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Pb(a,c,d){var e={};if("function"!=typeof c)for(var f=-1,g=_(arguments,!0,!1,1),h=Eb(a)?g.length:0;++f<h;){var i=g[f];i in a&&(e[i]=a[i])}else c=b.createCallback(c,d,3),ge(a,function(a,b,d){c(a,b,d)&&(e[b]=a)});return e}function Qb(a,c,d,e){var f=Zd(a);if(null==d)if(f)d=[];else{var g=a&&a.constructor,h=g&&g.prototype;d=s(h)}return c&&(c=b.createCallback(c,e,4),(f?Yb:he)(a,function(a,b,e){return c(d,a,b,e)})),d}function Rb(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;)e[b]=a[c[b]];return e}function Sb(a){for(var b=arguments,c=-1,d=_(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=nd(e);++c<e;)f[c]=a[d[c]];return f}function Tb(a,b,c){var d=-1,e=ib(),f=a?a.length:0,g=!1;return c=(0>c?Sd(0,f+c):c)||0,Zd(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Jb(a)?a.indexOf(b,c):e(a,b,c))>-1:he(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Ub(a,c,d){var e=!0;c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&(e=!!c(a[f],f,a)););else he(a,function(a,b,d){return e=!!c(a,b,d)});return e}function Vb(a,c,d){var e=[];c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g;){var h=a[f];c(h,f,a)&&e.push(h)}else he(a,function(a,b,d){c(a,b,d)&&e.push(a)});return e}function Wb(a,c,d){c=b.createCallback(c,d,3);var e=-1,f=a?a.length:0;if("number"!=typeof f){var g;return he(a,function(a,b,d){return c(a,b,d)?(g=a,!1):void 0}),g}for(;++e<f;){var h=a[e];if(c(h,e,a))return h}}function Xb(a,c,d){var e;return c=b.createCallback(c,d,3),Zb(a,function(a,b,d){return c(a,b,d)?(e=a,!1):void 0}),e}function Yb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:w(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else he(a,b);return a}function Zb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:w(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=_d(a);d=e.length,he(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function $b(a,b){var c=o(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=nd("number"==typeof f?f:0);return Yb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function _b(a,c,d){var e=-1,f=a?a.length:0;if(c=b.createCallback(c,d,3),"number"==typeof f)for(var g=nd(f);++e<f;)g[e]=c(a[e],e,a);else g=[],he(a,function(a,b,d){g[++e]=c(a,b,d)});return g}function ac(a,c,d){var e=-1/0,f=e;if("function"!=typeof c&&d&&d[c]===a&&(c=null),null==c&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];j>f&&(f=j)}else c=null==c&&Jb(a)?g:b.createCallback(c,d,3),Yb(a,function(a,b,d){var g=c(a,b,d);g>e&&(e=g,f=a)});return f}function bc(a,c,d){var e=1/0,f=e;if("function"!=typeof c&&d&&d[c]===a&&(c=null),null==c&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];f>j&&(f=j)}else c=null==c&&Jb(a)?g:b.createCallback(c,d,3),Yb(a,function(a,b,d){var g=c(a,b,d);e>g&&(e=g,f=a)});return f}function cc(a,c,d,e){if(!a)return d;var f=arguments.length<3;c=b.createCallback(c,e,4);var g=-1,h=a.length;if("number"==typeof h)for(f&&(d=a[++g]);++g<h;)d=c(d,a[g],g,a);else he(a,function(a,b,e){d=f?(f=!1,a):c(d,a,b,e)});return d}function dc(a,c,d,e){var f=arguments.length<3;return c=b.createCallback(c,e,4),Zb(a,function(a,b,e){d=f?(f=!1,a):c(d,a,b,e)}),d}function ec(a,c,d){return c=b.createCallback(c,d,3),Vb(a,function(a,b,d){return!c(a,b,d)})}function fc(a,b,c){if(a&&"number"!=typeof a.length&&(a=Rb(a)),null==b||c)return a?a[db(0,a.length-1)]:q;var d=gc(a);return d.length=Td(Sd(0,b),d.length),d}function gc(a){var b=-1,c=a?a.length:0,d=nd("number"==typeof c?c:0);return Yb(a,function(a){var c=db(0,++b);d[b]=d[c],d[c]=a}),d}function hc(a){var b=a?a.length:0;return"number"==typeof b?b:_d(a).length}function ic(a,c,d){var e;c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&!(e=c(a[f],f,a)););else he(a,function(a,b,d){return!(e=c(a,b,d))});return!!e}function jc(a,c,d){var e=-1,f=Zd(c),g=a?a.length:0,i=nd("number"==typeof g?g:0);for(f||(c=b.createCallback(c,d,3)),Yb(a,function(a,b,d){var g=i[++e]=l();f?g.criteria=_b(c,function(b){return a[b]}):(g.criteria=k())[0]=c(a,b,d),g.index=e,g.value=a}),g=i.length,i.sort(h);g--;){var j=i[g];i[g]=j.value,f||m(j.criteria),n(j)}return i}function kc(a){return a&&"number"==typeof a.length?o(a):Rb(a)}function lc(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function mc(a){return $(a,_(arguments,!0,!0,1))}function nc(a,c,d){var e=-1,f=a?a.length:0;for(c=b.createCallback(c,d,3);++e<f;)if(c(a[e],e,a))return e;return-1}function oc(a,c,d){var e=a?a.length:0;for(c=b.createCallback(c,d,3);e--;)if(c(a[e],e,a))return e;return-1}function pc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=-1;for(c=b.createCallback(c,d,3);++g<f&&c(a[g],g,a);)e++}else if(e=c,null==e||d)return a?a[0]:q;return o(a,0,Td(Sd(0,e),f))}function qc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=_b(a,c,d)),_(a,b)}function rc(a,b,c){if("number"==typeof c){var e=a?a.length:0;c=0>c?Sd(0,e+c):c||0}else if(c){var f=Ac(a,b);return a[f]===b?f:-1}return d(a,b,c)}function sc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=f;for(c=b.createCallback(c,d,3);g--&&c(a[g],g,a);)e++}else e=null==c||d?1:c||e;return o(a,0,Td(Sd(0,f-e),f))}function tc(){for(var a=[],b=-1,c=arguments.length,f=k(),g=ib(),h=g===d,j=k();++b<c;){var l=arguments[b];(Zd(l)||mb(l))&&(a.push(l),f.push(h&&l.length>=v&&i(b?a[b]:j)))}var o=a[0],p=-1,q=o?o.length:0,r=[];a:for(;++p<q;){var s=f[0];if(l=o[p],(s?e(s,l):g(j,l))<0){for(b=c,(s||j).push(l);--b;)if(s=f[b],(s?e(s,l):g(a[b],l))<0)continue a;r.push(l)}}for(;c--;)s=f[c],s&&n(s);return m(f),m(j),r}function uc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=f;for(c=b.createCallback(c,d,3);g--&&c(a[g],g,a);)e++}else if(e=c,null==e||d)return a?a[f-1]:q;return o(a,Sd(0,f-e))}function vc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Sd(0,d+c):Td(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wc(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Kd.call(a,f--,1),e--);return a}function xc(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Sd(0,Cd((b-a)/(c||1))),f=nd(e);++d<e;)f[d]=a,a+=c;return f}function yc(a,c,d){var e=-1,f=a?a.length:0,g=[];for(c=b.createCallback(c,d,3);++e<f;){var h=a[e];c(h,e,a)&&(g.push(h),Kd.call(a,e--,1),f--)}return g}function zc(a,c,d){if("number"!=typeof c&&null!=c){var e=0,f=-1,g=a?a.length:0;for(c=b.createCallback(c,d,3);++f<g&&c(a[f],f,a);)e++}else e=null==c||d?1:Sd(0,c);return o(a,e)}function Ac(a,c,d,e){var f=0,g=a?a.length:f;for(d=d?b.createCallback(d,e,1):Zc,c=d(c);g>f;){var h=f+g>>>1;d(a[h])<c?f=h+1:g=h}return f}function Bc(){return eb(_(arguments,!0,!0))}function Cc(a,c,d,e){return"boolean"!=typeof c&&null!=c&&(e=d,d="function"!=typeof c&&e&&e[c]===a?null:c,c=!1),null!=d&&(d=b.createCallback(d,e,3)),eb(a,c,d)}function Dc(a){return $(a,o(arguments,1))}function Ec(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Zd(c)||mb(c))var d=d?eb($(d,c).concat($(c,d))):c}return d||[]}function Fc(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?ac(me(a,"length")):0,d=nd(0>c?0:c);++b<c;)d[b]=me(a,b);return d}function Gc(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Zd(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Hc(a,b){if(!Db(b))throw new wd;return function(){return--a<1?b.apply(this,arguments):void 0}}function Ic(a,b){return arguments.length>2?gb(a,17,o(arguments,2),null,b):gb(a,1,null,null,b)}function Jc(a){for(var b=arguments.length>1?_(arguments,!0,!1,1):ub(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=gb(a[e],1,null,null,a)}return a}function Kc(a,b){return arguments.length>2?gb(b,19,o(arguments,2),null,a):gb(b,3,null,null,a)}function Lc(){for(var a=arguments,b=a.length;b--;)if(!Db(a[b]))throw new wd;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Mc(a,b){return b="number"==typeof b?b:+b||a.length,gb(a,4,null,null,null,b)}function Nc(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!Db(a))throw new wd;if(b=Sd(0,b)||0,c===!0){var n=!0;m=!1}else Eb(c)&&(n=c.leading,l="maxWait"in c&&(Sd(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(oe()-g);if(0>=c){e&&Dd(e);var l=j;e=i=j=q,l&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))}else i=Jd(o,c)},p=function(){i&&Dd(i),e=i=j=q,(m||l!==b)&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=oe(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k),r=0>=q;r?(e&&(e=Dd(e)),k=g,f=a.apply(h,d)):e||(e=Jd(p,q))}return r&&i?i=Dd(i):i||b===l||(i=Jd(o,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Oc(a){if(!Db(a))throw new wd;var b=o(arguments,1);return Jd(function(){a.apply(q,b)},1)}function Pc(a,b){if(!Db(a))throw new wd;var c=o(arguments,2);return Jd(function(){a.apply(q,c)},b)}function Qc(a,b){if(!Db(a))throw new wd;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):u+arguments[0];return Hd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Rc(a){var b,c;if(!Db(a))throw new wd;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Sc(a){return gb(a,16,o(arguments,1))}function Tc(a){return gb(a,32,null,o(arguments,1))}function Uc(a,b,c){var d=!0,e=!0;if(!Db(a))throw new wd;return c===!1?d=!1:Eb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),V.leading=d,V.maxWait=b,V.trailing=e,Nc(a,b,V)}function Vc(a,b){return gb(b,16,[a])}function Wc(a){return function(){return a}}function Xc(a,b,c){var d=typeof a;if(null==a||"function"==d)return w(a,b,c);if("object"!=d)return bd(a);var e=_d(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Eb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=ab(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Yc(a){return null==a?"":vd(a).replace(de,hb)}function Zc(a){return a}function $c(a,d,e){var f=!0,g=d&&ub(d);d&&(e||g.length)||(null==e&&(e=d),h=c,d=a,a=b,g=ub(d)),e===!1?f=!1:Eb(e)&&"chain"in e&&(f=e.chain);var h=a,i=Db(h);Yb(g,function(b){var c=a[b]=d[b];i&&(h.prototype[b]=function(){var b=this.__chain__,d=this.__wrapped__,e=[d];Id.apply(e,arguments);var g=c.apply(a,e);if(f||b){if(d===g&&Eb(g))return this;g=new h(g),g.__chain__=b}return g})})}function _c(){return a._=zd,this}function ad(){}function bd(a){return function(b){return b[a]}}function cd(a,b,c){var d=null==a,e=null==b;if(null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=Vd();return Td(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return db(a,b)}function dd(a,b){if(a){var c=a[b];return Db(c)?a[b]():c}}function ed(a,c,d){var e=b.templateSettings;a=vd(a||""),d=fe({},d,e);var f,g=fe({},d.imports,e.imports),h=_d(g),i=Rb(g),k=0,l=d.interpolate||G,m="__p += '",n=ud((d.escape||G).source+"|"+l.source+"|"+(l===E?B:G).source+"|"+(d.evaluate||G).source+"|$","g");a.replace(n,function(b,c,d,e,g,h){return d||(d=e),m+=a.slice(k,h).replace(I,j),c&&(m+="' +\n__e("+c+") +\n'"),g&&(f=!0,m+="';\n"+g+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=h+b.length,b}),m+="';\n";var o=d.variable,p=o;p||(o="obj",m="with ("+o+") {\n"+m+"\n}\n"),m=(f?m.replace(y,""):m).replace(z,"$1").replace(A,"$1;"),m="function("+o+") {\n"+(p?"":o+" || ("+o+" = {});\n")+"var __t, __p = '', __e = _.escape"+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var r="\n/*\n//# sourceURL="+(d.sourceURL||"/lodash/template/source["+K++ +"]")+"\n*/";try{var s=qd(h,"return "+m+r).apply(q,i)}catch(t){throw t.source=m,t}return c?s(c):(s.source=m,s)}function fd(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=nd(a);for(b=w(b,c,1);++d<a;)e[d]=b(d);return e}function gd(a){return null==a?"":vd(a).replace(ce,lb)}function hd(a){var b=++t;return vd(null==a?"":a)+b}function id(a){return a=new c(a),a.__chain__=!0,a}function jd(a,b){return b(a),a}function kd(){return this.__chain__=!0,this}function ld(){return vd(this.__wrapped__)}function md(){return this.__wrapped__}a=a?cb.defaults(Z.Object(),a,cb.pick(Z,J)):Z;var nd=a.Array,od=a.Boolean,pd=a.Date,qd=a.Function,rd=a.Math,sd=a.Number,td=a.Object,ud=a.RegExp,vd=a.String,wd=a.TypeError,xd=[],yd=td.prototype,zd=a._,Ad=yd.toString,Bd=ud("^"+vd(Ad).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cd=rd.ceil,Dd=a.clearTimeout,Ed=rd.floor,Fd=qd.prototype.toString,Gd=jb(Gd=td.getPrototypeOf)&&Gd,Hd=yd.hasOwnProperty,Id=xd.push,Jd=a.setTimeout,Kd=xd.splice,Ld=xd.unshift,Md=function(){try{var a={},b=jb(b=td.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Nd=jb(Nd=td.create)&&Nd,Od=jb(Od=nd.isArray)&&Od,Pd=a.isFinite,Qd=a.isNaN,Rd=jb(Rd=td.keys)&&Rd,Sd=rd.max,Td=rd.min,Ud=a.parseInt,Vd=rd.random,Wd={};Wd[M]=nd,Wd[N]=od,Wd[O]=pd,Wd[P]=qd,Wd[R]=td,Wd[Q]=sd,Wd[S]=ud,Wd[T]=vd,c.prototype=b.prototype;var Xd=b.support={};Xd.funcDecomp=!jb(a.WinRTError)&&H.test(p),Xd.funcNames="string"==typeof qd.name,b.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:E,variable:"",imports:{_:b}},Nd||(s=function(){function b(){}return function(c){if(Eb(c)){b.prototype=c;var d=new b;b.prototype=null}return d||a.Object()}}());var Yd=Md?function(a,b){W.value=b,Md(a,"__bindData__",W)}:ad,Zd=Od||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==M||!1},$d=function(a){var b,c=a,d=[];if(!c)return d;if(!X[typeof a])return d;for(b in c)Hd.call(c,b)&&d.push(b);return d},_d=Rd?function(a){return Eb(a)?Rd(a):[]}:$d,ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},be=wb(ae),ce=ud("("+_d(be).join("|")+")","g"),de=ud("["+_d(ae).join("")+"]","g"),ee=function(a,b,c){var d,e=a,f=e;
if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=w(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&X[typeof e])for(var k=-1,l=X[typeof e]&&_d(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},fe=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&X[typeof e])for(var j=-1,k=X[typeof e]&&_d(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},ge=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!X[typeof e])return f;b=b&&"undefined"==typeof c?b:w(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},he=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!X[typeof e])return f;b=b&&"undefined"==typeof c?b:w(b,c,3);for(var g=-1,h=X[typeof e]&&_d(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},ie=Gd?function(a){if(!a||Ad.call(a)!=R)return!1;var b=a.valueOf,c=jb(b)&&(c=Gd(b))&&Gd(c);return c?a==c||Gd(a)==c:kb(a)}:kb,je=fb(function(a,b,c){Hd.call(a,c)?a[c]++:a[c]=1}),ke=fb(function(a,b,c){(Hd.call(a,c)?a[c]:a[c]=[]).push(b)}),le=fb(function(a,b,c){a[c]=b}),me=_b,ne=Vb,oe=jb(oe=pd.now)&&oe||function(){return(new pd).getTime()},pe=8==Ud(x+"08")?Ud:function(a,b){return Ud(Jb(a)?a.replace(F,""):a,b||0)};return b.after=Hc,b.assign=ee,b.at=Sb,b.bind=Ic,b.bindAll=Jc,b.bindKey=Kc,b.chain=id,b.compact=lc,b.compose=Lc,b.constant=Wc,b.countBy=je,b.create=pb,b.createCallback=Xc,b.curry=Mc,b.debounce=Nc,b.defaults=fe,b.defer=Oc,b.delay=Pc,b.difference=mc,b.filter=Vb,b.flatten=qc,b.forEach=Yb,b.forEachRight=Zb,b.forIn=ge,b.forInRight=sb,b.forOwn=he,b.forOwnRight=tb,b.functions=ub,b.groupBy=ke,b.indexBy=le,b.initial=sc,b.intersection=tc,b.invert=wb,b.invoke=$b,b.keys=_d,b.map=_b,b.mapValues=Lb,b.max=ac,b.memoize=Qc,b.merge=Mb,b.min=bc,b.omit=Nb,b.once=Rc,b.pairs=Ob,b.partial=Sc,b.partialRight=Tc,b.pick=Pb,b.pluck=me,b.property=bd,b.pull=wc,b.range=xc,b.reject=ec,b.remove=yc,b.rest=zc,b.shuffle=gc,b.sortBy=jc,b.tap=jd,b.throttle=Uc,b.times=fd,b.toArray=kc,b.transform=Qb,b.union=Bc,b.uniq=Cc,b.values=Rb,b.where=ne,b.without=Dc,b.wrap=Vc,b.xor=Ec,b.zip=Fc,b.zipObject=Gc,b.collect=_b,b.drop=zc,b.each=Yb,b.eachRight=Zb,b.extend=ee,b.methods=ub,b.object=Gc,b.select=Vb,b.tail=zc,b.unique=Cc,b.unzip=Fc,$c(b),b.clone=nb,b.cloneDeep=ob,b.contains=Tb,b.escape=Yc,b.every=Ub,b.find=Wb,b.findIndex=nc,b.findKey=qb,b.findLast=Xb,b.findLastIndex=oc,b.findLastKey=rb,b.has=vb,b.identity=Zc,b.indexOf=rc,b.isArguments=mb,b.isArray=Zd,b.isBoolean=xb,b.isDate=yb,b.isElement=zb,b.isEmpty=Ab,b.isEqual=Bb,b.isFinite=Cb,b.isFunction=Db,b.isNaN=Fb,b.isNull=Gb,b.isNumber=Hb,b.isObject=Eb,b.isPlainObject=ie,b.isRegExp=Ib,b.isString=Jb,b.isUndefined=Kb,b.lastIndexOf=vc,b.mixin=$c,b.noConflict=_c,b.noop=ad,b.now=oe,b.parseInt=pe,b.random=cd,b.reduce=cc,b.reduceRight=dc,b.result=dd,b.runInContext=p,b.size=hc,b.some=ic,b.sortedIndex=Ac,b.template=ed,b.unescape=gd,b.uniqueId=hd,b.all=Ub,b.any=ic,b.detect=Wb,b.findWhere=Wb,b.foldl=cc,b.foldr=dc,b.include=Tb,b.inject=cc,$c(function(){var a={};return he(b,function(c,d){b.prototype[d]||(a[d]=c)}),a}(),!1),b.first=pc,b.last=uc,b.sample=fc,b.take=pc,b.head=pc,he(b,function(a,d){var e="sample"!==d;b.prototype[d]||(b.prototype[d]=function(b,d){var f=this.__chain__,g=a(this.__wrapped__,b,d);return f||null!=b&&(!d||e&&"function"==typeof b)?new c(g,f):g})}),b.VERSION="2.4.1",b.prototype.chain=kd,b.prototype.toString=ld,b.prototype.value=md,b.prototype.valueOf=md,Yb(["join","pop","shift"],function(a){var d=xd[a];b.prototype[a]=function(){var a=this.__chain__,b=d.apply(this.__wrapped__,arguments);return a?new c(b,a):b}}),Yb(["push","reverse","sort","unshift"],function(a){var c=xd[a];b.prototype[a]=function(){return c.apply(this.__wrapped__,arguments),this}}),Yb(["concat","slice","splice"],function(a){var d=xd[a];b.prototype[a]=function(){return new c(d.apply(this.__wrapped__,arguments),this.__chain__)}}),b}var q,r=[],s=[],t=0,u=+new Date+"",v=75,w=40,x=" 	\f\n\r\u2028\u2029",y=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,B=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,D=/^\s*function[ \n\r\t]+\w/,E=/<%=([\s\S]+?)%>/g,F=RegExp("^["+x+"]*0+(?=.$)"),G=/($^)/,H=/\bthis\b/,I=/['\n\r\t\u2028\u2029\\]/g,J=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],K=0,L="[object Arguments]",M="[object Array]",N="[object Boolean]",O="[object Date]",P="[object Function]",Q="[object Number]",R="[object Object]",S="[object RegExp]",T="[object String]",U={};U[P]=!1,U[L]=U[M]=U[N]=U[O]=U[Q]=U[R]=U[S]=U[T]=!0;var V={leading:!1,maxWait:0,trailing:!1},W={configurable:!1,enumerable:!1,value:null,writable:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Y={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Z=X[typeof window]&&window||this,$=X[typeof c]&&c&&!c.nodeType&&c,_=X[typeof b]&&b&&!b.nodeType&&b,ab=_&&_.exports===$&&$,bb=X[typeof a]&&a;!bb||bb.global!==bb&&bb.window!==bb||(Z=bb);var cb=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Z._=cb,define(function(){return cb})):$&&_?ab?(_.exports=cb)._=cb:$._=cb:Z._=cb}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],69:[function(a,b){(function(c){function d(a){if(!(this instanceof d))return new d(a);var a=a||{};e.call(this),this.paused=!0,this.renderer=a.renderer||{},this.fps=a.fps||60,this.step=1/this.fps,this.setMaxListeners(a.maxListeners||0)}var e=a("events").EventEmitter,f=a("inherits");c||(c=window),function(){c.performance=c.performance||{},c.performance.now=function(){return c.performance.now||c.performance.webkitNow||c.performance.msNow||c.performance.mozNow||Date.now||function(){return+new Date}}(),c.requestAnimationFrame=function(){return c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.msRequestAnimationFrame||c.mozRequestAnimationFrame||function(a){return setTimeout(function(){var b=c.performance.now();a(b)},16)}}(),c.cancelAnimationFrame=function(){return c.cancelAnimationFrame||c.webkitCancelAnimationFrame||c.msCancelAnimationFrame||c.mozCancelAnimationFrame||function(a){clearTimeout(a)}}()}(),b.exports=d,f(d,e),d.prototype.start=function(){this.paused=!1,this.emit("start"),this.dt=0,this.time=null,this.accumulator=0;var a=this.timestamp();this.frame(a)},d.prototype.frame=function(a){if(!this.paused){for(this.dt=Math.min(1,(a-this.time)/1e3),this.time=a,this.accumulator+=this.dt;this.accumulator>=this.step;)this.update(this.step),this.accumulator-=this.step;this.draw(this.dt),c.requestAnimationFrame(this.frame.bind(this))}},d.prototype.end=function(){this.pause(),this.emit("end")},d.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},d.prototype.resume=function(){this.paused&&(this.start(),this.emit("resume"))},d.prototype.update=function(a){this.emit("update",a)},d.prototype.draw=function(a){this.emit("draw",this.renderer,a)},d.prototype.timestamp=function(){return c.performance&&c.performance.now?c.performance.now():(new Date).getTime()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:1,inherits:70}],70:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],71:[function(a,b){b.exports=a(68)},{"/home/mati/Documentos/pac/node_modules/class-extend/node_modules/lodash/dist/lodash.js":68}],72:[function(a,b,c){(function(){var a=this,d=d||{};d.WEBGL_RENDERER=0,d.CANVAS_RENDERER=1,d.VERSION="v2.0.0",d.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},d.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},d._UID=0,"undefined"!=typeof Float32Array?(d.Float32Array=Float32Array,d.Uint16Array=Uint16Array):(d.Float32Array=Array,d.Uint16Array=Array),d.INTERACTION_FREQUENCY=30,d.AUTO_PREVENT_DEFAULT=!0,d.PI_2=2*Math.PI,d.RAD_TO_DEG=180/Math.PI,d.DEG_TO_RAD=Math.PI/180,d.RETINA_PREFIX="@2x",d.dontSayHello=!1,d.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0},d.sayHello=function(a){if(!d.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var b=["%c %c %c Pixi.js "+d.VERSION+" - "+a+"  %c  %c  http://www.pixijs.com/  %c %c %c%c ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,b)}else window.console&&console.log("Pixi.js "+d.VERSION+" - http://www.pixijs.com/");d.dontSayHello=!0}},d.Point=function(a,b){this.x=a||0,this.y=b||0},d.Point.prototype.clone=function(){return new d.Point(this.x,this.y)},d.Point.prototype.set=function(a,b){this.x=a||0,this.y=b||(0!==b?this.x:0)},d.Point.prototype.constructor=d.Point,d.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},d.Rectangle.prototype.clone=function(){return new d.Rectangle(this.x,this.y,this.width,this.height)},d.Rectangle.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this.width){var d=this.y;if(b>=d&&b<=d+this.height)return!0}return!1},d.Rectangle.prototype.constructor=d.Rectangle,d.EmptyRectangle=new d.Rectangle(0,0,0,0),d.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),a[0]instanceof d.Point){for(var b=[],c=0,e=a.length;e>c;c++)b.push(a[c].x,a[c].y);a=b}this.closed=!0,this.points=a},d.Polygon.prototype.clone=function(){var a=this.points.slice();return new d.Polygon(a)},d.Polygon.prototype.contains=function(a,b){for(var c=!1,d=this.points.length/2,e=0,f=d-1;d>e;f=e++){var g=this.points[2*e],h=this.points[2*e+1],i=this.points[2*f],j=this.points[2*f+1],k=h>b!=j>b&&(i-g)*(b-h)/(j-h)+g>a;k&&(c=!c)}return c},d.Polygon.prototype.constructor=d.Polygon,d.Circle=function(a,b,c){this.x=a||0,this.y=b||0,this.radius=c||0},d.Circle.prototype.clone=function(){return new d.Circle(this.x,this.y,this.radius)},d.Circle.prototype.contains=function(a,b){if(this.radius<=0)return!1;var c=this.x-a,d=this.y-b,e=this.radius*this.radius;return c*=c,d*=d,e>=c+d},d.Circle.prototype.getBounds=function(){return new d.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},d.Circle.prototype.constructor=d.Circle,d.Ellipse=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},d.Ellipse.prototype.clone=function(){return new d.Ellipse(this.x,this.y,this.width,this.height)},d.Ellipse.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,1>=c+d},d.Ellipse.prototype.getBounds=function(){return new d.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},d.Ellipse.prototype.constructor=d.Ellipse,d.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},d.Matrix.prototype.fromArray=function(a){this.a=a[0],this.b=a[1],this.c=a[3],this.d=a[4],this.tx=a[2],this.ty=a[5]},d.Matrix.prototype.toArray=function(a){this.array||(this.array=new d.Float32Array(9));var b=this.array;return a?(b[0]=this.a,b[1]=this.b,b[2]=0,b[3]=this.c,b[4]=this.d,b[5]=0,b[6]=this.tx,b[7]=this.ty,b[8]=1):(b[0]=this.a,b[1]=this.c,b[2]=this.tx,b[3]=this.b,b[4]=this.d,b[5]=this.ty,b[6]=0,b[7]=0,b[8]=1),b},d.Matrix.prototype.apply=function(a,b){return b=b||new d.Point,b.x=this.a*a.x+this.c*a.y+this.tx,b.y=this.b*a.x+this.d*a.y+this.ty,b},d.Matrix.prototype.applyInverse=function(a,b){b=b||new d.Point;var c=1/(this.a*this.d+this.c*-this.b);return b.x=this.d*c*a.x+-this.c*c*a.y+(this.ty*this.c-this.tx*this.d)*c,b.y=this.a*c*a.y+-this.b*c*a.x+(-this.ty*this.a+this.tx*this.b)*c,b},d.Matrix.prototype.translate=function(a,b){return this.tx+=a,this.ty+=b,this},d.Matrix.prototype.scale=function(a,b){return this.a*=a,this.d*=b,this.c*=a,this.b*=b,this.tx*=a,this.ty*=b,this},d.Matrix.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;return this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b,this},d.Matrix.prototype.append=function(a){var b=this.a,c=this.b,d=this.c,e=this.d;return this.a=a.a*b+a.b*d,this.b=a.a*c+a.b*e,this.c=a.c*b+a.d*d,this.d=a.c*c+a.d*e,this.tx=a.tx*b+a.ty*d+this.tx,this.ty=a.tx*c+a.ty*e+this.ty,this},d.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},d.identityMatrix=new d.Matrix,d.DisplayObject=function(){this.position=new d.Point,this.scale=new d.Point(1,1),this.pivot=new d.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new d.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new d.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},d.DisplayObject.prototype.constructor=d.DisplayObject,Object.defineProperty(d.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(d.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}}),Object.defineProperty(d.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1),this._mask=a,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(d.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,e=0;e<d.length;e++)b.push(d[e]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}}),Object.defineProperty(d.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}}),d.DisplayObject.prototype.updateTransform=function(){var a,b,c,e,f,g,h=this.parent.worldTransform,i=this.worldTransform;this.rotation%d.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),a=this._cr*this.scale.x,b=this._sr*this.scale.x,c=-this._sr*this.scale.y,e=this._cr*this.scale.y,f=this.position.x,g=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*a+this.pivot.y*c,g-=this.pivot.x*b+this.pivot.y*e),i.a=a*h.a+b*h.c,i.b=a*h.b+b*h.d,i.c=c*h.a+e*h.c,i.d=c*h.b+e*h.d,i.tx=f*h.a+g*h.c+h.tx,i.ty=f*h.b+g*h.d+h.ty):(a=this.scale.x,e=this.scale.y,f=this.position.x-this.pivot.x*a,g=this.position.y-this.pivot.y*e,i.a=h.a*a,i.b=h.b*e,i.c=h.c*a,i.d=h.d*e,i.tx=f*h.a+g*h.c+h.tx,i.ty=f*h.b+g*h.d+h.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},d.DisplayObject.prototype.getBounds=function(a){return a=a,d.EmptyRectangle},d.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(d.identityMatrix)},d.DisplayObject.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0)},d.DisplayObject.prototype.generateTexture=function(a,b,c){var e=this.getLocalBounds(),f=new d.RenderTexture(0|e.width,0|e.height,c,b,a);return d.DisplayObject._tempMatrix.tx=-e.x,d.DisplayObject._tempMatrix.ty=-e.y,f.render(this,d.DisplayObject._tempMatrix),f},d.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},d.DisplayObject.prototype.toGlobal=function(a){return this.updateTransform(),this.worldTransform.apply(a)},d.DisplayObject.prototype.toLocal=function(a,b){return b&&(a=b.toGlobal(a)),this.updateTransform(),this.worldTransform.applyInverse(a)},d.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha,a.gl?d.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):d.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)},d.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var b=new d.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new d.Sprite(b),this._cachedSprite.worldTransform=this.worldTransform}var c=this._filters;this._filters=null,this._cachedSprite.filters=c,d.DisplayObject._tempMatrix.tx=-a.x,d.DisplayObject._tempMatrix.ty=-a.y,this._cachedSprite.texture.render(this,d.DisplayObject._tempMatrix),this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._filters=c,this._cacheAsBitmap=!0},d.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},d.DisplayObject.prototype._renderWebGL=function(a){a=a},d.DisplayObject.prototype._renderCanvas=function(a){a=a},d.DisplayObject._tempMatrix=new d.Matrix,Object.defineProperty(d.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(d.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),d.DisplayObjectContainer=function(){d.DisplayObject.call(this),this.children=[]},d.DisplayObjectContainer.prototype=Object.create(d.DisplayObject.prototype),d.DisplayObjectContainer.prototype.constructor=d.DisplayObjectContainer,Object.defineProperty(d.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var b=this.getLocalBounds().width;this.scale.x=0!==b?a/(b/this.scale.x):1,this._width=a}}),Object.defineProperty(d.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){var b=this.getLocalBounds().height;this.scale.y=0!==b?a/(b/this.scale.y):1,this._height=a}}),d.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)},d.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage),a;throw new Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length)},d.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a}},d.DisplayObjectContainer.prototype.getChildIndex=function(a){var b=this.children.indexOf(a);if(-1===b)throw new Error("The supplied DisplayObject must be a child of the caller");return b},d.DisplayObjectContainer.prototype.setChildIndex=function(a,b){if(0>b||b>=this.children.length)throw new Error("The supplied index is out of bounds");var c=this.getChildIndex(a);this.children.splice(c,1),this.children.splice(b,0,a)},d.DisplayObjectContainer.prototype.getChildAt=function(a){if(0>a||a>=this.children.length)throw new Error("getChildAt: Supplied index "+a+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[a]},d.DisplayObjectContainer.prototype.removeChild=function(a){var b=this.children.indexOf(a);return-1!==b?this.removeChildAt(b):void 0},d.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.stage&&b.removeStageReference(),b.parent=void 0,this.children.splice(a,1),b},d.DisplayObjectContainer.prototype.removeChildren=function(a,b){var c=a||0,d="number"==typeof b?b:this.children.length,e=d-c;if(e>0&&d>=e){for(var f=this.children.splice(c,e),g=0;g<f.length;g++){var h=f[g];this.stage&&h.removeStageReference(),h.parent=void 0}return f}if(0===e&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},d.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(d.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform()},d.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return d.EmptyRectangle;for(var a,b,c,e=1/0,f=1/0,g=-1/0,h=-1/0,i=!1,j=0,k=this.children.length;k>j;j++){var l=this.children[j];l.visible&&(i=!0,a=this.children[j].getBounds(),e=e<a.x?e:a.x,f=f<a.y?f:a.y,b=a.width+a.x,c=a.height+a.y,g=g>b?g:b,h=h>c?h:c)}if(!i)return d.EmptyRectangle;var m=this._bounds;return m.x=e,m.y=f,m.width=g-e,m.height=h-f,m},d.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=d.identityMatrix;for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateTransform();var e=this.getBounds();return this.worldTransform=a,e},d.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d.setStageReference(a)}},d.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;b>a;a++){var c=this.children[a];c.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},d.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b,c;if(this._mask||this._filters){for(this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),a.spriteBatch.start()}else for(b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},d.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d._renderCanvas(a)}this._mask&&a.maskManager.popMask(a)}},d.Sprite=function(a){d.DisplayObjectContainer.call(this),this.anchor=new d.Point,this.texture=a,this._width=0,this._height=0,this.tint=16777215,this.blendMode=d.blendModes.NORMAL,this.shader=null,a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.on("update",this.onTextureUpdateBind)),this.renderable=!0},d.Sprite.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Sprite.prototype.constructor=d.Sprite,Object.defineProperty(d.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(d.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),d.Sprite.prototype.setTexture=function(a){this.texture=a,this.cachedTint=16777215},d.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},d.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),e=b*-this.anchor.x,f=c*(1-this.anchor.y),g=c*-this.anchor.y,h=a||this.worldTransform,i=h.a,j=h.c,k=h.b,l=h.d,m=h.tx,n=h.ty,o=i*e+k*g+m,p=l*g+j*e+n,q=i*d+k*g+m,r=l*g+j*d+n,s=i*d+k*f+m,t=l*f+j*d+n,u=i*e+k*f+m,v=l*f+j*e+n,w=-1/0,x=-1/0,y=1/0,z=1/0;y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,z=z>p?p:z,z=z>r?r:z,z=z>t?t:z,z=z>v?v:z,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,x=p>x?p:x,x=r>x?r:x,x=t>x?t:x,x=v>x?v:x;var A=this._bounds;return A.x=y,A.width=w-y,A.y=z,A.height=x-z,this._currentBounds=A,A},d.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),d.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);d.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},d.Sprite.prototype._renderCanvas=function(a){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=d.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var b=this.texture.baseTexture.resolution/a.resolution;a.context.globalAlpha=this.worldAlpha,a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0):a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===d.scaleModes.LINEAR);var c=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,e=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=d.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,c/b,e/b,this.texture.crop.width/b,this.texture.crop.height/b)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c/b,e/b,this.texture.crop.width/b,this.texture.crop.height/b)}for(var f=0,g=this.children.length;g>f;f++)this.children[f]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},d.Sprite.fromFrame=function(a){var b=d.TextureCache[a];if(!b)throw new Error('The frameId "'+a+'" does not exist in the texture cache'+this);return new d.Sprite(b)},d.Sprite.fromImage=function(a,b,c){var e=d.Texture.fromImage(a,b,c);return new d.Sprite(e)},d.SpriteBatch=function(a){d.DisplayObjectContainer.call(this),this.textureThing=a,this.ready=!1},d.SpriteBatch.prototype=Object.create(d.DisplayObjectContainer.prototype),d.SpriteBatch.prototype.constructor=d.SpriteBatch,d.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new d.WebGLFastSpriteBatch(a),this.ready=!0},d.SpriteBatch.prototype.updateTransform=function(){d.DisplayObject.prototype.updateTransform.call(this)},d.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())},d.SpriteBatch.prototype._renderCanvas=function(a){if(this.visible&&!(this.alpha<=0)&&this.children.length){var b=a.context;b.globalAlpha=this.worldAlpha,d.DisplayObject.prototype.updateTransform.call(this);for(var c=this.worldTransform,e=!0,f=0;f<this.children.length;f++){var g=this.children[f];if(g.visible){var h=g.texture,i=h.frame;if(b.globalAlpha=this.worldAlpha*g.alpha,g.rotation%(2*Math.PI)===0)e&&(b.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),e=!1),b.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width*g.scale.x+g.position.x+.5|0,g.anchor.y*-i.height*g.scale.y+g.position.y+.5|0,i.width*g.scale.x,i.height*g.scale.y);else{e||(e=!0),d.DisplayObject.prototype.updateTransform.call(g);var j=g.worldTransform;a.roundPixels?b.setTransform(j.a,j.b,j.c,j.d,0|j.tx,0|j.ty):b.setTransform(j.a,j.b,j.c,j.d,j.tx,j.ty),b.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width+.5|0,g.anchor.y*-i.height+.5|0,i.width,i.height)}}}}},d.MovieClip=function(a){d.Sprite.call(this,a[0]),this.textures=a,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},d.MovieClip.prototype=Object.create(d.Sprite.prototype),d.MovieClip.prototype.constructor=d.MovieClip,Object.defineProperty(d.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),d.MovieClip.prototype.stop=function(){this.playing=!1},d.MovieClip.prototype.play=function(){this.playing=!0},d.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1,this.currentFrame=a;var b=this.currentFrame+.5|0;this.setTexture(this.textures[b%this.textures.length])},d.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a,this.playing=!0},d.MovieClip.prototype.updateTransform=function(){if(d.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var a=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},d.MovieClip.fromFrames=function(a){for(var b=[],c=0;c<a.length;c++)b.push(new d.Texture.fromFrame(a[c]));return new d.MovieClip(b)},d.MovieClip.fromImages=function(a){for(var b=[],c=0;c<a.length;c++)b.push(new d.Texture.fromImage(a[c]));return new d.MovieClip(b)},d.FilterBlock=function(){this.visible=!0,this.renderable=!0},d.FilterBlock.prototype.constructor=d.FilterBlock,d.Text=function(a,b){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,d.Sprite.call(this,d.Texture.fromCanvas(this.canvas)),this.setText(a),this.setStyle(b)},d.Text.prototype=Object.create(d.Sprite.prototype),d.Text.prototype.constructor=d.Text,Object.defineProperty(d.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(d.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),d.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,a.dropShadow=a.dropShadow||!1,a.dropShadowAngle=a.dropShadowAngle||Math.PI/6,a.dropShadowDistance=a.dropShadowDistance||4,a.dropShadowColor=a.dropShadowColor||"black",this.style=a,this.dirty=!0},d.Text.prototype.setText=function(a){this.text=a.toString()||" ",this.dirty=!0
},d.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],d=0,e=this.determineFontProperties(this.style.font),f=0;f<b.length;f++){var g=this.context.measureText(b[f]).width;c[f]=g,d=Math.max(d,g)}var h=d+this.style.strokeThickness;this.style.dropShadow&&(h+=this.style.dropShadowDistance),this.canvas.width=(h+this.context.lineWidth)*this.resolution;var i=e.fontSize+this.style.strokeThickness,j=i*b.length;this.style.dropShadow&&(j+=this.style.dropShadowDistance),this.canvas.height=j*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin="round";var k,l;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var m=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(f=0;f<b.length;f++)k=this.style.strokeThickness/2,l=this.style.strokeThickness/2+f*i+e.ascent,"right"===this.style.align?k+=d-c[f]:"center"===this.style.align&&(k+=(d-c[f])/2),this.style.fill&&this.context.fillText(b[f],k+m,l+n)}for(this.context.fillStyle=this.style.fill,f=0;f<b.length;f++)k=this.style.strokeThickness/2,l=this.style.strokeThickness/2+f*i+e.ascent,"right"===this.style.align?k+=d-c[f]:"center"===this.style.align&&(k+=(d-c[f])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[f],k,l),this.style.fill&&this.context.fillText(b[f],k,l);this.updateTexture()},d.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},d.Text.prototype._renderWebGL=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1),d.Sprite.prototype._renderWebGL.call(this,a)},d.Text.prototype._renderCanvas=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1),d.Sprite.prototype._renderCanvas.call(this,a)},d.Text.prototype.determineFontProperties=function(a){var b=d.Text.fontPropertiesCache[a];if(!b){b={};var c=d.Text.fontPropertiesCanvas,e=d.Text.fontPropertiesContext;e.font=a;var f=Math.ceil(e.measureText("|Mq").width),g=Math.ceil(e.measureText("M").width),h=2*g;g=1.4*g|0,c.width=f,c.height=h,e.fillStyle="#f00",e.fillRect(0,0,f,h),e.font=a,e.textBaseline="alphabetic",e.fillStyle="#000",e.fillText("|Mq",0,g);var i,j,k=e.getImageData(0,0,f,h).data,l=k.length,m=4*f,n=0,o=!1;for(i=0;g>i;i++){for(j=0;m>j;j+=4)if(255!==k[n+j]){o=!0;break}if(o)break;n+=m}for(b.ascent=g-i,n=l-m,o=!1,i=h;i>g;i--){for(j=0;m>j;j+=4)if(255!==k[n+j]){o=!0;break}if(o)break;n-=m}b.descent=i-g,b.fontSize=b.ascent+b.descent,d.Text.fontPropertiesCache[a]=b}return b},d.Text.prototype.wordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;0===g||i>e?(g>0&&(b+="\n"),b+=f[g],e=this.style.wordWrapWidth-h):(e-=i,b+=" "+f[g])}d<c.length-1&&(b+="\n")}return b},d.Text.prototype.destroy=function(a){this.context=null,this.canvas=null,this.texture.destroy(void 0===a?!0:a)},d.Text.fontPropertiesCache={},d.Text.fontPropertiesCanvas=document.createElement("canvas"),d.Text.fontPropertiesContext=d.Text.fontPropertiesCanvas.getContext("2d"),d.BitmapText=function(a,b){d.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(a),this.setStyle(b),this.updateText(),this.dirty=!1},d.BitmapText.prototype=Object.create(d.DisplayObjectContainer.prototype),d.BitmapText.prototype.constructor=d.BitmapText,d.BitmapText.prototype.setText=function(a){this.text=a||" ",this.dirty=!0},d.BitmapText.prototype.setStyle=function(a){a=a||{},a.align=a.align||"left",this.style=a;var b=a.font.split(" ");this.fontName=b[b.length-1],this.fontSize=b.length>=2?parseInt(b[b.length-2],10):d.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=a.tint},d.BitmapText.prototype.updateText=function(){for(var a=d.BitmapText.fonts[this.fontName],b=new d.Point,c=null,e=[],f=0,g=[],h=0,i=this.fontSize/a.size,j=0;j<this.text.length;j++){var k=this.text.charCodeAt(j);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(j)))g.push(b.x),f=Math.max(f,b.x),h++,b.x=0,b.y+=a.lineHeight,c=null;else{var l=a.chars[k];l&&(c&&l.kerning[c]&&(b.x+=l.kerning[c]),e.push({texture:l.texture,line:h,charCode:k,position:new d.Point(b.x+l.xOffset,b.y+l.yOffset)}),b.x+=l.xAdvance,c=k)}}g.push(b.x),f=Math.max(f,b.x);var m=[];for(j=0;h>=j;j++){var n=0;"right"===this.style.align?n=f-g[j]:"center"===this.style.align&&(n=(f-g[j])/2),m.push(n)}var o=this.children.length,p=e.length,q=this.tint||16777215;for(j=0;p>j;j++){var r=o>j?this.children[j]:this._pool.pop();r?r.setTexture(e[j].texture):r=new d.Sprite(e[j].texture),r.position.x=(e[j].position.x+m[e[j].line])*i,r.position.y=e[j].position.y*i,r.scale.x=r.scale.y=i,r.tint=q,r.parent||this.addChild(r)}for(;this.children.length>p;){var s=this.getChildAt(this.children.length-1);this._pool.push(s),this.removeChild(s)}this.textWidth=f*i,this.textHeight=(b.y+a.lineHeight)*i},d.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),d.DisplayObjectContainer.prototype.updateTransform.call(this)},d.BitmapText.fonts={},d.InteractionData=function(){this.global=new d.Point,this.target=null,this.originalEvent=null},d.InteractionData.prototype.getLocalPosition=function(a,b){var c=a.worldTransform,e=this.global,f=c.a,g=c.b,h=c.tx,i=c.c,j=c.d,k=c.ty,l=1/(f*j+g*-i);return b=b||new d.Point,b.x=j*l*e.x+-g*l*e.y+(k*g-h*j)*l,b.y=f*l*e.y+-i*l*e.x+(-k*f+h*i)*l,b},d.InteractionData.prototype.constructor=d.InteractionData,d.InteractionManager=function(a){this.stage=a,this.mouse=new d.InteractionData,this.touches={},this.tempPoint=new d.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1},d.InteractionManager.prototype.constructor=d.InteractionManager,d.InteractionManager.prototype.collectInteractiveSprite=function(a,b){for(var c=a.children,d=c.length,e=d-1;e>=0;e--){var f=c[e];f._interactive?(b.interactiveChildren=!0,this.interactiveItems.push(f),f.children.length>0&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,f.children.length>0&&this.collectInteractiveSprite(f,b))}},d.InteractionManager.prototype.setTarget=function(a){this.target=a,this.resolution=a.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(a.view)},d.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents(),window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none"),this.interactionDOMElement=a,a.addEventListener("mousemove",this.onMouseMove,!0),a.addEventListener("mousedown",this.onMouseDown,!0),a.addEventListener("mouseout",this.onMouseOut,!0),a.addEventListener("touchstart",this.onTouchStart,!0),a.addEventListener("touchend",this.onTouchEnd,!0),a.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},d.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},d.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),b=a-this.last;if(b=b*d.INTERACTION_FREQUENCY/1e3,!(1>b)){this.last=a;var c=0;this.dirty&&this.rebuildInteractiveGraph();var e=this.interactiveItems.length,f="inherit",g=!1;for(c=0;e>c;c++){var h=this.interactiveItems[c];h.__hit=this.hitTest(h,this.mouse),this.mouse.target=h,h.__hit&&!g?(h.buttonMode&&(f=h.defaultCursor),h.interactiveChildren||(g=!0),h.__isOver||(h.mouseover&&h.mouseover(this.mouse),h.__isOver=!0)):h.__isOver&&(h.mouseout&&h.mouseout(this.mouse),h.__isOver=!1)}this.currentCursorStyle!==f&&(this.currentCursorStyle=f,this.interactionDOMElement.style.cursor=f)}}},d.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var a=this.interactiveItems.length,b=0;a>b;b++)this.interactiveItems[b].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},d.InteractionManager.prototype.onMouseMove=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a;var b=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(a.clientX-b.left)*(this.target.width/b.width)/this.resolution,this.mouse.global.y=(a.clientY-b.top)*(this.target.height/b.height)/this.resolution;for(var c=this.interactiveItems.length,d=0;c>d;d++){var e=this.interactiveItems[d];e.mousemove&&e.mousemove(this.mouse)}},d.InteractionManager.prototype.onMouseDown=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a,d.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var b=this.interactiveItems.length,c=this.mouse.originalEvent,e=2===c.button||3===c.which,f=e?"rightdown":"mousedown",g=e?"rightclick":"click",h=e?"__rightIsDown":"__mouseIsDown",i=e?"__isRightDown":"__isDown",j=0;b>j;j++){var k=this.interactiveItems[j];if((k[f]||k[g])&&(k[h]=!0,k.__hit=this.hitTest(k,this.mouse),k.__hit&&(k[f]&&k[f](this.mouse),k[i]=!0,!k.interactiveChildren)))break}},d.InteractionManager.prototype.onMouseOut=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a;var b=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var c=0;b>c;c++){var d=this.interactiveItems[c];d.__isOver&&(this.mouse.target=d,d.mouseout&&d.mouseout(this.mouse),d.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},d.InteractionManager.prototype.onMouseUp=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a;for(var b=this.interactiveItems.length,c=!1,d=this.mouse.originalEvent,e=2===d.button||3===d.which,f=e?"rightup":"mouseup",g=e?"rightclick":"click",h=e?"rightupoutside":"mouseupoutside",i=e?"__isRightDown":"__isDown",j=0;b>j;j++){var k=this.interactiveItems[j];(k[g]||k[f]||k[h])&&(k.__hit=this.hitTest(k,this.mouse),k.__hit&&!c?(k[f]&&k[f](this.mouse),k[i]&&k[g]&&k[g](this.mouse),k.interactiveChildren||(c=!0)):k[i]&&k[h]&&k[h](this.mouse),k[i]=!1)}},d.InteractionManager.prototype.hitTest=function(a,b){var c=b.global;if(!a.worldVisible)return!1;var e,f=a.worldTransform,g=f.a,h=f.b,i=f.c,j=f.tx,k=f.d,l=f.ty,m=1/(g*k+i*-h),n=k*m*c.x+-i*m*c.y+(l*i-j*k)*m,o=g*m*c.y+-h*m*c.x+(-l*g+j*h)*m;if(b.target=a,a.hitArea&&a.hitArea.contains)return a.hitArea.contains(n,o)?(b.target=a,!0):!1;if(a instanceof d.Sprite){var p,q=a.texture.frame.width,r=a.texture.frame.height,s=-q*a.anchor.x;if(n>s&&s+q>n&&(p=-r*a.anchor.y,o>p&&p+r>o))return b.target=a,!0}else if(a instanceof d.Graphics){var t=a.graphicsData;for(e=0;e<t.length;e++){var u=t[e];if(u.fill&&u.shape&&u.shape.contains(n,o))return b.target=a,!0}}var v=a.children.length;for(e=0;v>e;e++){var w=a.children[e],x=this.hitTest(w,b);if(x)return b.target=a,!0}return!1},d.InteractionManager.prototype.onTouchMove=function(a){this.dirty&&this.rebuildInteractiveGraph();var b,c=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,e=0;for(e=0;e<d.length;e++){var f=d[e];b=this.touches[f.identifier],b.originalEvent=a,b.global.x=(f.clientX-c.left)*(this.target.width/c.width)/this.resolution,b.global.y=(f.clientY-c.top)*(this.target.height/c.height)/this.resolution,!navigator.isCocoonJS||c.left||c.top||a.target.style.width||a.target.style.height||(b.global.x=f.clientX,b.global.y=f.clientY);for(var g=0;g<this.interactiveItems.length;g++){var h=this.interactiveItems[g];h.touchmove&&h.__touchData&&h.__touchData[f.identifier]&&h.touchmove(b)}}},d.InteractionManager.prototype.onTouchStart=function(a){this.dirty&&this.rebuildInteractiveGraph();var b=this.interactionDOMElement.getBoundingClientRect();d.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var c=a.changedTouches,e=0;e<c.length;e++){var f=c[e],g=this.pool.pop();g||(g=new d.InteractionData),g.originalEvent=a,this.touches[f.identifier]=g,g.global.x=(f.clientX-b.left)*(this.target.width/b.width)/this.resolution,g.global.y=(f.clientY-b.top)*(this.target.height/b.height)/this.resolution,!navigator.isCocoonJS||b.left||b.top||a.target.style.width||a.target.style.height||(g.global.x=f.clientX,g.global.y=f.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i];if((j.touchstart||j.tap)&&(j.__hit=this.hitTest(j,g),j.__hit&&(j.touchstart&&j.touchstart(g),j.__isDown=!0,j.__touchData=j.__touchData||{},j.__touchData[f.identifier]=g,!j.interactiveChildren)))break}}},d.InteractionManager.prototype.onTouchEnd=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,d=0;d<c.length;d++){var e=c[d],f=this.touches[e.identifier],g=!1;f.global.x=(e.clientX-b.left)*(this.target.width/b.width)/this.resolution,f.global.y=(e.clientY-b.top)*(this.target.height/b.height)/this.resolution,!navigator.isCocoonJS||b.left||b.top||a.target.style.width||a.target.style.height||(f.global.x=e.clientX,f.global.y=e.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i];j.__touchData&&j.__touchData[e.identifier]&&(j.__hit=this.hitTest(j,j.__touchData[e.identifier]),f.originalEvent=a,(j.touchend||j.tap)&&(j.__hit&&!g?(j.touchend&&j.touchend(f),j.__isDown&&j.tap&&j.tap(f),j.interactiveChildren||(g=!0)):j.__isDown&&j.touchendoutside&&j.touchendoutside(f),j.__isDown=!1),j.__touchData[e.identifier]=null)}this.pool.push(f),this.touches[e.identifier]=null}},d.Stage=function(a){d.DisplayObjectContainer.call(this),this.worldTransform=new d.Matrix,this.interactive=!0,this.interactionManager=new d.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new d.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(a)},d.Stage.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Stage.prototype.constructor=d.Stage,d.Stage.prototype.setInteractionDelegate=function(a){this.interactionManager.setTargetDomElement(a)},d.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},d.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0,this.backgroundColorSplit=d.hex2rgb(this.backgroundColor);var b=this.backgroundColor.toString(16);b="000000".substr(0,6-b.length)+b,this.backgroundColorString="#"+b},d.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(a){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(function(){c(d+e)},e);return b=d+e,f}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)}),a.requestAnimFrame=a.requestAnimationFrame}(this),d.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},d.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(a){function b(){for(var d=arguments.length,f=new Array(d);d--;)f[d]=arguments[d];return f=e.concat(f),c.apply(this instanceof b?this:a,f)}var c=this,d=arguments.length-1,e=[];if(d>0)for(e.length=d;d--;)e[d]=arguments[d+1];if("function"!=typeof c)throw new TypeError;return b.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(c.prototype),b}}()),d.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}},d.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var a=document.createElement("canvas");a.width=1,a.height=1;var b=a.getContext("2d");return b.fillStyle="#000",b.fillRect(0,0,1,1),b.globalCompositeOperation="multiply",b.fillStyle="#fff",b.fillRect(0,0,1,1),0===b.getImageData(0,0,1,1).data[0]},d.getNextPowerOfTwo=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b},d.EventTarget={call:function(a){a&&(a=a.prototype||a,d.EventTarget.mixin(a))},mixin:function(a){a.listeners=function(a){return this._listeners=this._listeners||{},this._listeners[a]?this._listeners[a].slice():[]},a.emit=a.dispatchEvent=function(a,b){if(this._listeners=this._listeners||{},"object"==typeof a&&(b=a,a=a.type),b&&b.__isEventObject===!0||(b=new d.Event(this,a,b)),this._listeners&&this._listeners[a]){var c,e=this._listeners[a],f=e.length,g=e[0];for(c=0;f>c;g=e[++c])if(g.call(this,b),b.stoppedImmediate)return this;if(b.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,a,b),this},a.on=a.addEventListener=function(a,b){return this._listeners=this._listeners||{},(this._listeners[a]=this._listeners[a]||[]).push(b),this},a.once=function(a,b){function c(){b.apply(d.off(a,c),arguments)}this._listeners=this._listeners||{};var d=this;return c._originalHandler=b,this.on(a,c)},a.off=a.removeEventListener=function(a,b){if(this._listeners=this._listeners||{},!this._listeners[a])return this;for(var c=this._listeners[a],d=b?c.length:0;d-->0;)(c[d]===b||c[d]._originalHandler===b)&&c.splice(d,1);return 0===c.length&&delete this._listeners[a],this},a.removeAllListeners=function(a){return this._listeners=this._listeners||{},this._listeners[a]?(delete this._listeners[a],this):this}}},d.Event=function(a,b,c){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=a,this.type=b,this.data=c,this.content=c,this.timeStamp=Date.now()},d.Event.prototype.stopPropagation=function(){this.stopped=!0},d.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},d.autoDetectRenderer=function(a,b,c){a||(a=800),b||(b=600);var e=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}();return e?new d.WebGLRenderer(a,b,c):new d.CanvasRenderer(a,b,c)},d.autoDetectRecommendedRenderer=function(a,b,c){a||(a=800),b||(b=600);var e=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),f=/Android/i.test(navigator.userAgent);return e&&!f?new d.WebGLRenderer(a,b,c):new d.CanvasRenderer(a,b,c)},d.PolyK={},d.PolyK.Triangulate=function(a){var b=!0,c=a.length>>1;if(3>c)return[];for(var e=[],f=[],g=0;c>g;g++)f.push(g);g=0;for(var h=c;h>3;){var i=f[(g+0)%h],j=f[(g+1)%h],k=f[(g+2)%h],l=a[2*i],m=a[2*i+1],n=a[2*j],o=a[2*j+1],p=a[2*k],q=a[2*k+1],r=!1;if(d.PolyK._convex(l,m,n,o,p,q,b)){r=!0;for(var s=0;h>s;s++){var t=f[s];if(t!==i&&t!==j&&t!==k&&d.PolyK._PointInTriangle(a[2*t],a[2*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)e.push(i,j,k),f.splice((g+1)%h,1),h--,g=0;else if(g++>3*h){if(!b)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(e=[],f=[],g=0;c>g;g++)f.push(g);g=0,h=c,b=!1}}return e.push(f[0],f[1],f[2]),e},d.PolyK._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},d.PolyK._convex=function(a,b,c,d,e,f,g){return(b-d)*(e-c)+(c-a)*(f-d)>=0===g},d.initDefaultShaders=function(){},d.CompileVertexShader=function(a,b){return d._CompileShader(a,b,a.VERTEX_SHADER)},d.CompileFragmentShader=function(a,b){return d._CompileShader(a,b,a.FRAGMENT_SHADER)},d._CompileShader=function(a,b,c){var d=b.join("\n"),e=a.createShader(c);return a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)?e:(window.console.log(a.getShaderInfoLog(e)),null)},d.compileProgram=function(a,b,c){var e=d.CompileFragmentShader(a,c),f=d.CompileVertexShader(a,b),g=a.createProgram();return a.attachShader(g,f),a.attachShader(g,e),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),g},d.PixiShader=function(a){this._UID=d._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},d.PixiShader.prototype.constructor=d.PixiShader,d.PixiShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc||d.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var c in this.uniforms)this.uniforms[c].uniformLocation=a.getUniformLocation(b,c);this.initUniforms(),this.program=b},d.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms){a=this.uniforms[c];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=b.uniformMatrix2fv:"mat3"===d?a.glFunc=b.uniformMatrix3fv:"mat4"===d&&(a.glFunc=b.uniformMatrix4fv)):(a.glFunc=b["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}},d.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,e=c.minFilter?c.minFilter:b.LINEAR,f=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?c.wrapT:b.CLAMP_TO_EDGE,h=c.luminance?b.LUMINANCE:b.RGBA;if(c.repeat&&(f=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width){var i=c.width?c.width:512,j=c.height?c.height:2,k=c.border?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount),a._init=!0,this.textureCount++}},d.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms)a=this.uniforms[c],1===a.glValueLength?a.glMatrix===!0?a.glFunc.call(b,a.uniformLocation,a.transpose,a.value):a.glFunc.call(b,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(b.activeTexture(b["TEXTURE"+this.textureCount]),a.value.baseTexture._dirty[b.id]?d.defaultRenderer.updateTexture(a.value.baseTexture):b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),b.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))},d.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},d.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],d.PixiFastShader=function(a){this._UID=d._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},d.PixiFastShader.prototype.constructor=d.PixiFastShader,d.PixiFastShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.uMatrix=a.getUniformLocation(b,"uMatrix"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(b,"aPositionCoord"),this.aScale=a.getAttribLocation(b,"aScale"),this.aRotation=a.getAttribLocation(b,"aRotation"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=b},d.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},d.StripShader=function(a){this._UID=d._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},d.StripShader.prototype.constructor=d.StripShader,d.StripShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.colorAttribute=a.getAttribLocation(b,"aColor"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},d.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},d.PrimitiveShader=function(a){this._UID=d._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},d.PrimitiveShader.prototype.constructor=d.PrimitiveShader,d.PrimitiveShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.tintColor=a.getUniformLocation(b,"tint"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(b,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},d.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},d.ComplexPrimitiveShader=function(a){this._UID=d._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()
},d.ComplexPrimitiveShader.prototype.constructor=d.ComplexPrimitiveShader,d.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.tintColor=a.getUniformLocation(b,"tint"),this.color=a.getUniformLocation(b,"color"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},d.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},d.WebGLGraphics=function(){},d.WebGLGraphics.renderGraphics=function(a,b){var c,e=b.gl,f=b.projection,g=b.offset,h=b.shaderManager.primitiveShader;a.dirty&&d.WebGLGraphics.updateGraphics(a,e);for(var i=a._webGL[e.id],j=0;j<i.data.length;j++)1===i.data[j].mode?(c=i.data[j],b.stencilManager.pushStencil(a,c,b),e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,2*(c.indices.length-4)),b.stencilManager.popStencil(a,c,b)):(c=i.data[j],b.shaderManager.setShader(h),h=b.shaderManager.primitiveShader,e.uniformMatrix3fv(h.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(h.projectionVector,f.x,-f.y),e.uniform2f(h.offsetVector,-g.x,-g.y),e.uniform3fv(h.tintColor,d.hex2rgb(a.tint)),e.uniform1f(h.alpha,a.worldAlpha),e.bindBuffer(e.ARRAY_BUFFER,c.buffer),e.vertexAttribPointer(h.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(h.colorAttribute,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c.indexBuffer),e.drawElements(e.TRIANGLE_STRIP,c.indices.length,e.UNSIGNED_SHORT,0))},d.WebGLGraphics.updateGraphics=function(a,b){var c=a._webGL[b.id];c||(c=a._webGL[b.id]={lastIndex:0,data:[],gl:b}),a.dirty=!1;var e;if(a.clearDirty){for(a.clearDirty=!1,e=0;e<c.data.length;e++){var f=c.data[e];f.reset(),d.WebGLGraphics.graphicsDataPool.push(f)}c.data=[],c.lastIndex=0}var g;for(e=c.lastIndex;e<a.graphicsData.length;e++){var h=a.graphicsData[e];h.type===d.Graphics.POLY?(h.points=h.shape.points.slice(),h.shape.closed&&h.points[0]!==h.points[h.points.length-2]&&h.points[1]!==h.points[h.points.length-1]&&h.points.push(h.points[0],h.points[1]),h.fill&&h.points.length>=6&&(h.points.length>10?(g=d.WebGLGraphics.switchMode(c,1),d.WebGLGraphics.buildComplexPoly(h,g)):(g=d.WebGLGraphics.switchMode(c,0),d.WebGLGraphics.buildPoly(h,g))),h.lineWidth>0&&(g=d.WebGLGraphics.switchMode(c,0),d.WebGLGraphics.buildLine(h,g))):(g=d.WebGLGraphics.switchMode(c,0),h.type===d.Graphics.RECT?d.WebGLGraphics.buildRectangle(h,g):h.type===d.Graphics.CIRC||h.type===d.Graphics.ELIP?d.WebGLGraphics.buildCircle(h,g):h.type===d.Graphics.RREC&&d.WebGLGraphics.buildRoundedRectangle(h,g)),c.lastIndex++}for(e=0;e<c.data.length;e++)g=c.data[e],g.dirty&&g.upload()},d.WebGLGraphics.switchMode=function(a,b){var c;return a.data.length?(c=a.data[a.data.length-1],(c.mode!==b||1===b)&&(c=d.WebGLGraphics.graphicsDataPool.pop()||new d.WebGLGraphicsData(a.gl),c.mode=b,a.data.push(c))):(c=d.WebGLGraphics.graphicsDataPool.pop()||new d.WebGLGraphicsData(a.gl),c.mode=b,a.data.push(c)),c.dirty=!0,c},d.WebGLGraphics.buildRectangle=function(a,b){var c=a.shape,e=c.x,f=c.y,g=c.width,h=c.height;if(a.fill){var i=d.hex2rgb(a.fillColor),j=a.fillAlpha,k=i[0]*j,l=i[1]*j,m=i[2]*j,n=b.points,o=b.indices,p=n.length/6;n.push(e,f),n.push(k,l,m,j),n.push(e+g,f),n.push(k,l,m,j),n.push(e,f+h),n.push(k,l,m,j),n.push(e+g,f+h),n.push(k,l,m,j),o.push(p,p,p+1,p+2,p+3,p+3)}if(a.lineWidth){var q=a.points;a.points=[e,f,e+g,f,e+g,f+h,e,f+h,e,f],d.WebGLGraphics.buildLine(a,b),a.points=q}},d.WebGLGraphics.buildRoundedRectangle=function(a,b){var c=a.shape.points,e=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=[];if(j.push(e,f+i),j=j.concat(d.WebGLGraphics.quadraticBezierCurve(e,f+h-i,e,f+h,e+i,f+h)),j=j.concat(d.WebGLGraphics.quadraticBezierCurve(e+g-i,f+h,e+g,f+h,e+g,f+h-i)),j=j.concat(d.WebGLGraphics.quadraticBezierCurve(e+g,f+i,e+g,f,e+g-i,f)),j=j.concat(d.WebGLGraphics.quadraticBezierCurve(e+i,f,e,f,e,f+i)),a.fill){var k=d.hex2rgb(a.fillColor),l=a.fillAlpha,m=k[0]*l,n=k[1]*l,o=k[2]*l,p=b.points,q=b.indices,r=p.length/6,s=d.PolyK.Triangulate(j),t=0;for(t=0;t<s.length;t+=3)q.push(s[t]+r),q.push(s[t]+r),q.push(s[t+1]+r),q.push(s[t+2]+r),q.push(s[t+2]+r);for(t=0;t<j.length;t++)p.push(j[t],j[++t],m,n,o,l)}if(a.lineWidth){var u=a.points;a.points=j,d.WebGLGraphics.buildLine(a,b),a.points=u}},d.WebGLGraphics.quadraticBezierCurve=function(a,b,c,d,e,f){function g(a,b,c){var d=b-a;return a+d*c}for(var h,i,j,k,l,m,n=20,o=[],p=0,q=0;n>=q;q++)p=q/n,h=g(a,c,p),i=g(b,d,p),j=g(c,e,p),k=g(d,f,p),l=g(h,j,p),m=g(i,k,p),o.push(l,m);return o},d.WebGLGraphics.buildCircle=function(a,b){var c,e,f=a.shape,g=f.x,h=f.y;a.type===d.Graphics.CIRC?(c=f.radius,e=f.radius):(c=f.width,e=f.height);var i=40,j=2*Math.PI/i,k=0;if(a.fill){var l=d.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=b.points,r=b.indices,s=q.length/6;for(r.push(s),k=0;i+1>k;k++)q.push(g,h,n,o,p,m),q.push(g+Math.sin(j*k)*c,h+Math.cos(j*k)*e,n,o,p,m),r.push(s++,s++);r.push(s-1)}if(a.lineWidth){var t=a.points;for(a.points=[],k=0;i+1>k;k++)a.points.push(g+Math.sin(j*k)*c,h+Math.cos(j*k)*e);d.WebGLGraphics.buildLine(a,b),a.points=t}},d.WebGLGraphics.buildLine=function(a,b){var c=0,e=a.points;if(0!==e.length){if(a.lineWidth%2)for(c=0;c<e.length;c++)e[c]+=.5;var f=new d.Point(e[0],e[1]),g=new d.Point(e[e.length-2],e[e.length-1]);if(f.x===g.x&&f.y===g.y){e=e.slice(),e.pop(),e.pop(),g=new d.Point(e[e.length-2],e[e.length-1]);var h=g.x+.5*(f.x-g.x),i=g.y+.5*(f.y-g.y);e.unshift(h,i),e.push(h,i)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=b.points,H=b.indices,I=e.length/2,J=e.length,K=G.length/6,L=a.lineWidth/2,M=d.hex2rgb(a.lineColor),N=a.lineAlpha,O=M[0]*N,P=M[1]*N,Q=M[2]*N;for(l=e[0],m=e[1],n=e[2],o=e[3],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(l-r,m-s,O,P,Q,N),G.push(l+r,m+s,O,P,Q,N),c=1;I-1>c;c++)l=e[2*(c-1)],m=e[2*(c-1)+1],n=e[2*c],o=e[2*c+1],p=e[2*(c+1)],q=e[2*(c+1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,t=-(o-q),u=n-p,F=Math.sqrt(t*t+u*u),t/=F,u/=F,t*=L,u*=L,x=-s+m-(-s+o),y=-r+n-(-r+l),z=(-r+l)*(-s+o)-(-r+n)*(-s+m),A=-u+q-(-u+o),B=-t+n-(-t+p),C=(-t+p)*(-u+o)-(-t+n)*(-u+q),D=x*B-A*y,Math.abs(D)<.1?(D+=10.1,G.push(n-r,o-s,O,P,Q,N),G.push(n+r,o+s,O,P,Q,N)):(j=(y*C-B*z)/D,k=(A*z-x*C)/D,E=(j-n)*(j-n)+(k-o)+(k-o),E>19600?(v=r-t,w=s-u,F=Math.sqrt(v*v+w*w),v/=F,w/=F,v*=L,w*=L,G.push(n-v,o-w),G.push(O,P,Q,N),G.push(n+v,o+w),G.push(O,P,Q,N),G.push(n-v,o-w),G.push(O,P,Q,N),J++):(G.push(j,k),G.push(O,P,Q,N),G.push(n-(j-n),o-(k-o)),G.push(O,P,Q,N)));for(l=e[2*(I-2)],m=e[2*(I-2)+1],n=e[2*(I-1)],o=e[2*(I-1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(n-r,o-s),G.push(O,P,Q,N),G.push(n+r,o+s),G.push(O,P,Q,N),H.push(K),c=0;J>c;c++)H.push(K++);H.push(K-1)}},d.WebGLGraphics.buildComplexPoly=function(a,b){var c=a.points.slice();if(!(c.length<6)){var e=b.indices;b.points=c,b.alpha=a.fillAlpha,b.color=d.hex2rgb(a.fillColor);for(var f,g,h=1/0,i=-1/0,j=1/0,k=-1/0,l=0;l<c.length;l+=2)f=c[l],g=c[l+1],h=h>f?f:h,i=f>i?f:i,j=j>g?g:j,k=g>k?g:k;c.push(h,j,i,j,i,k,h,k);var m=c.length/2;for(l=0;m>l;l++)e.push(l)}},d.WebGLGraphics.buildPoly=function(a,b){var c=a.points;if(!(c.length<6)){var e=b.points,f=b.indices,g=c.length/2,h=d.hex2rgb(a.fillColor),i=a.fillAlpha,j=h[0]*i,k=h[1]*i,l=h[2]*i,m=d.PolyK.Triangulate(c),n=e.length/6,o=0;for(o=0;o<m.length;o+=3)f.push(m[o]+n),f.push(m[o]+n),f.push(m[o+1]+n),f.push(m[o+2]+n),f.push(m[o+2]+n);for(o=0;g>o;o++)e.push(c[2*o],c[2*o+1],j,k,l,i)}},d.WebGLGraphics.graphicsDataPool=[],d.WebGLGraphicsData=function(a){this.gl=a,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},d.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},d.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW),this.dirty=!1},d.glContexts=[],d.WebGLRenderer=function(a,b,c){if(c)for(var e in d.defaultRenderOptions)"undefined"==typeof c[e]&&(c[e]=d.defaultRenderOptions[e]);else c=d.defaultRenderOptions;d.defaultRenderer||(d.sayHello("webGL"),d.defaultRenderer=this),this.type=d.WEBGL_RENDERER,this.resolution=c.resolution,this.transparent=c.transparent,this.preserveDrawingBuffer=c.preserveDrawingBuffer,this.clearBeforeRender=c.clearBeforeRender,this.width=a||800,this.height=b||600,this.view=c.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:c.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:c.preserveDrawingBuffer},this.projection=new d.Point,this.offset=new d.Point(0,0),this.shaderManager=new d.WebGLShaderManager,this.spriteBatch=new d.WebGLSpriteBatch,this.maskManager=new d.WebGLMaskManager,this.filterManager=new d.WebGLFilterManager,this.stencilManager=new d.WebGLStencilManager,this.blendModeManager=new d.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},d.WebGLRenderer.prototype.constructor=d.WebGLRenderer,d.WebGLRenderer.prototype.initContext=function(){var a=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=a,!a)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=a.id=d.WebGLRenderer.glContextId++,d.glContexts[this.glContextId]=a,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),a.enable(a.BLEND),this.shaderManager.setContext(a),this.spriteBatch.setContext(a),this.maskManager.setContext(a),this.filterManager.setContext(a),this.blendModeManager.setContext(a),this.stencilManager.setContext(a),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},d.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a),a.updateTransform();var b=this.gl;a._interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this)),b.viewport(0,0,this.width,this.height),b.bindFramebuffer(b.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),b.clear(b.COLOR_BUFFER_BIT)),this.renderDisplayObject(a,this.projection)}},d.WebGLRenderer.prototype.renderDisplayObject=function(a,b,c){this.renderSession.blendModeManager.setBlendMode(d.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.projection=b,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,c),a._renderWebGL(this.renderSession),this.spriteBatch.end()},d.WebGLRenderer.prototype.resize=function(a,b){this.width=a*this.resolution,this.height=b*this.resolution,this.view.width=this.width,this.view.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},d.WebGLRenderer.prototype.updateTexture=function(a){if(a.hasLoaded){var b=this.gl;return a._glTextures[b.id]||(a._glTextures[b.id]=b.createTexture()),b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===d.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===d.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),a._dirty[b.id]=!1,a._glTextures[b.id]}},d.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault(),this.contextLost=!0},d.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var a in d.TextureCache){var b=d.TextureCache[a].baseTexture;b._glTextures=[]}this.contextLost=!1},d.WebGLRenderer.prototype.destroy=function(){this.view.off("webglcontextlost",this.contextLostBound),this.view.off("webglcontextrestored",this.contextRestoredBound),d.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},d.WebGLRenderer.prototype.mapBlendModes=function(){var a=this.gl;d.blendModesWebGL||(d.blendModesWebGL=[],d.blendModesWebGL[d.blendModes.NORMAL]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.ADD]=[a.SRC_ALPHA,a.DST_ALPHA],d.blendModesWebGL[d.blendModes.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.SCREEN]=[a.SRC_ALPHA,a.ONE],d.blendModesWebGL[d.blendModes.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.COLOR_BURN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.COLOR]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA])},d.WebGLRenderer.glContextId=0,d.WebGLBlendModeManager=function(){this.currentBlendMode=99999},d.WebGLBlendModeManager.prototype.constructor=d.WebGLBlendModeManager,d.WebGLBlendModeManager.prototype.setContext=function(a){this.gl=a},d.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;var b=d.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(b[0],b[1]),!0},d.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},d.WebGLMaskManager=function(){},d.WebGLMaskManager.prototype.constructor=d.WebGLMaskManager,d.WebGLMaskManager.prototype.setContext=function(a){this.gl=a},d.WebGLMaskManager.prototype.pushMask=function(a,b){var c=b.gl;a.dirty&&d.WebGLGraphics.updateGraphics(a,c),a._webGL[c.id].data.length&&b.stencilManager.pushStencil(a,a._webGL[c.id].data[0],b)},d.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)},d.WebGLMaskManager.prototype.destroy=function(){this.gl=null},d.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},d.WebGLStencilManager.prototype.setContext=function(a){this.gl=a},d.WebGLStencilManager.prototype.pushStencil=function(a,b,c){var d=this.gl;this.bindGraphics(a,b,c),0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(b);var e=this.count;d.colorMask(!1,!1,!1,!1),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),1===b.mode?(d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(e+1),255):d.stencilFunc(d.EQUAL,e+1,255),this.reverse=!this.reverse):(this.reverse?(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e+1,255):d.stencilFunc(d.EQUAL,255-(e+1),255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),this.count++},d.WebGLStencilManager.prototype.bindGraphics=function(a,b,c){this._currentGraphics=a;var e,f=this.gl,g=c.projection,h=c.offset;1===b.mode?(e=c.shaderManager.complexPrimitiveShader,c.shaderManager.setShader(e),f.uniformMatrix3fv(e.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(e.projectionVector,g.x,-g.y),f.uniform2f(e.offsetVector,-h.x,-h.y),f.uniform3fv(e.tintColor,d.hex2rgb(a.tint)),f.uniform3fv(e.color,b.color),f.uniform1f(e.alpha,a.worldAlpha*b.alpha),f.bindBuffer(f.ARRAY_BUFFER,b.buffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,8,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.indexBuffer)):(e=c.shaderManager.primitiveShader,c.shaderManager.setShader(e),f.uniformMatrix3fv(e.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(e.projectionVector,g.x,-g.y),f.uniform2f(e.offsetVector,-h.x,-h.y),f.uniform3fv(e.tintColor,d.hex2rgb(a.tint)),f.uniform1f(e.alpha,a.worldAlpha),f.bindBuffer(f.ARRAY_BUFFER,b.buffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,24,0),f.vertexAttribPointer(e.colorAttribute,4,f.FLOAT,!1,24,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.indexBuffer))},d.WebGLStencilManager.prototype.popStencil=function(a,b,c){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var e=this.count;this.bindGraphics(a,b,c),d.colorMask(!1,!1,!1,!1),1===b.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)):(this.reverse?(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}},d.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},d.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var a=0;a<this.maxAttibs;a++)this.attribState[a]=!1;this.stack=[]},d.WebGLShaderManager.prototype.constructor=d.WebGLShaderManager,d.WebGLShaderManager.prototype.setContext=function(a){this.gl=a,this.primitiveShader=new d.PrimitiveShader(a),this.complexPrimitiveShader=new d.ComplexPrimitiveShader(a),this.defaultShader=new d.PixiShader(a),this.fastShader=new d.PixiFastShader(a),this.stripShader=new d.StripShader(a),this.setShader(this.defaultShader)},d.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++){var c=a[b];this.tempAttribState[c]=!0}var d=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?d.enableVertexAttribArray(b):d.disableVertexAttribArray(b))},d.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)},d.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},d.WebGLSpriteBatch=function(){this.vertSize=6,this.size=2e3;var a=4*this.size*this.vertSize,b=6*this.size;this.vertices=new Float32Array(a),this.indices=new Uint16Array(b),this.lastIndexCount=0;for(var c=0,e=0;b>c;c+=6,e+=4)this.indices[c+0]=e+0,this.indices[c+1]=e+1,this.indices[c+2]=e+2,this.indices[c+3]=e+0,this.indices[c+4]=e+2,this.indices[c+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new d.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},d.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999;var b=new d.PixiShader(a);b.fragmentSrc=this.defaultShader.fragmentSrc,b.uniforms={},b.init(),this.defaultShader.shaders[a.id]=b},d.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},d.WebGLSpriteBatch.prototype.end=function(){this.flush()},d.WebGLSpriteBatch.prototype.render=function(a){var b=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=b.baseTexture);var c=b._uvs;if(c){var d,e,f,g,h=a.worldAlpha,i=a.tint,j=this.vertices,k=a.anchor.x,l=a.anchor.y;if(b.trim){var m=b.trim;e=m.x-k*m.width,d=e+b.crop.width,g=m.y-l*m.height,f=g+b.crop.height}else d=b.frame.width*(1-k),e=b.frame.width*-k,f=b.frame.height*(1-l),g=b.frame.height*-l;var n=4*this.currentBatchSize*this.vertSize,o=b.baseTexture.resolution,p=a.worldTransform,q=p.a/o,r=p.b/o,s=p.c/o,t=p.d/o,u=p.tx,v=p.ty;j[n++]=q*e+s*g+u,j[n++]=t*g+r*e+v,j[n++]=c.x0,j[n++]=c.y0,j[n++]=h,j[n++]=i,j[n++]=q*d+s*g+u,j[n++]=t*g+r*d+v,j[n++]=c.x1,j[n++]=c.y1,j[n++]=h,j[n++]=i,j[n++]=q*d+s*f+u,j[n++]=t*f+r*d+v,j[n++]=c.x2,j[n++]=c.y2,j[n++]=h,j[n++]=i,j[n++]=q*e+s*f+u,j[n++]=t*f+r*e+v,j[n++]=c.x3,j[n++]=c.y3,j[n++]=h,j[n++]=i,this.sprites[this.currentBatchSize++]=a}},d.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var b=a.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=b.baseTexture),a._uvs||(a._uvs=new d.TextureUvs);var c=a._uvs;a.tilePosition.x%=b.baseTexture.width*a.tileScaleOffset.x,a.tilePosition.y%=b.baseTexture.height*a.tileScaleOffset.y;var e=a.tilePosition.x/(b.baseTexture.width*a.tileScaleOffset.x),f=a.tilePosition.y/(b.baseTexture.height*a.tileScaleOffset.y),g=a.width/b.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),h=a.height/b.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);c.x0=0-e,c.y0=0-f,c.x1=1*g-e,c.y1=0-f,c.x2=1*g-e,c.y2=1*h-f,c.x3=0-e,c.y3=1*h-f;var i=a.worldAlpha,j=a.tint,k=this.vertices,l=a.width,m=a.height,n=a.anchor.x,o=a.anchor.y,p=l*(1-n),q=l*-n,r=m*(1-o),s=m*-o,t=4*this.currentBatchSize*this.vertSize,u=b.baseTexture.resolution,v=a.worldTransform,w=v.a/u,x=v.b/u,y=v.c/u,z=v.d/u,A=v.tx,B=v.ty;k[t++]=w*q+y*s+A,k[t++]=z*s+x*q+B,k[t++]=c.x0,k[t++]=c.y0,k[t++]=i,k[t++]=j,k[t++]=w*p+y*s+A,k[t++]=z*s+x*p+B,k[t++]=c.x1,k[t++]=c.y1,k[t++]=i,k[t++]=j,k[t++]=w*p+y*r+A,k[t++]=z*r+x*p+B,k[t++]=c.x2,k[t++]=c.y2,k[t++]=i,k[t++]=j,k[t++]=w*q+y*r+A,k[t++]=z*r+x*q+B,k[t++]=c.x3,k[t++]=c.y3,k[t++]=i,k[t++]=j,this.sprites[this.currentBatchSize++]=a},d.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a,b=this.gl;if(this.dirty){this.dirty=!1,b.activeTexture(b.TEXTURE0),b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a=this.defaultShader.shaders[b.id];var c=4*this.vertSize;b.vertexAttribPointer(a.aVertexPosition,2,b.FLOAT,!1,c,0),b.vertexAttribPointer(a.aTextureCoord,2,b.FLOAT,!1,c,8),b.vertexAttribPointer(a.colorAttribute,2,b.FLOAT,!1,c,16)}if(this.currentBatchSize>.5*this.size)b.bufferSubData(b.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);b.bufferSubData(b.ARRAY_BUFFER,0,e)}for(var f,g,h,i,j=0,k=0,l=null,m=this.renderSession.blendModeManager.currentBlendMode,n=null,o=!1,p=!1,q=0,r=this.currentBatchSize;r>q;q++){if(i=this.sprites[q],f=i.texture.baseTexture,g=i.blendMode,h=i.shader||this.defaultShader,o=m!==g,p=n!==h,(l!==f||o||p)&&(this.renderBatch(l,j,k),k=q,j=0,l=f,o&&(m=g,this.renderSession.blendModeManager.setBlendMode(m)),p)){n=h,a=n.shaders[b.id],a||(a=new d.PixiShader(b),a.fragmentSrc=n.fragmentSrc,a.uniforms=n.uniforms,a.init(),n.shaders[b.id]=a),this.renderSession.shaderManager.setShader(a),a.dirty&&a.syncUniforms();var s=this.renderSession.projection;b.uniform2f(a.projectionVector,s.x,s.y);var t=this.renderSession.offset;b.uniform2f(a.offsetVector,t.x,t.y)}j++}this.renderBatch(l,j,k),this.currentBatchSize=0}},d.WebGLSpriteBatch.prototype.renderBatch=function(a,b,c){if(0!==b){var d=this.gl;a._dirty[d.id]?this.renderSession.renderer.updateTexture(a):d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]),d.drawElements(d.TRIANGLES,6*b,d.UNSIGNED_SHORT,6*c*2),this.renderSession.drawCount++}},d.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},d.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},d.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},d.WebGLFastSpriteBatch=function(a){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var b=4*this.size*this.vertSize,c=6*this.maxSize;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},d.WebGLFastSpriteBatch.prototype.constructor=d.WebGLFastSpriteBatch,d.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)},d.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},d.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},d.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children,c=b[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture,c.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(c.blendMode));for(var d=0,e=b.length;e>d;d++)this.renderSprite(b[d]);this.flush()}},d.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var b,c,d,e,f,g,h,i,j=this.vertices;if(b=a.texture._uvs,c=a.texture.frame.width,d=a.texture.frame.height,a.texture.trim){var k=a.texture.trim;f=k.x-a.anchor.x*k.width,e=f+a.texture.crop.width,h=k.y-a.anchor.y*k.height,g=h+a.texture.crop.height}else e=a.texture.frame.width*(1-a.anchor.x),f=a.texture.frame.width*-a.anchor.x,g=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y;i=4*this.currentBatchSize*this.vertSize,j[i++]=f,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x0,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x1,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x2,j[i++]=b.y2,j[i++]=a.alpha,j[i++]=f,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x3,j[i++]=b.y3,j[i++]=a.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},d.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},d.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},d.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,c,36)},d.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},d.WebGLFilterManager.prototype.constructor=d.WebGLFilterManager,d.WebGLFilterManager.prototype.setContext=function(a){this.gl=a,this.texturePool=[],this.initShaderBuffers()},d.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x,this.height=2*-c.y,this.buffer=b},d.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl,c=this.renderSession.projection,e=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds(),this.filterStack.push(a);
var f=a.filterPasses[0];this.offsetX+=a._filterArea.x,this.offsetY+=a._filterArea.y;var g=this.texturePool.pop();g?g.resize(this.width,this.height):g=new d.FilterTexture(this.gl,this.width,this.height),b.bindTexture(b.TEXTURE_2D,g.texture);var h=a._filterArea,i=f.padding;h.x-=i,h.y-=i,h.width+=2*i,h.height+=2*i,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),b.bindFramebuffer(b.FRAMEBUFFER,g.frameBuffer),b.viewport(0,0,h.width,h.height),c.x=h.width/2,c.y=-h.height/2,e.x=-h.x,e.y=-h.y,b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),a._glFilterTexture=g},d.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,b=this.filterStack.pop(),c=b._filterArea,e=b._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(b.filterPasses.length>1){a.viewport(0,0,c.width,c.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=c.height,this.vertexArray[2]=c.width,this.vertexArray[3]=c.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=c.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=c.width/this.width,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=e,i=this.texturePool.pop();i||(i=new d.FilterTexture(this.gl,this.width,this.height)),i.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<b.filterPasses.length-1;j++){var k=b.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(k,c,c.width,c.height);var l=h;h=i,i=l}a.enable(a.BLEND),e=h,this.texturePool.push(i)}var m=b.filterPasses[b.filterPasses.length-1];this.offsetX-=c.x,this.offsetY-=c.y;var n=this.width,o=this.height,p=0,q=0,r=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var s=this.filterStack[this.filterStack.length-1];c=s._filterArea,n=c.width,o=c.height,p=c.x,q=c.y,r=s._glFilterTexture.frameBuffer}f.x=n/2,f.y=-o/2,g.x=p,g.y=q,c=b._filterArea;var t=c.x-p,u=c.y-q;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=t,this.vertexArray[1]=u+c.height,this.vertexArray[2]=t+c.width,this.vertexArray[3]=u+c.height,this.vertexArray[4]=t,this.vertexArray[5]=u,this.vertexArray[6]=t+c.width,this.vertexArray[7]=u,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=c.width/this.width,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,n,o),a.bindFramebuffer(a.FRAMEBUFFER,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,e.texture),this.applyFilterPass(m,c,n,o),this.texturePool.push(e),b._glFilterTexture=null},d.WebGLFilterManager.prototype.applyFilterPass=function(a,b,c,e){var f=this.gl,g=a.shaders[f.id];g||(g=new d.PixiShader(f),g.fragmentSrc=a.fragmentSrc,g.uniforms=a.uniforms,g.init(),a.shaders[f.id]=g),this.renderSession.shaderManager.setShader(g),f.uniform2f(g.projectionVector,c/2,-e/2),f.uniform2f(g.offsetVector,0,0),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),g.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(g.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(g.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(g.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},d.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},d.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var b=0;b<this.texturePool.length;b++)this.texturePool[b].destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)},d.FilterTexture=function(a,b,c,e){this.gl=a,this.frameBuffer=a.createFramebuffer(),this.texture=a.createTexture(),e=e||d.scaleModes.DEFAULT,a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e===d.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e===d.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),this.renderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer),this.resize(b,c)},d.FilterTexture.prototype.constructor=d.FilterTexture,d.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},d.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a,this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a,b)}},d.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer),a.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},d.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},d.CanvasBuffer.prototype.constructor=d.CanvasBuffer,d.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},d.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b},d.CanvasMaskManager=function(){},d.CanvasMaskManager.prototype.constructor=d.CanvasMaskManager,d.CanvasMaskManager.prototype.pushMask=function(a,b){var c=b.context;c.save();var e=a.alpha,f=a.worldTransform,g=b.resolution;c.setTransform(f.a*g,f.b*g,f.c*g,f.d*g,f.tx*g,f.ty*g),d.CanvasGraphics.renderGraphicsMask(a,c),c.clip(),a.worldAlpha=e},d.CanvasMaskManager.prototype.popMask=function(a){a.context.restore()},d.CanvasTinter=function(){},d.CanvasTinter.getTintedTexture=function(a,b){var c=a.texture;b=d.CanvasTinter.roundColor(b);var e="#"+("00000"+(0|b).toString(16)).substr(-6);if(c.tintCache=c.tintCache||{},c.tintCache[e])return c.tintCache[e];var f=d.CanvasTinter.canvas||document.createElement("canvas");if(d.CanvasTinter.tintMethod(c,b,f),d.CanvasTinter.convertTintToImage){var g=new Image;g.src=f.toDataURL(),c.tintCache[e]=g}else c.tintCache[e]=f,d.CanvasTinter.canvas=null;return f},d.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext("2d"),e=a.crop;c.width=e.width,c.height=e.height,d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="multiply",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},d.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),e=a.crop;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},d.CanvasTinter.tintWithPerPixel=function(a,b,c){var e=c.getContext("2d"),f=a.crop;c.width=f.width,c.height=f.height,e.globalCompositeOperation="copy",e.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);for(var g=d.hex2rgb(b),h=g[0],i=g[1],j=g[2],k=e.getImageData(0,0,f.width,f.height),l=k.data,m=0;m<l.length;m+=4)l[m+0]*=h,l[m+1]*=i,l[m+2]*=j;e.putImageData(k,0,0)},d.CanvasTinter.roundColor=function(a){var b=d.CanvasTinter.cacheStepsPerColorChannel,c=d.hex2rgb(a);return c[0]=Math.min(255,c[0]/b*b),c[1]=Math.min(255,c[1]/b*b),c[2]=Math.min(255,c[2]/b*b),d.rgb2hex(c)},d.CanvasTinter.cacheStepsPerColorChannel=8,d.CanvasTinter.convertTintToImage=!1,d.CanvasTinter.canUseMultiply=d.canUseNewCanvasBlendModes(),d.CanvasTinter.tintMethod=d.CanvasTinter.canUseMultiply?d.CanvasTinter.tintWithMultiply:d.CanvasTinter.tintWithPerPixel,d.CanvasRenderer=function(a,b,c){if(c)for(var e in d.defaultRenderOptions)"undefined"==typeof c[e]&&(c[e]=d.defaultRenderOptions[e]);else c=d.defaultRenderOptions;d.defaultRenderer||(d.sayHello("Canvas"),d.defaultRenderer=this),this.type=d.CANVAS_RENDERER,this.resolution=c.resolution,this.clearBeforeRender=c.clearBeforeRender,this.transparent=c.transparent,this.width=a||800,this.height=b||600,this.width*=this.resolution,this.height*=this.resolution,this.view=c.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new d.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(a,b),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},d.CanvasRenderer.prototype.constructor=d.CanvasRenderer,d.CanvasRenderer.prototype.render=function(a){a.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=d.blendModes.NORMAL,this.context.globalCompositeOperation=d.blendModesCanvas[d.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(a),a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)))},d.CanvasRenderer.prototype.destroy=function(a){"undefined"==typeof a&&(a=!0),a&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},d.CanvasRenderer.prototype.resize=function(a,b){this.width=a*this.resolution,this.height=b*this.resolution,this.view.width=this.width,this.view.height=this.height,this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"},d.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context,this.renderSession.resolution=this.resolution,a._renderCanvas(this.renderSession)},d.CanvasRenderer.prototype.mapBlendModes=function(){d.blendModesCanvas||(d.blendModesCanvas=[],d.canUseNewCanvasBlendModes()?(d.blendModesCanvas[d.blendModes.NORMAL]="source-over",d.blendModesCanvas[d.blendModes.ADD]="lighter",d.blendModesCanvas[d.blendModes.MULTIPLY]="multiply",d.blendModesCanvas[d.blendModes.SCREEN]="screen",d.blendModesCanvas[d.blendModes.OVERLAY]="overlay",d.blendModesCanvas[d.blendModes.DARKEN]="darken",d.blendModesCanvas[d.blendModes.LIGHTEN]="lighten",d.blendModesCanvas[d.blendModes.COLOR_DODGE]="color-dodge",d.blendModesCanvas[d.blendModes.COLOR_BURN]="color-burn",d.blendModesCanvas[d.blendModes.HARD_LIGHT]="hard-light",d.blendModesCanvas[d.blendModes.SOFT_LIGHT]="soft-light",d.blendModesCanvas[d.blendModes.DIFFERENCE]="difference",d.blendModesCanvas[d.blendModes.EXCLUSION]="exclusion",d.blendModesCanvas[d.blendModes.HUE]="hue",d.blendModesCanvas[d.blendModes.SATURATION]="saturation",d.blendModesCanvas[d.blendModes.COLOR]="color",d.blendModesCanvas[d.blendModes.LUMINOSITY]="luminosity"):(d.blendModesCanvas[d.blendModes.NORMAL]="source-over",d.blendModesCanvas[d.blendModes.ADD]="lighter",d.blendModesCanvas[d.blendModes.MULTIPLY]="source-over",d.blendModesCanvas[d.blendModes.SCREEN]="source-over",d.blendModesCanvas[d.blendModes.OVERLAY]="source-over",d.blendModesCanvas[d.blendModes.DARKEN]="source-over",d.blendModesCanvas[d.blendModes.LIGHTEN]="source-over",d.blendModesCanvas[d.blendModes.COLOR_DODGE]="source-over",d.blendModesCanvas[d.blendModes.COLOR_BURN]="source-over",d.blendModesCanvas[d.blendModes.HARD_LIGHT]="source-over",d.blendModesCanvas[d.blendModes.SOFT_LIGHT]="source-over",d.blendModesCanvas[d.blendModes.DIFFERENCE]="source-over",d.blendModesCanvas[d.blendModes.EXCLUSION]="source-over",d.blendModesCanvas[d.blendModes.HUE]="source-over",d.blendModesCanvas[d.blendModes.SATURATION]="source-over",d.blendModesCanvas[d.blendModes.COLOR]="source-over",d.blendModesCanvas[d.blendModes.LUMINOSITY]="source-over"))},d.CanvasGraphics=function(){},d.CanvasGraphics.renderGraphics=function(a,b){for(var c=a.worldAlpha,e="",f=0;f<a.graphicsData.length;f++){var g=a.graphicsData[f],h=g.shape;if(b.strokeStyle=e="#"+("00000"+(0|g.lineColor).toString(16)).substr(-6),b.lineWidth=g.lineWidth,g.type===d.Graphics.POLY){b.beginPath();var i=h.points;b.moveTo(i[0],i[1]);for(var j=1;j<i.length/2;j++)b.lineTo(i[2*j],i[2*j+1]);h.closed&&b.lineTo(i[0],i[1]),i[0]===i[i.length-2]&&i[1]===i[i.length-1]&&b.closePath(),g.fill&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke())}else if(g.type===d.Graphics.RECT)(g.fillColor||0===g.fillColor)&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fillRect(h.x,h.y,h.width,h.height)),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.strokeRect(h.x,h.y,h.width,h.height));else if(g.type===d.Graphics.CIRC)b.beginPath(),b.arc(h.x,h.y,h.radius,0,2*Math.PI),b.closePath(),g.fill&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke());else if(g.type===d.Graphics.ELIP){var k=2*h.width,l=2*h.height,m=h.x-k/2,n=h.y-l/2;b.beginPath();var o=.5522848,p=k/2*o,q=l/2*o,r=m+k,s=n+l,t=m+k/2,u=n+l/2;b.moveTo(m,u),b.bezierCurveTo(m,u-q,t-p,n,t,n),b.bezierCurveTo(t+p,n,r,u-q,r,u),b.bezierCurveTo(r,u+q,t+p,s,t,s),b.bezierCurveTo(t-p,s,m,u+q,m,u),b.closePath(),g.fill&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke())}else if(g.type===d.Graphics.RREC){var v=h.points,w=v[0],x=v[1],y=v[2],z=v[3],A=v[4],B=Math.min(y,z)/2|0;A=A>B?B:A,b.beginPath(),b.moveTo(w,x+A),b.lineTo(w,x+z-A),b.quadraticCurveTo(w,x+z,w+A,x+z),b.lineTo(w+y-A,x+z),b.quadraticCurveTo(w+y,x+z,w+y,x+z-A),b.lineTo(w+y,x+A),b.quadraticCurveTo(w+y,x,w+y-A,x),b.lineTo(w+A,x),b.quadraticCurveTo(w,x,w,x+A),b.closePath(),(g.fillColor||0===g.fillColor)&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke())}}},d.CanvasGraphics.renderGraphicsMask=function(a,b){var c=a.graphicsData.length;if(0!==c){c>1&&(c=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var e=0;1>e;e++){var f=a.graphicsData[e],g=f.shape;if(f.type===d.Graphics.POLY){b.beginPath();var h=g.points;b.moveTo(h[0],h[1]);for(var i=1;i<h.length/2;i++)b.lineTo(h[2*i],h[2*i+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&b.closePath()}else if(f.type===d.Graphics.RECT)b.beginPath(),b.rect(g.x,g.y,g.width,g.height),b.closePath();else if(f.type===d.Graphics.CIRC)b.beginPath(),b.arc(g.x,g.y,g.radius,0,2*Math.PI),b.closePath();else if(f.type===d.Graphics.ELIP){var j=2*g.width,k=2*g.height,l=g.x-j/2,m=g.y-k/2;b.beginPath();var n=.5522848,o=j/2*n,p=k/2*n,q=l+j,r=m+k,s=l+j/2,t=m+k/2;b.moveTo(l,t),b.bezierCurveTo(l,t-p,s-o,m,s,m),b.bezierCurveTo(s+o,m,q,t-p,q,t),b.bezierCurveTo(q,t+p,s+o,r,s,r),b.bezierCurveTo(s-o,r,l,t+p,l,t),b.closePath()}else if(f.type===d.Graphics.RREC){var u=g.points,v=u[0],w=u[1],x=u[2],y=u[3],z=u[4],A=Math.min(x,y)/2|0;z=z>A?A:z,b.beginPath(),b.moveTo(v,w+z),b.lineTo(v,w+y-z),b.quadraticCurveTo(v,w+y,v+z,w+y),b.lineTo(v+x-z,w+y),b.quadraticCurveTo(v+x,w+y,v+x,w+y-z),b.lineTo(v+x,w+z),b.quadraticCurveTo(v+x,w,v+x-z,w),b.lineTo(v+z,w),b.quadraticCurveTo(v,w,v,w+z),b.closePath()}}}},d.Graphics=function(){d.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=d.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},d.Graphics.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Graphics.prototype.constructor=d.Graphics,Object.defineProperty(d.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),d.Graphics.prototype.lineStyle=function(a,b,c){if(this.lineWidth=a||0,this.lineColor=b||0,this.lineAlpha=arguments.length<3?1:c,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new d.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},d.Graphics.prototype.moveTo=function(a,b){return this.drawShape(new d.Polygon([a,b])),this},d.Graphics.prototype.lineTo=function(a,b){return this.currentPath.shape.points.push(a,b),this.dirty=!0,this},d.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var e,f,g=20,h=this.currentPath.shape.points;0===h.length&&this.moveTo(0,0);for(var i=h[h.length-2],j=h[h.length-1],k=0,l=1;g>=l;l++)k=l/g,e=i+(a-i)*k,f=j+(b-j)*k,h.push(e+(a+(c-a)*k-e)*k,f+(b+(d-b)*k-f)*k);return this.dirty=!0,this},d.Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var g,h,i,j,k,l=20,m=this.currentPath.shape.points,n=m[m.length-2],o=m[m.length-1],p=0,q=1;l>=q;q++)p=q/l,g=1-p,h=g*g,i=h*g,j=p*p,k=j*p,m.push(i*n+3*h*p*a+3*g*j*c+k*e,i*o+3*h*p*b+3*g*j*d+k*f);return this.dirty=!0,this},d.Graphics.prototype.arcTo=function(a,b,c,d,e){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[a,b]):this.moveTo(a,b),0===this.currentPath.length&&this.moveTo(a,b);var f=this.currentPath,g=f[f.length-2],h=f[f.length-1],i=h-b,j=g-a,k=d-b,l=c-a,m=Math.abs(i*l-j*k);if(1e-8>m||0===e)f.push(a,b);else{var n=i*i+j*j,o=k*k+l*l,p=i*k+j*l,q=e*Math.sqrt(n)/m,r=e*Math.sqrt(o)/m,s=q*p/n,t=r*p/o,u=q*l+r*j,v=q*k+r*i,w=j*(r+s),x=i*(r+s),y=l*(q+t),z=k*(q+t),A=Math.atan2(x-v,w-u),B=Math.atan2(z-v,y-u);this.arc(u+a,v+b,e,A,B,j*k>l*i)}return this.dirty=!0,this},d.Graphics.prototype.arc=function(a,b,c,d,e,f){var g=a+Math.cos(d)*c,h=b+Math.sin(d)*c,i=this.currentPath.shape.points;if((0!==i.length&&i[i.length-2]!==g||i[i.length-1]!==h)&&(this.moveTo(g,h),i=this.currentPath.shape.points),d===e)return this;!f&&d>=e?e+=2*Math.PI:f&&e>=d&&(d+=2*Math.PI);var j=f?-1*(d-e):e-d,k=Math.abs(j)/(2*Math.PI)*40;if(0===j)return this;for(var l=j/(2*k),m=2*l,n=Math.cos(l),o=Math.sin(l),p=k-1,q=p%1/p,r=0;p>=r;r++){var s=r+q*r,t=l+d+m*s,u=Math.cos(t),v=-Math.sin(t);i.push((n*u+o*v)*c+a,(n*-v+o*u)*c+b)}return this.dirty=!0,this},d.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=void 0===b?1:b,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},d.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},d.Graphics.prototype.drawRect=function(a,b,c,e){return this.drawShape(new d.Rectangle(a,b,c,e)),this},d.Graphics.prototype.drawRoundedRect=function(a,b,c,e,f){return this.drawShape({points:[a,b,c,e,f],type:d.Graphics.RREC}),this},d.Graphics.prototype.drawCircle=function(a,b,c){return this.drawShape(new d.Circle(a,b,c)),this},d.Graphics.prototype.drawEllipse=function(a,b,c,e){return this.drawShape(new d.Ellipse(a,b,c,e)),this},d.Graphics.prototype.drawPolygon=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments)),this.drawShape(new d.Polygon(a)),this},d.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},d.Graphics.prototype.generateTexture=function(a,b){a=a||1;var c=this.getBounds(),e=new d.CanvasBuffer(c.width*a,c.height*a),f=d.Texture.fromCanvas(e.canvas,b);return f.baseTexture.resolution=a,e.context.scale(a,a),e.context.translate(-c.x,-c.y),d.CanvasGraphics.renderGraphics(this,e.context),f},d.Graphics.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void d.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var b=d.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(b[0],b[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),d.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var c=0,e=this.children.length;e>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this.mask,a),a.drawCount++,a.spriteBatch.start()}},d.Graphics.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void d.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);var b=a.context,c=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=d.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a);var e=a.resolution;b.setTransform(c.a*e,c.b*e,c.c*e,c.d*e,c.tx*e,c.ty*e),d.CanvasGraphics.renderGraphics(this,b);for(var f=0,g=this.children.length;g>f;f++)this.children[f]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},d.Graphics.prototype.getBounds=function(a){this.dirty&&(this.updateBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var b=this._bounds,c=b.x,d=b.width+b.x,e=b.y,f=b.height+b.y,g=a||this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=n,w=o,x=n,y=o;return x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,b.x=x,b.width=v-x,b.y=y,b.height=w-y,b},d.Graphics.prototype.updateBounds=function(){var a=1/0,b=-1/0,c=1/0,e=-1/0;if(this.graphicsData.length)for(var f,g,h,i,j,k,l=0;l<this.graphicsData.length;l++){var m=this.graphicsData[l],n=m.type,o=m.lineWidth;if(f=m.shape,n===d.Graphics.RECT||n===d.Graphics.RRECT)h=f.x-o/2,i=f.y-o/2,j=f.width+o,k=f.height+o,a=a>h?h:a,b=h+j>b?h+j:b,c=c>i?i:c,e=i+k>e?i+k:e;else if(n===d.Graphics.CIRC)h=f.x,i=f.y,j=f.radius+o/2,k=f.radius+o/2,a=a>h-j?h-j:a,b=h+j>b?h+j:b,c=c>i-k?i-k:c,e=i+k>e?i+k:e;else if(n===d.Graphics.ELIP)h=f.x,i=f.y,j=f.width+o/2,k=f.height+o/2,a=a>h-j?h-j:a,b=h+j>b?h+j:b,c=c>i-k?i-k:c,e=i+k>e?i+k:e;else{g=f.points;for(var p=0;p<g.length;p+=2)h=g[p],i=g[p+1],a=a>h-o?h-o:a,b=h+o>b?h+o:b,c=c>i-o?i-o:c,e=i+o>e?i+o:e}}else a=0,b=0,c=0,e=0;var q=this.boundsPadding,r=this._bounds;r.x=a-q,r.width=b-a+2*q,r.y=c-q,r.height=e-c+2*q},d.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var b=new d.CanvasBuffer(a.width,a.height),c=d.Texture.fromCanvas(b.canvas);this._cachedSprite=new d.Sprite(c),this._cachedSprite.buffer=b,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._cachedSprite.buffer.context.translate(-a.x,-a.y),this.worldAlpha=1,d.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},d.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,b=a.texture,c=a.buffer.canvas;b.baseTexture.width=c.width,b.baseTexture.height=c.height,b.crop.width=b.frame.width=c.width,b.crop.height=b.frame.height=c.height,a._width=c.width,a._height=c.height,b.baseTexture.dirty()},d.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},d.Graphics.prototype.drawShape=function(a){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var b=new d.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);return this.graphicsData.push(b),b.type===d.Graphics.POLY&&(b.shape.closed=this.filling,this.currentPath=b),this.dirty=!0,b},d.GraphicsData=function(a,b,c,d,e,f,g){this.lineWidth=a,this.lineColor=b,this.lineAlpha=c,this.fillColor=d,this.fillAlpha=e,this.fill=f,this.shape=g,this.type=g.type},d.Graphics.POLY=0,d.Graphics.RECT=1,d.Graphics.CIRC=2,d.Graphics.ELIP=3,d.Graphics.RREC=4,d.Polygon.prototype.type=d.Graphics.POLY,d.Rectangle.prototype.type=d.Graphics.RECT,d.Circle.prototype.type=d.Graphics.CIRC,d.Ellipse.prototype.type=d.Graphics.ELIP,d.Strip=function(a){d.DisplayObjectContainer.call(this),this.texture=a,this.uvs=new d.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new d.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new d.Float32Array([1,1,1,1]),this.indices=new d.Uint16Array([0,1,2,3]),this.dirty=!0,this.padding=0},d.Strip.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Strip.prototype.constructor=d.Strip,d.Strip.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())},d.Strip.prototype._initWebGL=function(a){var b=a.gl;this._vertexBuffer=b.createBuffer(),this._indexBuffer=b.createBuffer(),this._uvBuffer=b.createBuffer(),this._colorBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.DYNAMIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._colorBuffer),b.bufferData(b.ARRAY_BUFFER,this.colors,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)},d.Strip.prototype._renderStrip=function(a){var b=a.gl,c=a.projection,d=a.offset,e=a.shaderManager.stripShader;b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),b.uniformMatrix3fv(e.translationMatrix,!1,this.worldTransform.toArray(!0)),b.uniform2f(e.projectionVector,c.x,-c.y),b.uniform2f(e.offsetVector,-d.x,-d.y),b.uniform1f(e.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.STATIC_DRAW),b.vertexAttribPointer(e.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.vertexAttribPointer(e.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),this.texture.baseTexture._dirty[b.id]?a.renderer.updateTexture(this.texture.baseTexture):b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)):(b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferSubData(b.ARRAY_BUFFER,0,this.verticies),b.vertexAttribPointer(e.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.vertexAttribPointer(e.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),this.texture.baseTexture._dirty[b.id]?a.renderer.updateTexture(this.texture.baseTexture):b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),b.drawElements(b.TRIANGLE_STRIP,this.indices.length,b.UNSIGNED_SHORT,0)},d.Strip.prototype._renderCanvas=function(a){var b=a.context,c=this.worldTransform;a.roundPixels?b.setTransform(c.a,c.b,c.c,c.d,0|c.tx,0|c.ty):b.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty);var d=this,e=d.verticies,f=d.uvs,g=e.length/2;this.count++;for(var h=0;g-2>h;h++){var i=2*h,j=e[i],k=e[i+2],l=e[i+4],m=e[i+1],n=e[i+3],o=e[i+5];if(this.padding>0){var p=(j+k+l)/3,q=(m+n+o)/3,r=j-p,s=m-q,t=Math.sqrt(r*r+s*s);j=p+r/t*(t+3),m=q+s/t*(t+3),r=k-p,s=n-q,t=Math.sqrt(r*r+s*s),k=p+r/t*(t+3),n=q+s/t*(t+3),r=l-p,s=o-q,t=Math.sqrt(r*r+s*s),l=p+r/t*(t+3),o=q+s/t*(t+3)}var u=f[i]*d.texture.width,v=f[i+2]*d.texture.width,w=f[i+4]*d.texture.width,x=f[i+1]*d.texture.height,y=f[i+3]*d.texture.height,z=f[i+5]*d.texture.height;b.save(),b.beginPath(),b.moveTo(j,m),b.lineTo(k,n),b.lineTo(l,o),b.closePath(),b.clip();var A=u*y+x*w+v*z-y*w-x*v-u*z,B=j*y+x*l+k*z-y*l-x*k-j*z,C=u*k+j*w+v*l-k*w-j*v-u*l,D=u*y*l+x*k*w+j*v*z-j*y*w-x*v*l-u*k*z,E=m*y+x*o+n*z-y*o-x*n-m*z,F=u*n+m*w+v*o-n*w-m*v-u*o,G=u*y*o+x*n*w+m*v*z-m*y*w-x*v*o-u*n*z;b.transform(B/A,E/A,C/A,F/A,D/A,G/A),b.drawImage(d.texture.baseTexture.source,0,0),b.restore()}},d.Strip.prototype.renderStripFlat=function(a){var b=this.context,c=a.verticies,d=c.length/2;
this.count++,b.beginPath();for(var e=1;d-2>e;e++){var f=2*e,g=c[f],h=c[f+2],i=c[f+4],j=c[f+1],k=c[f+3],l=c[f+5];b.moveTo(g,j),b.lineTo(h,k),b.lineTo(i,l)}b.fillStyle="#FF0000",b.fill(),b.closePath()},d.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},d.Rope=function(a,b){d.Strip.call(this,a),this.points=b,this.verticies=new d.Float32Array(4*b.length),this.uvs=new d.Float32Array(4*b.length),this.colors=new d.Float32Array(2*b.length),this.indices=new d.Uint16Array(2*b.length),this.refresh()},d.Rope.prototype=Object.create(d.Strip.prototype),d.Rope.prototype.constructor=d.Rope,d.Rope.prototype.refresh=function(){var a=this.points;if(!(a.length<1)){var b=this.uvs,c=a[0],d=this.indices,e=this.colors;this.count-=.2,b[0]=0,b[1]=0,b[2]=0,b[3]=1,e[0]=1,e[1]=1,d[0]=0,d[1]=1;for(var f,g,h,i=a.length,j=1;i>j;j++)f=a[j],g=4*j,h=j/(i-1),j%2?(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1):(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1),g=2*j,e[g]=1,e[g+1]=1,g=2*j,d[g]=g,d[g+1]=g+1,c=f}},d.Rope.prototype.updateTransform=function(){var a=this.points;if(!(a.length<1)){var b,c=a[0],e={x:0,y:0};this.count-=.2;for(var f,g,h,i,j,k=this.verticies,l=a.length,m=0;l>m;m++)f=a[m],g=4*m,b=m<a.length-1?a[m+1]:f,e.y=-(b.x-c.x),e.x=b.y-c.y,h=10*(1-m/(l-1)),h>1&&(h=1),i=Math.sqrt(e.x*e.x+e.y*e.y),j=this.texture.height/2,e.x/=i,e.y/=i,e.x*=j,e.y*=j,k[g]=f.x+e.x,k[g+1]=f.y+e.y,k[g+2]=f.x-e.x,k[g+3]=f.y-e.y,c=f;d.DisplayObjectContainer.prototype.updateTransform.call(this)}},d.Rope.prototype.setTexture=function(a){this.texture=a},d.TilingSprite=function(a,b,c){d.Sprite.call(this,a),this._width=b||100,this._height=c||100,this.tileScale=new d.Point(1,1),this.tileScaleOffset=new d.Point(1,1),this.tilePosition=new d.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=d.blendModes.NORMAL},d.TilingSprite.prototype=Object.create(d.Sprite.prototype),d.TilingSprite.prototype.constructor=d.TilingSprite,Object.defineProperty(d.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(d.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),d.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)},d.TilingSprite.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha){var b,c;for(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(d.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this._mask,a),a.spriteBatch.start()}},d.TilingSprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var b=a.context;this._mask&&a.maskManager.pushMask(this._mask,b),b.globalAlpha=this.worldAlpha;var c,e,f=this.worldTransform,g=a.resolution;if(b.setTransform(f.a*g,f.c*g,f.b*g,f.d*g,f.tx*g,f.ty*g),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=b.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=d.blendModesCanvas[a.currentBlendMode]);var h=this.tilePosition,i=this.tileScale;for(h.x%=this.tilingTexture.baseTexture.width,h.y%=this.tilingTexture.baseTexture.height,b.scale(i.x,i.y),b.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height),b.fillStyle=this.__tilePattern,b.fillRect(-h.x,-h.y,this._width/i.x,this._height/i.y),b.scale(1/i.x,1/i.y),b.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height),this._mask&&a.maskManager.popMask(a.context),c=0,e=this.children.length;e>c;c++)this.children[c]._renderCanvas(a)}},d.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),f=b*-this.anchor.y,g=this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=-1/0,w=-1/0,x=1/0,y=1/0;x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w;var z=this._bounds;return z.x=x,z.width=v-x,z.y=y,z.height=w-y,this._currentBounds=z,z},d.TilingSprite.prototype.onTextureUpdate=function(){},d.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var b,c,e=this.originalTexture||this.texture,f=e.frame,g=f.width!==e.baseTexture.width||f.height!==e.baseTexture.height,h=!1;if(a?(b=d.getNextPowerOfTwo(f.width),c=d.getNextPowerOfTwo(f.height),(f.width!==b||f.height!==c)&&(h=!0)):g&&(b=f.width,c=f.height,h=!0),h){var i;this.tilingTexture&&this.tilingTexture.isTiling?(i=this.tilingTexture.canvasBuffer,i.resize(b,c),this.tilingTexture.baseTexture.width=b,this.tilingTexture.baseTexture.height=c,this.tilingTexture.needsUpdate=!0):(i=new d.CanvasBuffer(b,c),this.tilingTexture=d.Texture.fromCanvas(i.canvas),this.tilingTexture.canvasBuffer=i,this.tilingTexture.isTiling=!0),i.context.drawImage(e.baseTexture.source,e.crop.x,e.crop.y,e.crop.width,e.crop.height,0,0,b,c),this.tileScaleOffset.x=f.width/b,this.tileScaleOffset.y=f.height/c}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=e;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}};var e={};e.BoneData=function(a,b){this.name=a,this.parent=b},e.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},e.SlotData=function(a,b){this.name=a,this.boneData=b},e.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},e.Bone=function(a,b){this.data=a,this.parent=b,this.setToSetupPose()},e.Bone.yDown=!1,e.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var c=this.parent;null!=c?(this.worldX=this.x*c.m00+this.y*c.m01+c.worldX,this.worldY=this.x*c.m10+this.y*c.m11+c.worldY,this.worldScaleX=c.worldScaleX*this.scaleX,this.worldScaleY=c.worldScaleY*this.scaleY,this.worldRotation=c.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,f=Math.cos(d),g=Math.sin(d);this.m00=f*this.worldScaleX,this.m10=g*this.worldScaleX,this.m01=-g*this.worldScaleY,this.m11=f*this.worldScaleY,a&&(this.m00=-this.m00,this.m01=-this.m01),b&&(this.m10=-this.m10,this.m11=-this.m11),e.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=this.data;this.x=a.x,this.y=a.y,this.rotation=a.rotation,this.scaleX=a.scaleX,this.scaleY=a.scaleY}},e.Slot=function(a,b,c){this.data=a,this.skeleton=b,this.bone=c,this.setToSetupPose()},e.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=this.data;this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a;for(var b=this.skeleton.data.slots,c=0,d=b.length;d>c;c++)if(b[c]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(c,a.attachmentName):null);break}}},e.Skin=function(a){this.name=a,this.attachments={}},e.Skin.prototype={addAttachment:function(a,b,c){this.attachments[a+":"+b]=c},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var c in b.attachments){var d=c.indexOf(":"),e=parseInt(c.substring(0,d),10),f=c.substring(d+1),g=a.slots[e];if(g.attachment&&g.attachment.name==f){var h=this.getAttachment(e,f);h&&g.setAttachment(h)}}}},e.Animation=function(a,b,c){this.name=a,this.timelines=b,this.duration=c},e.Animation.prototype={apply:function(a,b,c){c&&this.duration&&(b%=this.duration);for(var d=this.timelines,e=0,f=d.length;f>e;e++)d[e].apply(a,b,1)},mix:function(a,b,c,d){c&&this.duration&&(b%=this.duration);for(var e=this.timelines,f=0,g=e.length;g>f;f++)e[f].apply(a,b,d)}},e.binarySearch=function(a,b,c){var d=0,e=Math.floor(a.length/c)-2;if(!e)return c;for(var f=e>>>1;;){if(a[(f+1)*c]<=b?d=f+1:e=f,d==e)return(d+1)*c;f=d+e>>>1}},e.linearSearch=function(a,b,c){for(var d=0,e=a.length-c;e>=d;d+=c)if(a[d]>b)return d;return-1},e.Curves=function(a){this.curves=[],this.curves.length=6*(a-1)},e.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,c,d,e){var f=.1,g=f*f,h=g*f,i=3*f,j=3*g,k=6*g,l=6*h,m=2*-b+d,n=2*-c+e,o=3*(b-d)+1,p=3*(c-e)+1,q=6*a,r=this.curves;r[q]=b*i+m*j+o*h,r[q+1]=c*i+n*j+p*h,r[q+2]=m*k+o*l,r[q+3]=n*k+p*l,r[q+4]=o*l,r[q+5]=p*l},getCurvePercent:function(a,b){b=0>b?0:b>1?1:b;var c=6*a,d=this.curves,e=d[c];if(!e)return b;if(-1==e)return 0;for(var f=d[c+1],g=d[c+2],h=d[c+3],i=d[c+4],j=d[c+5],k=e,l=f,m=8;;){if(k>=b){var n=k-e,o=l-f;return o+(l-o)*(b-n)/(k-n)}if(!m)break;m--,e+=g,f+=h,g+=i,h+=j,k+=e,l+=f}return l+(1-l)*(b-k)/(1-k)}},e.RotateTimeline=function(a){this.curves=new e.Curves(a),this.frames=[],this.frames.length=2*a},e.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,c){a*=2,this.frames[a]=b,this.frames[a+1]=c},apply:function(a,b,c){var d,f=this.frames;if(!(b<f[0])){var g=a.bones[this.boneIndex];if(b>=f[f.length-2]){for(d=g.data.rotation+f[f.length-1]-g.rotation;d>180;)d-=360;for(;-180>d;)d+=360;return void(g.rotation+=d*c)}var h=e.binarySearch(f,b,2),i=f[h-1],j=f[h],k=1-(b-j)/(f[h-2]-j);for(k=this.curves.getCurvePercent(h/2-1,k),d=f[h+1]-i;d>180;)d-=360;for(;-180>d;)d+=360;for(d=g.data.rotation+(i+d*k)-g.rotation;d>180;)d-=360;for(;-180>d;)d+=360;g.rotation+=d*c}}},e.TranslateTimeline=function(a){this.curves=new e.Curves(a),this.frames=[],this.frames.length=3*a},e.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var f=a.bones[this.boneIndex];if(b>=d[d.length-3])return f.x+=(f.data.x+d[d.length-2]-f.x)*c,void(f.y+=(f.data.y+d[d.length-1]-f.y)*c);var g=e.binarySearch(d,b,3),h=d[g-2],i=d[g-1],j=d[g],k=1-(b-j)/(d[g+-3]-j);k=this.curves.getCurvePercent(g/3-1,k),f.x+=(f.data.x+h+(d[g+1]-h)*k-f.x)*c,f.y+=(f.data.y+i+(d[g+2]-i)*k-f.y)*c}}},e.ScaleTimeline=function(a){this.curves=new e.Curves(a),this.frames=[],this.frames.length=3*a},e.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var f=a.bones[this.boneIndex];if(b>=d[d.length-3])return f.scaleX+=(f.data.scaleX-1+d[d.length-2]-f.scaleX)*c,void(f.scaleY+=(f.data.scaleY-1+d[d.length-1]-f.scaleY)*c);var g=e.binarySearch(d,b,3),h=d[g-2],i=d[g-1],j=d[g],k=1-(b-j)/(d[g+-3]-j);k=this.curves.getCurvePercent(g/3-1,k),f.scaleX+=(f.data.scaleX-1+h+(d[g+1]-h)*k-f.scaleX)*c,f.scaleY+=(f.data.scaleY-1+i+(d[g+2]-i)*k-f.scaleY)*c}}},e.ColorTimeline=function(a){this.curves=new e.Curves(a),this.frames=[],this.frames.length=5*a},e.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(a,b,c,d,e,f){a*=5,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d,this.frames[a+3]=e,this.frames[a+4]=f},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var f=a.slots[this.slotIndex];if(b>=d[d.length-5]){var g=d.length-1;return f.r=d[g-3],f.g=d[g-2],f.b=d[g-1],void(f.a=d[g])}var h=e.binarySearch(d,b,5),i=d[h-4],j=d[h-3],k=d[h-2],l=d[h-1],m=d[h],n=1-(b-m)/(d[h-5]-m);n=this.curves.getCurvePercent(h/5-1,n);var o=i+(d[h+1]-i)*n,p=j+(d[h+2]-j)*n,q=k+(d[h+3]-k)*n,r=l+(d[h+4]-l)*n;1>c?(f.r+=(o-f.r)*c,f.g+=(p-f.g)*c,f.b+=(q-f.b)*c,f.a+=(r-f.a)*c):(f.r=o,f.g=p,f.b=q,f.a=r)}}},e.AttachmentTimeline=function(a){this.curves=new e.Curves(a),this.frames=[],this.frames.length=a,this.attachmentNames=[],this.attachmentNames.length=a},e.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(a,b,c){this.frames[a]=b,this.attachmentNames[a]=c},apply:function(a,b){var c=this.frames;if(!(b<c[0])){var d;d=b>=c[c.length-1]?c.length-1:e.binarySearch(c,b,1)-1;var f=this.attachmentNames[d];a.slots[this.slotIndex].setAttachment(f?a.getAttachmentBySlotIndex(this.slotIndex,f):null)}}},e.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},e.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return slot[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSkin:function(a){for(var b=this.skins,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findAnimation:function(a){for(var b=this.animations,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null}},e.Skeleton=function(a){this.data=a,this.bones=[];for(var b=0,c=a.bones.length;c>b;b++){var d=a.bones[b],f=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new e.Bone(d,f))}for(this.slots=[],this.drawOrder=[],b=0,c=a.slots.length;c>b;b++){var g=a.slots[b],h=this.bones[a.bones.indexOf(g.boneData)],i=new e.Slot(g,this,h);this.slots.push(i),this.drawOrder.push(i)}},e.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,c=this.bones,d=0,e=c.length;e>d;d++)c[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,c=a.length;c>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,c=a.length;c>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin),this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var c=this.skin.getAttachment(a,b);if(c)return c}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var c=this.slots,d=0,e=c.size;e>d;d++){var f=c[d];if(f.data.name==a){var g=null;if(b&&(g=this.getAttachment(d,b),null==g))throw"Attachment not found: "+b+", for slot: "+a;return void f.setAttachment(g)}}throw"Slot not found: "+a},update:function(a){time+=a}},e.AttachmentType={region:0},e.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},e.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,b,c,d,e){var f=this.uvs;e?(f[2]=a,f[3]=d,f[4]=a,f[5]=b,f[6]=c,f[7]=b,f[0]=c,f[1]=d):(f[0]=a,f[1]=d,f[2]=a,f[3]=b,f[4]=c,f[5]=b,f[6]=c,f[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,c=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,e=c+this.regionWidth*a,f=d+this.regionHeight*b,g=this.rotation*Math.PI/180,h=Math.cos(g),i=Math.sin(g),j=c*h+this.x,k=c*i,l=d*h+this.y,m=d*i,n=e*h+this.x,o=e*i,p=f*h+this.y,q=f*i,r=this.offset;r[0]=j-m,r[1]=l+k,r[2]=j-q,r[3]=p+k,r[4]=n-q,r[5]=p+o,r[6]=n-m,r[7]=l+o},computeVertices:function(a,b,c,d){a+=c.worldX,b+=c.worldY;var e=c.m00,f=c.m01,g=c.m10,h=c.m11,i=this.offset;d[0]=i[0]*e+i[1]*f+a,d[1]=i[0]*g+i[1]*h+b,d[2]=i[2]*e+i[3]*f+a,d[3]=i[2]*g+i[3]*h+b,d[4]=i[4]*e+i[5]*f+a,d[5]=i[4]*g+i[5]*h+b,d[6]=i[6]*e+i[7]*f+a,d[7]=i[6]*g+i[7]*h+b}},e.AnimationStateData=function(a){this.skeletonData=a,this.animationToMixTime={}},e.AnimationStateData.prototype={defaultMix:0,setMixByName:function(a,b,c){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;var e=this.skeletonData.findAnimation(b);if(!e)throw"Animation not found: "+b;this.setMix(d,e,c)},setMix:function(a,b,c){this.animationToMixTime[a.name+":"+b.name]=c},getMix:function(a,b){var c=this.animationToMixTime[a.name+":"+b.name];return c?c:this.defaultMix}},e.AnimationState=function(a){this.data=a,this.queue=[]},e.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a*this.animationSpeed,this.previousTime+=a,this.mixTime+=a,this.queue.length>0){var b=this.queue[0];this.currentTime>=b.delay&&(this._setAnimation(b.animation,b.loop),this.queue.shift())}},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;b>=1&&(b=1,this.previous=null),this.current.mix(a,this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(a,b){this.previous=null,a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=a,this.currentLoop=b,this.currentTime=0},setAnimationByName:function(a,b){var c=this.data.skeletonData.findAnimation(a);if(!c)throw"Animation not found: "+a;this.setAnimation(c,b)},setAnimation:function(a,b){this.queue.length=0,this._setAnimation(a,b)},addAnimationByName:function(a,b,c){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,c)},addAnimation:function(a,b,c){var d={};if(d.animation=a,d.loop=b,!c||0>=c){var e=this.queue.length?this.queue[this.queue.length-1].animation:this.current;c=null!=e?e.duration-this.data.getMix(e,a)+(c||0):0}d.delay=c,this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},e.SkeletonJson=function(a){this.attachmentLoader=a},e.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,c=new e.SkeletonData,d=a.bones,f=0,g=d.length;g>f;f++){var h=d[f],i=null;if(h.parent&&(i=c.findBone(h.parent),!i))throw"Parent bone not found: "+h.parent;b=new e.BoneData(h.name,i),b.length=(h.length||0)*this.scale,b.x=(h.x||0)*this.scale,b.y=(h.y||0)*this.scale,b.rotation=h.rotation||0,b.scaleX=h.scaleX||1,b.scaleY=h.scaleY||1,c.bones.push(b)}var j=a.slots;for(f=0,g=j.length;g>f;f++){var k=j[f];if(b=c.findBone(k.bone),!b)throw"Slot bone not found: "+k.bone;var l=new e.SlotData(k.name,b),m=k.color;m&&(l.r=e.SkeletonJson.toColor(m,0),l.g=e.SkeletonJson.toColor(m,1),l.b=e.SkeletonJson.toColor(m,2),l.a=e.SkeletonJson.toColor(m,3)),l.attachmentName=k.attachment,c.slots.push(l)}var n=a.skins;for(var o in n)if(n.hasOwnProperty(o)){var p=n[o],q=new e.Skin(o);for(var r in p)if(p.hasOwnProperty(r)){var s=c.findSlotIndex(r),t=p[r];for(var u in t)if(t.hasOwnProperty(u)){var v=this.readAttachment(q,u,t[u]);null!=v&&q.addAttachment(s,u,v)}}c.skins.push(q),"default"==q.name&&(c.defaultSkin=q)}var w=a.animations;for(var x in w)w.hasOwnProperty(x)&&this.readAnimation(x,w[x],c);return c},readAttachment:function(a,b,c){b=c.name||b;var d=e.AttachmentType[c.type||"region"];if(d==e.AttachmentType.region){var f=new e.RegionAttachment;return f.x=(c.x||0)*this.scale,f.y=(c.y||0)*this.scale,f.scaleX=c.scaleX||1,f.scaleY=c.scaleY||1,f.rotation=c.rotation||0,f.width=(c.width||32)*this.scale,f.height=(c.height||32)*this.scale,f.updateOffset(),f.rendererObject={},f.rendererObject.name=b,f.rendererObject.scale={},f.rendererObject.scale.x=f.scaleX,f.rendererObject.scale.y=f.scaleY,f.rendererObject.rotation=-f.rotation*Math.PI/180,f}throw"Unknown attachment type: "+d},readAnimation:function(a,b,c){var d,f,g,h,i,j,k,l=[],m=0,n=b.bones;for(var o in n)if(n.hasOwnProperty(o)){var p=c.findBoneIndex(o);if(-1==p)throw"Bone not found: "+o;var q=n[o];for(g in q)if(q.hasOwnProperty(g))if(i=q[g],"rotate"==g){for(f=new e.RotateTimeline(i.length),f.boneIndex=p,d=0,j=0,k=i.length;k>j;j++)h=i[j],f.setFrame(d,h.time,h.angle),e.SkeletonJson.readCurve(f,d,h),d++;l.push(f),m=Math.max(m,f.frames[2*f.getFrameCount()-2])}else{if("translate"!=g&&"scale"!=g)throw"Invalid timeline type for a bone: "+g+" ("+o+")";var r=1;for("scale"==g?f=new e.ScaleTimeline(i.length):(f=new e.TranslateTimeline(i.length),r=this.scale),f.boneIndex=p,d=0,j=0,k=i.length;k>j;j++){h=i[j];var s=(h.x||0)*r,t=(h.y||0)*r;f.setFrame(d,h.time,s,t),e.SkeletonJson.readCurve(f,d,h),d++}l.push(f),m=Math.max(m,f.frames[3*f.getFrameCount()-3])}}var u=b.slots;for(var v in u)if(u.hasOwnProperty(v)){var w=u[v],x=c.findSlotIndex(v);for(g in w)if(w.hasOwnProperty(g))if(i=w[g],"color"==g){for(f=new e.ColorTimeline(i.length),f.slotIndex=x,d=0,j=0,k=i.length;k>j;j++){h=i[j];var y=h.color,z=e.SkeletonJson.toColor(y,0),A=e.SkeletonJson.toColor(y,1),B=e.SkeletonJson.toColor(y,2),C=e.SkeletonJson.toColor(y,3);f.setFrame(d,h.time,z,A,B,C),e.SkeletonJson.readCurve(f,d,h),d++}l.push(f),m=Math.max(m,f.frames[5*f.getFrameCount()-5])}else{if("attachment"!=g)throw"Invalid timeline type for a slot: "+g+" ("+v+")";for(f=new e.AttachmentTimeline(i.length),f.slotIndex=x,d=0,j=0,k=i.length;k>j;j++)h=i[j],f.setFrame(d++,h.time,h.name);l.push(f),m=Math.max(m,f.frames[f.getFrameCount()-1])}}c.animations.push(new e.Animation(a,l,m))}},e.SkeletonJson.readCurve=function(a,b,c){var d=c.curve;d&&("stepped"==d?a.curves.setStepped(b):d instanceof Array&&a.curves.setCurve(b,d[0],d[1],d[2],d[3]))},e.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substr(2*b,2),16)/255},e.Atlas=function(a,b){this.textureLoader=b,this.pages=[],this.regions=[];var c=new e.AtlasReader(a),d=[];d.length=4;for(var f=null;;){var g=c.readLine();if(null==g)break;if(g=c.trim(g),g.length)if(f){var h=new e.AtlasRegion;h.name=g,h.page=f,h.rotate="true"==c.readValue(),c.readTuple(d);var i=parseInt(d[0],10),j=parseInt(d[1],10);c.readTuple(d);var k=parseInt(d[0],10),l=parseInt(d[1],10);h.u=i/f.width,h.v=j/f.height,h.rotate?(h.u2=(i+l)/f.width,h.v2=(j+k)/f.height):(h.u2=(i+k)/f.width,h.v2=(j+l)/f.height),h.x=i,h.y=j,h.width=Math.abs(k),h.height=Math.abs(l),4==c.readTuple(d)&&(h.splits=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==c.readTuple(d)&&(h.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],c.readTuple(d))),h.originalWidth=parseInt(d[0],10),h.originalHeight=parseInt(d[1],10),c.readTuple(d),h.offsetX=parseInt(d[0],10),h.offsetY=parseInt(d[1],10),h.index=parseInt(c.readValue(),10),this.regions.push(h)}else{f=new e.AtlasPage,f.name=g,f.format=e.Atlas.Format[c.readValue()],c.readTuple(d),f.minFilter=e.Atlas.TextureFilter[d[0]],f.magFilter=e.Atlas.TextureFilter[d[1]];var m=c.readValue();f.uWrap=e.Atlas.TextureWrap.clampToEdge,f.vWrap=e.Atlas.TextureWrap.clampToEdge,"x"==m?f.uWrap=e.Atlas.TextureWrap.repeat:"y"==m?f.vWrap=e.Atlas.TextureWrap.repeat:"xy"==m&&(f.uWrap=f.vWrap=e.Atlas.TextureWrap.repeat),b.load(f,g),this.pages.push(f)}else f=null}},e.Atlas.prototype={findRegion:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},dispose:function(){for(var a=this.pages,b=0,c=a.length;c>b;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++){var e=b[c];e.page==a&&(e.u=e.x/a.width,e.v=e.y/a.height,e.rotate?(e.u2=(e.x+e.height)/a.width,e.v2=(e.y+e.width)/a.height):(e.u2=(e.x+e.width)/a.width,e.v2=(e.y+e.height)/a.height))}}},e.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},e.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},e.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},e.AtlasPage=function(){},e.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},e.AtlasRegion=function(){},e.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},e.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)},e.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),c=b.indexOf(":");if(-1==c)throw"Invalid line: "+b;for(var d=0,e=c+1;3>d;d++){var f=b.indexOf(",",e);if(-1==f){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(e,f-e)),e=f+1}return a[d]=this.trim(b.substring(e)),d+1}},e.AtlasAttachmentLoader=function(a){this.atlas=a},e.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,c){switch(b){case e.AttachmentType.region:var d=this.atlas.findRegion(c);if(!d)throw"Region not found in atlas: "+c+" ("+b+")";var f=new e.RegionAttachment(c);return f.rendererObject=d,f.setUVs(d.u,d.v,d.u2,d.v2,d.rotate),f.regionOffsetX=d.offsetX,f.regionOffsetY=d.offsetY,f.regionWidth=d.width,f.regionHeight=d.height,f.regionOriginalWidth=d.originalWidth,f.regionOriginalHeight=d.originalHeight,f}throw"Unknown attachment type: "+b}},e.Bone.yDown=!0,d.AnimCache={},d.Spine=function(a){if(d.DisplayObjectContainer.call(this),this.spineData=d.AnimCache[a],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new e.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new e.AnimationStateData(this.spineData),this.state=new e.AnimationState(this.stateData),this.slotContainers=[];for(var b=0,c=this.skeleton.drawOrder.length;c>b;b++){var f=this.skeleton.drawOrder[b],g=f.attachment,h=new d.DisplayObjectContainer;if(this.slotContainers.push(h),this.addChild(h),g instanceof e.RegionAttachment){var i=g.rendererObject.name,j=this.createSprite(f,g.rendererObject);f.currentSprite=j,f.currentSpriteName=i,h.addChild(j)}}},d.Spine.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Spine.prototype.constructor=d.Spine,d.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(a),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var b=this.skeleton.drawOrder,c=0,f=b.length;f>c;c++){var g=b[c],h=g.attachment,i=this.slotContainers[c];if(h instanceof e.RegionAttachment){if(h.rendererObject&&(!g.currentSpriteName||g.currentSpriteName!=h.name)){var j=h.rendererObject.name;if(void 0!==g.currentSprite&&(g.currentSprite.visible=!1),g.sprites=g.sprites||{},void 0!==g.sprites[j])g.sprites[j].visible=!0;else{var k=this.createSprite(g,h.rendererObject);i.addChild(k)}g.currentSprite=g.sprites[j],g.currentSpriteName=j}i.visible=!0;var l=g.bone;i.position.x=l.worldX+h.x*l.m00+h.y*l.m01,i.position.y=l.worldY+h.x*l.m10+h.y*l.m11,i.scale.x=l.worldScaleX,i.scale.y=l.worldScaleY,i.rotation=-(g.bone.worldRotation*Math.PI/180),i.alpha=g.a,g.currentSprite.tint=d.rgb2hex([g.r,g.g,g.b])}else i.visible=!1}d.DisplayObjectContainer.prototype.updateTransform.call(this)},d.Spine.prototype.createSprite=function(a,b){var c=d.TextureCache[b.name]?b.name:b.name+".png",e=new d.Sprite(d.Texture.fromFrame(c));return e.scale=b.scale,e.rotation=b.rotation,e.anchor.x=e.anchor.y=.5,a.sprites=a.sprites||{},a.sprites[b.name]=e,e},d.BaseTextureCache={},d.BaseTextureCacheIdGenerator=0,d.BaseTexture=function(a,b){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=b||d.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this._UID=d._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[!0,!0,!0,!0],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var c=this;this.source.onload=function(){c.hasLoaded=!0,c.width=c.source.naturalWidth||c.source.width,c.height=c.source.naturalHeight||c.source.height,c.dirty(),c.dispatchEvent({type:"loaded",content:c})},this.source.onerror=function(){c.dispatchEvent({type:"error",content:c})}}this.imageUrl=null,this._powerOf2=!1}},d.BaseTexture.prototype.constructor=d.BaseTexture,d.EventTarget.mixin(d.BaseTexture.prototype),d.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete d.BaseTextureCache[this.imageUrl],delete d.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=""):this.source&&this.source._pixiId&&delete d.BaseTextureCache[this.source._pixiId],this.source=null;for(var a=this._glTextures.length-1;a>=0;a--){var b=this._glTextures[a],c=d.glContexts[a];c&&b&&c.deleteTexture(b)}this._glTextures.length=0},d.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1,this.source.src=null,this.source.src=a},d.BaseTexture.prototype.dirty=function(){for(var a=0;a<this._glTextures.length;a++)this._dirty[a]=!0},d.BaseTexture.fromImage=function(a,b,c){var e=d.BaseTextureCache[a];if(void 0===b&&-1===a.indexOf("data:")&&(b=!0),!e){var f=new Image;b&&(f.crossOrigin=""),f.src=a,e=new d.BaseTexture(f,c),e.imageUrl=a,d.BaseTextureCache[a]=e,-1!==a.indexOf(d.RETINA_PREFIX+".")&&(e.resolution=2)}return e},d.BaseTexture.fromCanvas=function(a,b){a._pixiId||(a._pixiId="canvas_"+d.TextureCacheIdGenerator++);var c=d.BaseTextureCache[a._pixiId];return c||(c=new d.BaseTexture(a,b),d.BaseTextureCache[a._pixiId]=c),c},d.TextureCache={},d.FrameCache={},d.TextureCacheIdGenerator=0,d.Texture=function(a,b,c,e){this.noFrame=!1,b||(this.noFrame=!0,b=new d.Rectangle(0,0,1,1)),a instanceof d.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=b,this.trim=e,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=c||new d.Rectangle(0,0,1,1),a.hasLoaded?(this.noFrame&&(b=new d.Rectangle(0,0,a.width,a.height)),this.setFrame(b)):a.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},d.Texture.prototype.constructor=d.Texture,d.EventTarget.mixin(d.Texture.prototype),d.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;
a.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new d.Rectangle(0,0,a.width,a.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},d.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy(),this.valid=!1},d.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},d.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new d.TextureUvs);var a=this.crop,b=this.baseTexture.width,c=this.baseTexture.height;this._uvs.x0=a.x/b,this._uvs.y0=a.y/c,this._uvs.x1=(a.x+a.width)/b,this._uvs.y1=a.y/c,this._uvs.x2=(a.x+a.width)/b,this._uvs.y2=(a.y+a.height)/c,this._uvs.x3=a.x/b,this._uvs.y3=(a.y+a.height)/c},d.Texture.fromImage=function(a,b,c){var e=d.TextureCache[a];return e||(e=new d.Texture(d.BaseTexture.fromImage(a,b,c)),d.TextureCache[a]=e),e},d.Texture.fromFrame=function(a){var b=d.TextureCache[a];if(!b)throw new Error('The frameId "'+a+'" does not exist in the texture cache ');return b},d.Texture.fromCanvas=function(a,b){var c=d.BaseTexture.fromCanvas(a,b);return new d.Texture(c)},d.Texture.addTextureToCache=function(a,b){d.TextureCache[b]=a},d.Texture.removeTextureFromCache=function(a){var b=d.TextureCache[a];return delete d.TextureCache[a],delete d.BaseTextureCache[a],b},d.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},d.RenderTexture=function(a,b,c,e,f){if(this.width=a||100,this.height=b||100,this.resolution=f||1,this.frame=new d.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new d.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new d.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=e||d.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,d.Texture.call(this,this.baseTexture,new d.Rectangle(0,0,this.width,this.height)),this.renderer=c||d.defaultRenderer,this.renderer.type===d.WEBGL_RENDERER){var g=this.renderer.gl;this.baseTexture._dirty[g.id]=!1,this.textureBuffer=new d.FilterTexture(g,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode),this.baseTexture._glTextures[g.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new d.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new d.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},d.RenderTexture.prototype=Object.create(d.Texture.prototype),d.RenderTexture.prototype.constructor=d.RenderTexture,d.RenderTexture.prototype.resize=function(a,b,c){(a!==this.width||b!==this.height)&&(this.valid=a>0&&b>0,this.width=this.frame.width=this.crop.width=a,this.height=this.frame.height=this.crop.height=b,c&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===d.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},d.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===d.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},d.RenderTexture.prototype.renderWebGL=function(a,b,c){if(this.valid){var d=a.worldTransform;d.identity(),d.translate(0,2*this.projection.y),b&&d.append(b),d.scale(1,-1),a.worldAlpha=1;for(var e=a.children,f=0,g=e.length;g>f;f++)e[f].updateTransform();var h=this.renderer.gl;h.viewport(0,0,this.width*this.resolution,this.height*this.resolution),h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},d.RenderTexture.prototype.renderCanvas=function(a,b,c){if(this.valid){var d=a.worldTransform;d.identity(),b&&d.append(b);for(var e=a.children,f=0,g=e.length;g>f;f++)e[f].updateTransform();c&&this.textureBuffer.clear();var h=this.textureBuffer.context,i=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,h),this.renderer.resolution=i}},d.RenderTexture.prototype.getImage=function(){var a=new Image;return a.src=this.getBase64(),a},d.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},d.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===d.WEBGL_RENDERER){var a=this.renderer.gl,b=this.textureBuffer.width,c=this.textureBuffer.height,e=new Uint8Array(4*b*c);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),a.readPixels(0,0,b,c,a.RGBA,a.UNSIGNED_BYTE,e),a.bindFramebuffer(a.FRAMEBUFFER,null);for(var f=new d.CanvasBuffer(b,c),g=f.context.getImageData(0,0,b,c),h=g.data,i=0;i<e.length;i+=4){var j=e[i+3];h[i]=e[i]*j,h[i+1]=e[i+1]*j,h[i+2]=e[i+2]*j,h[i+3]=j}return f.context.putImageData(g,0,0),f.canvas}return this.textureBuffer.canvas},d.RenderTexture.tempMatrix=new d.Matrix,d.AssetLoader=function(a,b){this.assetURLs=a,this.crossorigin=b,this.loadersByType={jpg:d.ImageLoader,jpeg:d.ImageLoader,png:d.ImageLoader,gif:d.ImageLoader,webp:d.ImageLoader,json:d.JsonLoader,atlas:d.AtlasLoader,anim:d.SpineLoader,xml:d.BitmapFontLoader,fnt:d.BitmapFontLoader}},d.EventTarget.mixin(d.AssetLoader.prototype),d.AssetLoader.prototype.constructor=d.AssetLoader,d.AssetLoader.prototype._getDataType=function(a){var b="data:",c=a.slice(0,b.length).toLowerCase();if(c===b){var d=a.slice(b.length),e=d.indexOf(",");if(-1===e)return null;var f=d.slice(0,e).split(";")[0];return f&&"text/plain"!==f.toLowerCase()?f.split("/").pop().toLowerCase():"txt"}return null},d.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.data.content)}var b=this;this.loadCount=this.assetURLs.length;for(var c=0;c<this.assetURLs.length;c++){var d=this.assetURLs[c],e=this._getDataType(d);e||(e=d.split("?").shift().split(".").pop().toLowerCase());var f=this.loadersByType[e];if(!f)throw new Error(e+" is an unsupported file type");var g=new f(d,this.crossorigin);g.on("loaded",a),g.load()}},d.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--,this.emit("onProgress",{content:this,loader:a}),this.onProgress&&this.onProgress(a),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},d.JsonLoader=function(a,b){this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.loaded=!1},d.JsonLoader.prototype.constructor=d.JsonLoader,d.EventTarget.mixin(d.JsonLoader.prototype),d.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){}):this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onload=this.onJSONLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},d.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this.baseUrl+this.json.meta.image,b=new d.ImageLoader(a,this.crossorigin),c=this.json.frames;this.texture=b.texture.baseTexture,b.addEventListener("loaded",this.onLoaded.bind(this));for(var f in c){var g=c[f].frame;if(g){var h=new d.Rectangle(g.x,g.y,g.w,g.h),i=h.clone(),j=null;if(c[f].trimmed){var k=c[f].sourceSize,l=c[f].spriteSourceSize;j=new d.Rectangle(l.x,l.y,k.w,k.h)}d.TextureCache[f]=new d.Texture(this.texture,h,i,j)}}b.load()}else if(this.json.bones){var m=new e.SkeletonJson,n=m.readSkeletonData(this.json);d.AnimCache[this.url]=n,this.onLoaded()}else this.onLoaded()},d.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},d.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},d.AtlasLoader=function(a,b){this.url=a,this.baseUrl=a.replace(/[^\/]*$/,""),this.crossorigin=b,this.loaded=!1},d.AtlasLoader.constructor=d.AtlasLoader,d.EventTarget.mixin(d.AtlasLoader.prototype),d.AtlasLoader.prototype.load=function(){this.ajaxRequest=new d.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},d.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var a=this.ajaxRequest.responseText.split(/\r?\n/),b=-3,c=0,e=null,f=!1,g=0,h=0,i=this.onLoaded.bind(this);for(g=0;g<a.length;g++)if(a[g]=a[g].replace(/^\s+|\s+$/g,""),""===a[g]&&(f=g+1),a[g].length>0){if(f===g)this.atlas.meta.image.push(a[g]),c=this.atlas.meta.image.length-1,this.atlas.frames.push({}),b=-3;else if(b>0)if(b%7===1)null!=e&&(this.atlas.frames[c][e.name]=e),e={name:a[g],frame:{}};else{var j=a[g].split(" ");if(b%7===3)e.frame.x=Number(j[1].replace(",","")),e.frame.y=Number(j[2]);else if(b%7===4)e.frame.w=Number(j[1].replace(",","")),e.frame.h=Number(j[2]);else if(b%7===5){var k={x:0,y:0,w:Number(j[1].replace(",","")),h:Number(j[2])};k.w>e.frame.w||k.h>e.frame.h?(e.trimmed=!0,e.realSize=k):e.trimmed=!1}}b++}if(null!=e&&(this.atlas.frames[c][e.name]=e),this.atlas.meta.image.length>0){for(this.images=[],h=0;h<this.atlas.meta.image.length;h++){var l=this.baseUrl+this.atlas.meta.image[h],m=this.atlas.frames[h];this.images.push(new d.ImageLoader(l,this.crossorigin));for(g in m){var n=m[g].frame;n&&(d.TextureCache[g]=new d.Texture(this.images[h].texture.baseTexture,{x:n.x,y:n.y,width:n.w,height:n.h}),m[g].trimmed&&(d.TextureCache[g].realSize=m[g].realSize,d.TextureCache[g].trim.x=0,d.TextureCache[g].trim.y=0))}}for(this.currentImageId=0,h=0;h<this.images.length;h++)this.images[h].on("loaded",i);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},d.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},d.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},d.SpriteSheetLoader=function(a,b){this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},d.SpriteSheetLoader.prototype.constructor=d.SpriteSheetLoader,d.EventTarget.mixin(d.SpriteSheetLoader.prototype),d.SpriteSheetLoader.prototype.load=function(){var a=this,b=new d.JsonLoader(this.url,this.crossorigin);b.on("loaded",function(b){a.json=b.data.content.json,a.onLoaded()}),b.load()},d.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},d.ImageLoader=function(a,b){this.texture=d.Texture.fromImage(a,b),this.frames=[]},d.ImageLoader.prototype.constructor=d.ImageLoader,d.EventTarget.mixin(d.ImageLoader.prototype),d.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},d.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},d.ImageLoader.prototype.loadFramedSpriteSheet=function(a,b,c){this.frames=[];for(var e=Math.floor(this.texture.width/a),f=Math.floor(this.texture.height/b),g=0,h=0;f>h;h++)for(var i=0;e>i;i++,g++){var j=new d.Texture(this.texture.baseTexture,{x:i*a,y:h*b,width:a,height:b});this.frames.push(j),c&&(d.TextureCache[c+"-"+g]=j)}this.load()},d.BitmapFontLoader=function(a,b){this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null},d.BitmapFontLoader.prototype.constructor=d.BitmapFontLoader,d.EventTarget.mixin(d.BitmapFontLoader.prototype),d.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new d.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},d.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var b=new DOMParser;a=b.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var c=document.createElement("div");c.innerHTML=this.ajaxRequest.responseText,a=c}var e=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file"),f=new d.ImageLoader(e,this.crossorigin);this.texture=f.texture.baseTexture;var g={},h=a.getElementsByTagName("info")[0],i=a.getElementsByTagName("common")[0];g.font=h.getAttribute("face"),g.size=parseInt(h.getAttribute("size"),10),g.lineHeight=parseInt(i.getAttribute("lineHeight"),10),g.chars={};for(var j=a.getElementsByTagName("char"),k=0;k<j.length;k++){var l=parseInt(j[k].getAttribute("id"),10),m=new d.Rectangle(parseInt(j[k].getAttribute("x"),10),parseInt(j[k].getAttribute("y"),10),parseInt(j[k].getAttribute("width"),10),parseInt(j[k].getAttribute("height"),10));g.chars[l]={xOffset:parseInt(j[k].getAttribute("xoffset"),10),yOffset:parseInt(j[k].getAttribute("yoffset"),10),xAdvance:parseInt(j[k].getAttribute("xadvance"),10),kerning:{},texture:d.TextureCache[l]=new d.Texture(this.texture,m)}}var n=a.getElementsByTagName("kerning");for(k=0;k<n.length;k++){var o=parseInt(n[k].getAttribute("first"),10),p=parseInt(n[k].getAttribute("second"),10),q=parseInt(n[k].getAttribute("amount"),10);g.chars[p].kerning[o]=q}d.BitmapText.fonts[g.font]=g,f.addEventListener("loaded",this.onLoaded.bind(this)),f.load()}},d.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},d.SpineLoader=function(a,b){this.url=a,this.crossorigin=b,this.loaded=!1},d.SpineLoader.prototype.constructor=d.SpineLoader,d.EventTarget.mixin(d.SpineLoader.prototype),d.SpineLoader.prototype.load=function(){var a=this,b=new d.JsonLoader(this.url,this.crossorigin);b.on("loaded",function(b){a.json=b.data.content.json,a.onLoaded()}),b.load()},d.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},d.AbstractFilter=function(a,b){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=b||{},this.fragmentSrc=a||[]},d.AbstractFilter.prototype.constructor=d.AbstractFilter,d.AbstractFilter.prototype.syncUniforms=function(){for(var a=0,b=this.shaders.length;b>a;a++)this.shaders[a].dirty=!0},d.AlphaMaskFilter=function(a){d.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},d.AlphaMaskFilter.prototype=Object.create(d.AbstractFilter.prototype),d.AlphaMaskFilter.prototype.constructor=d.AlphaMaskFilter,d.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(d.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}}),d.ColorMatrixFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},d.ColorMatrixFilter.prototype=Object.create(d.AbstractFilter.prototype),d.ColorMatrixFilter.prototype.constructor=d.ColorMatrixFilter,Object.defineProperty(d.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}}),d.GrayFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},d.GrayFilter.prototype=Object.create(d.AbstractFilter.prototype),d.GrayFilter.prototype.constructor=d.GrayFilter,Object.defineProperty(d.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}}),d.DisplacementFilter=function(a){d.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},d.DisplacementFilter.prototype=Object.create(d.AbstractFilter.prototype),d.DisplacementFilter.prototype.constructor=d.DisplacementFilter,d.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(d.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}}),Object.defineProperty(d.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}}),Object.defineProperty(d.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}),d.PixelateFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},d.PixelateFilter.prototype=Object.create(d.AbstractFilter.prototype),d.PixelateFilter.prototype.constructor=d.PixelateFilter,Object.defineProperty(d.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0,this.uniforms.pixelSize.value=a}}),d.BlurXFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},d.BlurXFilter.prototype=Object.create(d.AbstractFilter.prototype),d.BlurXFilter.prototype.constructor=d.BlurXFilter,Object.defineProperty(d.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.dirty=!0,this.uniforms.blur.value=1/7e3*a}}),d.BlurYFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},d.BlurYFilter.prototype=Object.create(d.AbstractFilter.prototype),d.BlurYFilter.prototype.constructor=d.BlurYFilter,Object.defineProperty(d.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),d.BlurFilter=function(){this.blurXFilter=new d.BlurXFilter,this.blurYFilter=new d.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},d.BlurFilter.prototype=Object.create(d.AbstractFilter.prototype),d.BlurFilter.prototype.constructor=d.BlurFilter,Object.defineProperty(d.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}}),Object.defineProperty(d.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}}),Object.defineProperty(d.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}),d.InvertFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},d.InvertFilter.prototype=Object.create(d.AbstractFilter.prototype),d.InvertFilter.prototype.constructor=d.InvertFilter,Object.defineProperty(d.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}}),d.SepiaFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},d.SepiaFilter.prototype=Object.create(d.AbstractFilter.prototype),d.SepiaFilter.prototype.constructor=d.SepiaFilter,Object.defineProperty(d.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=a}}),d.TwistFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},d.TwistFilter.prototype=Object.create(d.AbstractFilter.prototype),d.TwistFilter.prototype.constructor=d.TwistFilter,Object.defineProperty(d.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0,this.uniforms.offset.value=a}}),Object.defineProperty(d.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0,this.uniforms.radius.value=a}}),Object.defineProperty(d.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),d.ColorStepFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},d.ColorStepFilter.prototype=Object.create(d.AbstractFilter.prototype),d.ColorStepFilter.prototype.constructor=d.ColorStepFilter,Object.defineProperty(d.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}}),d.DotScreenFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},d.DotScreenFilter.prototype=Object.create(d.AbstractFilter.prototype),d.DotScreenFilter.prototype.constructor=d.DotScreenFilter,Object.defineProperty(d.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0,this.uniforms.scale.value=a}}),Object.defineProperty(d.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),d.CrossHatchFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},d.CrossHatchFilter.prototype=Object.create(d.AbstractFilter.prototype),d.CrossHatchFilter.prototype.constructor=d.CrossHatchFilter,Object.defineProperty(d.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),d.RGBSplitFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]
},d.RGBSplitFilter.prototype=Object.create(d.AbstractFilter.prototype),d.RGBSplitFilter.prototype.constructor=d.RGBSplitFilter,Object.defineProperty(d.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(a){this.uniforms.red.value=a}}),Object.defineProperty(d.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(a){this.uniforms.green.value=a}}),Object.defineProperty(d.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(a){this.uniforms.blue.value=a}}),"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=d),c.PIXI=d):"undefined"!=typeof define&&define.amd?define(d):a.PIXI=d}).call(this)},{}],73:[function(a,b){b.exports=function(a,b){for(var c=a[0],d=a[1],e=!1,f=0,g=b.length-1;f<b.length;g=f++){var h=b[f][0],i=b[f][1],j=b[g][0],k=b[g][1],l=i>d!=k>d&&(j-h)*(d-i)/(k-i)+h>c;l&&(e=!e)}return e}},{}],74:[function(a,b){"use strict";var c=function(){this.set.apply(this,arguments)};c.prototype={clone:function(){return new c(this.x,this.y)},equals:function(a){return this===a||this.x===a.x&&this.y===a.y},set:function(){var a,b,c;if(1===arguments.length)if(c=arguments[0],Array.isArray(c))a=c[0],b=c[1];else if("object"==typeof c){if("[object Arguments]"===Object.prototype.toString.call(c))return this.set(2===c.length?Array.prototype.slice.call(c,0):c[0]);a=c.x,b=c.y}else"number"==typeof c&&(a=c);else a=arguments[0],b=arguments[1];return this.x=a||0,this.y=b||0,this},add:function(){var a=new c(arguments);return a.set(this.x+a.x,this.y+a.y)},subtract:function(){var a=new c(arguments);return a.set(this.x-a.x,this.y-a.y)},multiply:function(){var a=new c(arguments);return a.set(this.x*a.x,this.y*a.y)},divide:function(){var a=new c(arguments);return a.set(this.x/a.x,this.y/a.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(a){var b=a||1,d=this.length(),e=0!==d?b/d:0;return new c(this.x*e,this.y*e)},dot:function(){var a=new c(arguments);return this.x*a.x+this.y*a.y},cross:function(){var a=new c(arguments);return this.x*a.y-this.y*a.x}},c.random=function(){var a=function(a,b){return Math.random()*(b-a)+a};if(1===arguments.length){var b=arguments[0][0],d=arguments[0][1];return new c(a(b,d),a(b,d))}if(2===arguments.length){var e=arguments[0],f=arguments[1];return new c(a(e[0],e[1]),a(f[0],f[1]))}return new c(Math.random(),Math.random())},b.exports=c},{}],75:[function(a,b){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var c=c||function(){var a=[];return{REVISION:"14",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},update:function(b){if(0===a.length)return!1;var c=0;for(b=void 0!==b?b:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();c<a.length;)a[c].update(b)?c++:a.splice(c,1);return!0}}}();c.Tween=function(a){var b=a,d={},e={},f={},g=1e3,h=0,i=!1,j=!1,k=!1,l=0,m=null,n=c.Easing.Linear.None,o=c.Interpolation.Linear,p=[],q=null,r=!1,s=null,t=null,u=null;for(var v in a)d[v]=parseFloat(a[v],10);this.to=function(a,b){return void 0!==b&&(g=b),e=a,this},this.start=function(a){c.add(this),j=!0,r=!1,m=void 0!==a?a:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),m+=l;for(var g in e){if(e[g]instanceof Array){if(0===e[g].length)continue;e[g]=[b[g]].concat(e[g])}d[g]=b[g],d[g]instanceof Array==!1&&(d[g]*=1),f[g]=d[g]||0}return this},this.stop=function(){return j?(c.remove(this),j=!1,null!==u&&u.call(b),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var a=0,b=p.length;b>a;a++)p[a].stop()},this.delay=function(a){return l=a,this},this.repeat=function(a){return h=a,this},this.yoyo=function(a){return i=a,this},this.easing=function(a){return n=a,this},this.interpolation=function(a){return o=a,this},this.chain=function(){return p=arguments,this},this.onStart=function(a){return q=a,this},this.onUpdate=function(a){return s=a,this},this.onComplete=function(a){return t=a,this},this.onStop=function(a){return u=a,this},this.update=function(a){var c;if(m>a)return!0;r===!1&&(null!==q&&q.call(b),r=!0);var j=(a-m)/g;j=j>1?1:j;var u=n(j);for(c in e){var v=d[c]||0,w=e[c];w instanceof Array?b[c]=o(w,u):("string"==typeof w&&(w=v+parseFloat(w,10)),"number"==typeof w&&(b[c]=v+(w-v)*u))}if(null!==s&&s.call(b,u),1==j){if(h>0){isFinite(h)&&h--;for(c in f){if("string"==typeof e[c]&&(f[c]=f[c]+parseFloat(e[c],10)),i){var x=f[c];f[c]=e[c],e[c]=x}d[c]=f[c]}return i&&(k=!k),m=a+l,!0}null!==t&&t.call(b);for(var y=0,z=p.length;z>y;y++)p[y].start(a);return!1}return!0}},c.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-c.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*c.Easing.Bounce.In(2*a):.5*c.Easing.Bounce.Out(2*a-1)+.5}}},c.Interpolation={Linear:function(a,b){var d=a.length-1,e=d*b,f=Math.floor(e),g=c.Interpolation.Utils.Linear;return 0>b?g(a[0],a[1],e):b>1?g(a[d],a[d-1],d-e):g(a[f],a[f+1>d?d:f+1],e-f)},Bezier:function(a,b){var d,e=0,f=a.length-1,g=Math.pow,h=c.Interpolation.Utils.Bernstein;for(d=0;f>=d;d++)e+=g(1-b,f-d)*g(b,d)*a[d]*h(f,d);return e},CatmullRom:function(a,b){var d=a.length-1,e=d*b,f=Math.floor(e),g=c.Interpolation.Utils.CatmullRom;return a[0]===a[d]?(0>b&&(f=Math.floor(e=d*(1+b))),g(a[(f-1+d)%d],a[f],a[(f+1)%d],a[(f+2)%d],e-f)):0>b?a[0]-(g(a[0],a[0],a[1],a[1],-e)-a[0]):b>1?a[d]-(g(a[d],a[d],a[d-1],a[d-1],e-d)-a[d]):g(a[f?f-1:0],a[f],a[f+1>d?d:f+1],a[f+2>d?d:f+2],e-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var d=c.Interpolation.Utils.Factorial;return d(a)/d(b)/d(a-b)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}}},b.exports=c},{}],76:[function(a,b){b.exports={name:"pac",title:"PAC",version:"0.0.1",author:"Psychonull",homepage:"http://",description:"Point & Click Game Engine",directories:{lib:"src",test:"test"},dependencies:{"browser-request":"~0.3.2","point-in-polygon":"0.0.0","tween.js":"~0.14.0"},devDependencies:{grunt:"~0.4.5","grunt-contrib-clean":"~0.6.0","grunt-contrib-watch":"~0.6.1","grunt-contrib-concat":"~0.5.0","grunt-contrib-jshint":"~0.10.0","grunt-contrib-uglify":"~0.6.0","grunt-browserify":"~3.2.1","grunt-mocha-phantomjs":"~0.6.0",chai:"~1.9.2","sinon-chai":"~2.6.0",sinon:"~1.10.3","class-extend":"~0.1.1",events:"~1.0.2",gameloop:"~0.3.1","pixi.js":"~2.0.0",point2js:"0.0.1",lodash:"~2.4.1","grunt-contrib-connect":"~0.8.0"},scripts:{test:"grunt test"},repository:{type:"git",url:"git://github.com/psychonull/pac.git"},bugs:{url:"git://github.com/psychonull/pac/issues"},browser:{request:"browser-request"}}},{}],77:[function(a,b){var c=a("./Emitter");b.exports=c.extend({name:"Action",isFinished:!1,isBlocking:!1,actions:null,requires:null,resolve:function(){if(this.requires&&this.requires.length>0){var a=!1;return this.requires.forEach(function(b){this.actions.has(b)||(this.insertInFrontOfMe(new b),a=!0)},this),!a}return!0},init:function(){},onStart:function(){},onEnd:function(){},update:function(){throw new Error("Must override action.update()")},insertInFrontOfMe:function(a){this.actions.insertBefore(a,this)},insertBehindMe:function(a){this.actions.insertAfter(a,this)}})},{"./Emitter":87}],78:[function(a,b){var c=a("./List"),d=a("./Action"),e=b.exports=c.extend({childType:d,init:function(){e.__super__.init.apply(this,arguments),this.on("add",this._attachListToAction.bind(this)),this.each(this._attachListToAction.bind(this))},_attachListToAction:function(a){a.actions=this,a.started=!1},pushFront:function(a){return this.insertAt(0,a),this},pushBack:function(a){return this.add(a),this},insertBefore:function(a,b){var c=this.indexOf(b);return c>-1&&this.insertAt(c,a),this},insertAfter:function(a,b){var c=this.indexOf(b);return c>-1&&this.insertAt(c+1,a),this},has:function(a){var b=!1;return this.each(function(c){return c instanceof a?(b=!0,!1):void 0}),b},removeAll:function(a){var b=[];return this.each(function(c){c instanceof a&&b.push(c)},this),b.forEach(function(a){this._endAction(a,!0)},this),this},update:function(a){var b=[];this.each(function(c){if(c){if(this._startAction(c),!c.started)return!1;if(c.update(a),c.isFinished&&(this._endAction(c,!1),b.push(c)),c.isBlocking)return!1}},this),b.forEach(function(a){this.remove(a)},this)},_startAction:function(a){!a.started&&a.resolve()&&(a.onStart(),a.started=!0)},_endAction:function(a,b){a.started&&a.onEnd(),b&&this.remove(a)}})},{"./Action":77,"./List":98}],79:[function(a,b){var c=a("./Emitter");b.exports=c.extend({times:0,frames:[],fps:60,init:function(a){this.times=a&&a.times||this.times,this.frames=a&&a.frames||this.frames||[],this.fps=a&&a.fps||this.fps||60,this.step=1/this.fps,this.isPaused=!1,this.isRunning=!1,this.runTimes=0,this.started=!1,this.frameIndex=0,this.frame=this.frames[this.frameIndex],this.reset()},reset:function(){this.accumulator=0,this.isPaused=!1,this.runTimes=0,this.frameIndex=0,this.frame=this.frames[this.frameIndex],this.isRunning=!1,this.started=!1},play:function(){return this.isPaused?void this.resume():(this.reset(),this.isRunning=!0,void this.emit("play"))},stop:function(){this.isPaused=!1,this.isRunning=!1,this.emit("stop")},pause:function(){this.isPaused=!0,this.isRunning=!1,this.emit("pause")},resume:function(){return this.isPaused?(this.isPaused=!1,this.isRunning=!0,void this.emit("resume")):void this.start()},update:function(a){if(this.isRunning&&!this.isPaused){if(!this.started)return this.started=!0,void this.emit("start");for(this.accumulator+=a;this.accumulator>=this.step;)this._moveFrame(),this.accumulator-=this.step}},_moveFrame:function(){this.frameIndex++,this.frameIndex>this.frames.length-1&&(this.frameIndex=0),this.frame=this.frames[this.frameIndex],this.emit("frame",this.frame,this.frameIndex),this.frameIndex===this.frames.length-1&&(this.runTimes++,this.times>0&&this.runTimes===this.times&&(this.stop(),this.emit("end")))}})},{"./Emitter":87}],80:[function(a,b){var c=a("./MapList"),d=a("./Animation"),e=b.exports=c.extend({childType:d,"default":null,autoplay:null,current:null,init:function(a,b){e.__super__.init.apply(this,arguments),this.on("add",this._initAnimation.bind(this)),this.each(this._initAnimation.bind(this)),this.default=b&&b.default||this.default,this.autoplay=b&&b.autoplay||this.autoplay,this.current=null,this.default&&(this._setDefault(),this.autoplay&&this.play())},_initAnimation:function(a,b){a._name=b,a.on("end",this._playDefault.bind(this))},_playDefault:function(){this.default&&(this._setDefault(),this.play())},_setDefault:function(){var a=this.current;if(!a||a&&a._name!==this.default){var b=this.get(this.default);b&&(this.current=b)}},play:function(a){if(!a||!this.current||a!==this.current._name){if(a){var b=this.get(a);if(!b)return;this.stop(),this.current=b}this.current&&!this.current.isRunning&&this.current.play()}},stop:function(){this.current&&this.current.stop()},pause:function(){this.current&&this.current.pause()},resume:function(){this.current&&this.current.resume()},update:function(a){this.current&&this.current.isRunning&&this.current.update(a)}})},{"./Animation":79,"./MapList":100}],81:[function(a,b){var c=a("./Emitter");b.exports=c.extend({url:null,loaded:!1,error:null,init:function(a){"string"==typeof a?this.url=a:"object"==typeof a&&(this.url=a.url||a.path)},load:function(){throw new Error("load: not implemented")},raw:function(){throw new Error('raw: not implemented. Expected to return the "usable" asset')},onload:function(){this.loaded=!0,this.emit("load")},onerror:function(a){this.loaded=!1,this.error=a||!0,this.emit("error",a)}})},{"./Emitter":87}],82:[function(a,b){var c=a("./ClassExtend"),d=a("./utils");b.exports=c.extend({cid:null,constructor:function(){this.cid=d.uniqueId(),this.init&&this.init.apply(this,arguments)},init:function(){}})},{"./ClassExtend":86,"./utils":142}],83:[function(a,b){var c=a("./Asset"),d=a("./JsonFile"),e=a("./Texture"),f=a("./utils");b.exports=c.extend({textureAsset:null,definitionAsset:null,init:function(a){if(this.constructor.__super__.init.call(this,a),"object"!=typeof a)throw new Error("Missing options");if(!a.texture)throw new Error("Missing texture");if(!a.definition)throw new Error("Missing definition");this.textureAsset=new e(a.texture),this.definitionAsset=new d(a.definition),this.textureAsset.on("error",f.bind(this.onerror,this)),this.definitionAsset.on("error",f.bind(this.onerror,this)),this.textureAsset.on("load",f.bind(this._oneLoaded,this)),this.definitionAsset.on("load",f.bind(this._oneLoaded,this))},_oneLoaded:function(){this.textureAsset.loaded&&this.definitionAsset.loaded&&this.onload()},load:function(){this.textureAsset.load(),this.definitionAsset.load()},raw:function(){return{texture:this.textureAsset.raw(),definition:this.definitionAsset.raw()}}})},{"./Asset":81,"./JsonFile":94,"./Texture":114,"./utils":142}],84:[function(a,b){var c=a("./Emitter"),d=a("./utils"),e=c.extend({length:0,_validation:function(){return!0},childType:null,init:function(a,b){this._data={};var c=function(){this.length=d.keys(this._data).length};this.on("add",d.bind(c,this)),this.on("remove",d.bind(c,this)),this._groups={length:0},b&&b.validation&&this.setValidation(b.validation),b&&b.groups&&d.forEach(b.groups,d.bind(function(a){this.addGroup(a)},this)),a&&this._initData(a)},_initData:function(a){d.forIn(a,d.bind(function(a,b){this._add(b,a)},this))},add:function(){var a=arguments[0];return 1===arguments.length?Array.isArray(a)?(a.forEach(function(a){this._add(a.cid,a)},this),this):(this._add(a.cid,a),this):(this._add(a,arguments[1]),this)},_add:function(a,b){if(this.childType&&!(b instanceof this.childType))throw new Error("Error on Add: invalid child type of: "+a);if(null!==this.get(a))throw new Error("Cache duplicate key: "+a);this.validate(b),this._data[a]=b,this.emit("add",a,b)},get:function(a){if(0===arguments.length)return this._data;var b=this._data[a];return"undefined"==typeof b?null:b},remove:function(a){var b=this.get(a);return null!==b&&delete this._data[a],this.emit("remove",a,b),b},hasKey:function(a){return null!==this.get(a)},validate:function(a){var b=this._validation.call(this,a);if(b===!1)throw new Error("validation error");if("string"==typeof b)throw new Error("validation error: "+b);return b},setValidation:function(a){if("function"!=typeof a)throw new Error("Invalid Argument: validationFn must be a function");this._validation=a},addGroup:function(a,b,c){var d=new e(b,c);return 0===this._groups.length&&(this._groups=new e),this._groups.add(a,d),d},getGroup:function(a){return 0===this._groups.length&&(this._groups=new e),0===arguments.length?this._groups.get():this._groups.get(a)},hasGroup:function(a){return null!==this.getGroup(a)},values:function(){return d.values(this._data)},each:function(a,b){return d.forIn(this._data,a,b),this}});b.exports=e},{"./Emitter":87,"./utils":142}],85:[function(a,b){var c=a("./Shape"),d=a("./Rectangle"),e=a("./Point");b.exports=c.extend({name:"Circle",radius:50,constructor:function(a){this.radius=a&&a.radius||this.radius,c.apply(this,arguments)},isPointInside:function(a,b){var c=this.position;return b&&(c=c.add(b)),a.subtract(c).length()<=this.radius},nearestPoint:function(a,b){var c=this.position;b&&(c=c.add(b));var d=a.subtract(c).normalize(this.radius);return d.add(c)},getBounds:function(a){var b=this.position,c=this.radius;return a&&(b=b.add(a)),new d({position:new e(b.x-c,b.y-c),size:{width:2*c,height:2*c}})}})},{"./Point":104,"./Rectangle":106,"./Shape":110}],86:[function(a,b){b.exports=a("class-extend")},{"class-extend":67}],87:[function(a,b){var c=a("./Base"),d=a("events").EventEmitter,e=b.exports=c.extend({constructor:function(){d.call(this),e.__super__.constructor.apply(this,arguments),this.setMaxListeners(100)},init:function(){}});e.prototype=Object.create(d.prototype)},{"./Base":82,events:1}],88:[function(a,b){var c=a("./Emitter");b.exports=c.extend({init:function(){}})},{"./Emitter":87}],89:[function(a,b){var c=a("./ClassExtend"),d=a("gameloop"),e=a("./GameObjectList"),f=["renderer","loader","input","scenes"],g={Renderer:a("./Renderer"),Loader:a("./Loader"),Scenes:a("./Scenes"),Inputs:a("./InputManager")};d.extend=c.extend;var h=b.exports=d.extend({constructor:function(){h.__super__.constructor.apply(this,arguments),this.renderer=null,this.loader=null,this.inputs=null,this.scenes=null,this.objects=new e,this.objects.on("add",this._onAddObject.bind(this)),this.objects.on("remove",this._onRemoveObject.bind(this)),this.assetsLoaded=!1,this.loadingScene=!1},use:function(a,b,c){switch(this._validateComponent(a,b),a){case"renderer":this._attachRenderer(b,c);break;case"loader":this._attachLoader(b,c);break;case"input":this._attachInputs(b,c);break;case"scenes":this._attachScenes(b,c)}return this},_validateComponent:function(a,b){if(-1===f.indexOf(a))throw new Error('The type "'+a+'" is not allowed.');if(!b)throw new Error('Expected a "'+a+'" Component.')},_attachRenderer:function(a,b){var c=new a(this,b);if(!(c instanceof g.Renderer))throw new Error('Type of "renderer" must inherit from pac.Renderer');this.renderer=c},_attachLoader:function(a,b){var c=new a(this,b);if(!(c instanceof g.Loader))throw new Error('Type of "loader" must inherit from pac.Loader');this.loader=c},_attachInputs:function(a,b){if(!this.renderer)throw new Error("Renderer must be defined before inputs");if(!this.renderer.viewport)throw new Error("Renderer must define a [viewport] property to attach events");b=b||{},b.container=this.renderer.viewport,b.layers=this.renderer.layers,this.inputs=g.Inputs.create(a,b)},_attachScenes:function(a,b){if(!this.renderer)throw new Error("Renderer must be defined before Scenes");b=b||{},b.size=b.size||this.renderer.size,b.game=this,this.scenes=new g.Scenes(a,b),this.scenes.on("exit",this.onExitScene.bind(this)).on("enter",this.onEnterScene.bind(this)).on("addObject",this.onSceneAddObject.bind(this)).on("removeObject",this.onSceneRemoveObject.bind(this))},start:function(a){if(!a)throw new Error("expected an scene to start with game.start('scene-name');");if(!this.scenes)throw new Error("must define scenes. game.use('scenes', scenes);");this.emit("ready"),this.loadScene(a),h.__super__.start.call(this)},pause:function(){h.__super__.pause.call(this)},resume:function(){this.paused&&(h.__super__.start.call(this),this.emit("resume"))},end:function(){h.__super__.end.call(this)},update:function(a){this.loadingScene&&this._switchScene(),this.inputs&&this.inputs.update(a),this.objects.update(a),this.scenes.update(a),this.renderer.stage.update(a),this.emit("update",a)},_switchScene:function(){this.scenes.switch(this.loadingScene),this.loadingScene=null,this.objects.each(function(a){a.onEnterScene()})},draw:function(){this.renderer.render(),this.emit("draw")},loadScene:function(a){this.loadingScene=a},getScene:function(){return this.scenes.current},onExitScene:function(){this.renderer.clearBackTexture(),this.renderer.stage.clearLayer()},onEnterScene:function(a){a.texture&&this.renderer.setBackTexture(a.texture),this.renderer.stage.addObjects(this.objects).addObjects(a.objects).ready()},onSceneAddObject:function(a){this.renderer.stage.addObjects(a)},onSceneRemoveObject:function(a){this.renderer.stage.removeObject(a)},addObject:function(a){return this.objects.add(a),this},removeObject:function(a){return this.objects.remove(a),this},_onAddObject:function(a){a.game=this,a.scene=null,this.renderer.stage.isReady&&this.renderer.stage.addObjects(a)},_onRemoveObject:function(a){a.game=null,a.scene=null,this.renderer.stage.isReady&&this.renderer.stage.removeObject(a)},findOne:function(a){var b=this.objects.findOne(a);return!b&&this.scenes&&this.scenes.current?this.scenes.current.findOne(a):b},find:function(a){var b,c=this.objects.find(a);return this.scenes&&this.scenes.current&&(b=this.scenes.current.find(a)),b&&b.length>0&&c.add(b),c}},{create:function(a){return new h(a)}})},{"./ClassExtend":86,"./GameObjectList":91,"./InputManager":93,"./Loader":99,"./Renderer":107,"./Scenes":109,gameloop:69}],90:[function(a,b){{var c=a("./Emitter"),d=a("./ActionList"),e=a("./GameObjectList"),f=a("./Point");b.exports=c.extend({name:"GameObject",position:null,layer:null,zIndex:0,shape:null,active:!0,visible:!0,actions:null,children:null,parent:null,localPosition:null,constructor:function(a){this._initProperties(a),this._initActions(a),this.children=new e,this.children.on("add",this._initChild.bind(this)),c.apply(this,arguments)},_initProperties:function(a){function b(b){this[b]=a&&a[b]||this[b]}this.name=a&&a.name||this.name,this.position=a&&a.position||this.position||new f,this.position=new f(this.position);var c=["layer","zIndex","shape"];c.forEach(b.bind(this)),this.active=a&&a.active===!1?!1:this.active,this.visible=a&&a.visible===!1?!1:this.visible},_initActions:function(a){this.actions=a&&a.actions||this.actions,this.actions&&(Array.isArray(this.actions)&&(this.actions=new d(this.actions)),this.actions.owner=this)},_initChild:function(a){a.parent=this,a.localPosition=a.position,a.position=this.position.add(a.position),a.game=this.game,a.scene=this.scene},init:function(){},update:function(){},updateHierarchy:function(a){this.parent&&(this.position=this.parent.position.add(this.localPosition),this.game=this.parent.game,this.scene=this.parent.scene),this.children&&this.children.update(a)},updateActions:function(a){this.actions&&this.actions.update(a)},onEnterScene:function(){}})}},{"./ActionList":78,"./Emitter":87,"./GameObjectList":91,"./Point":104}],91:[function(a,b){var c=a("./List"),d=b.exports=c.extend({init:function(){this.childType=a("./GameObject"),d.__super__.init.apply(this,arguments)},update:function(a){this.each(function(b){if(b){if(b.game&&b.game.loadingScene)return!1;b.updateHierarchy&&b.updateHierarchy(a),b.updateActions(a),b.update(a),b.updateAnimations&&b.updateAnimations(a)}})}})},{"./GameObject":90,"./List":98}],92:[function(a,b){var c=a("./Emitter");b.exports=c.extend({container:null,scale:1,constructor:function(a){this.container=window&&window.document||null,this.enabled=!1,a&&(this.container=a.container||this.container,this.enabled=a.enabled||this.enabled,this.scale=a.scale||this.scale),c.apply(this,arguments)},init:function(){},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},{events:{MOVE:"cursor:move",DOWN:"cursor:down",UP:"cursor:up",KEYDOWN:"key:down",KEYUP:"key:up"}})},{"./Emitter":87}],93:[function(a,b){var c=a("./MapList"),d=a("./Input"),e=a("./MouseInput"),f=a("./KeyboardInput"),g=a("./Point"),h=a("./Stage"),i=b.exports=c.extend({childType:d,init:function(a,b){i.__super__.init.apply(this,arguments),this.cursor={position:new g,isDown:!1},this._down=!1,this.prevDown=!1,this._up=!1,this.deadClick=!1,this.on("add",this._attachEvents.bind(this)),this.each(this._attachEvents.bind(this)),this._initStages(b&&b.layers||[])},_initStages:function(a){this.clickStage=h.create(a),this.hoverStage=h.create(a)},_attachEvents:function(a){var b=this;a.on(d.events.MOVE,function(a){b.cursor.position=a}).on(d.events.DOWN,function(){b._down=!0,b._up=!1}).on(d.events.UP,function(){b._up=!0,b._down=!1})},update:function(){this.cursor.isDown=this._down,this.clearClick&&(this._clearClicked(),this.clearClick=!1,this.deadClick=!1),this.prevDown&&(this._setClicked(),this.clearClick=!0),this.prevDown=this.prevDown&&this.cursor.isDown?this.cursor.isDown=this._down=!1:this.cursor.isDown,this._up&&(this.cursor.isDown=!1,this._up=!1)},enable:function(){this.each(function(a){a.enable()})},disable:function(){this.each(function(a){a.disable()})},_setClicked:function(){var a=this.clickStage.getFrontObject();a?(a.isClicked=!0,this.lastClicked=a):this.deadClick=!0},_clearClicked:function(){this.lastClicked&&(this.lastClicked.isClicked=!1,this.lastClicked=null),this.clickStage.clearLayer()},register:function(a,b){switch(a){case"click":this.clickStage.addObjects(b);break;case"hover":this.hoverStage.addObjects(b)}}},{create:function(a,b){var c={};return a&&(Array.isArray(a)||(a=[a]),a.forEach(function(a){var d=new a(b);d instanceof e&&(c.mouse=d),d instanceof f&&(c.keyboard=d)})),new i(c,b)}})},{"./Input":92,"./KeyboardInput":95,"./MapList":100,"./MouseInput":101,"./Point":104,"./Stage":112}],94:[function(a,b){var c=a("./Asset"),d=a("request"),e=a("./utils");b.exports=c.extend({init:function(a){if(this.constructor.__super__.init.call(this,a),!this.url)throw new Error("Expected an URL");this._data=null},load:function(){d.get(this.url,e.bind(function(a,b,c){return a||2!==Math.floor(b.status/100)?this.onerror(a||{status:b.status,message:b.statusText}):(this._data=c,void this.onload())},this))},raw:function(){return this._data?JSON.parse(this._data):null}})},{"./Asset":81,"./utils":142,request:66}],95:[function(a,b){var c=a("./Input"),d=a("./utils"),e=a("./KeyboardMapping.js"),f=c.extend({init:function(a){if(!this.container)throw new Error("Expected a container");this._initKeys(a.keys),this._attachEvents()},_attachEvents:function(){this.events&&this._clearEvents(),this.events={keyup:this._onkeyup.bind(this),keydown:this._onkeydown.bind(this)},d.forIn(this.events,function(a,b){window.document.addEventListener(b,a)},this)},_clearEvents:function(){d.forIn(this.events,function(a,b){this.container.removeEventListener(b,a)},this)},_onkeyup:function(a){if(this.enabled&&e[a.keyCode]){var b=e[a.keyCode].toUpperCase();this.keys[b]&&(this.keys[b].isDown=!1,this.emit(c.events.KEYUP,b,a))}},_onkeydown:function(a){if(this.enabled&&e[a.keyCode]){var b=e[a.keyCode].toUpperCase();this.keys[b]&&(this.keys[b].isDown=!0,this.emit(c.events.KEYDOWN,b,a))}},_initKeys:function(a){var b;this.keys={},b=a?a:d(e).values().uniq().valueOf(),d.forEach(b,function(a){this.keys[a.toUpperCase()]={isDown:!1}},this)}});b.exports=f},{"./Input":92,"./KeyboardMapping.js":96,"./utils":142}],96:[function(a,b){for(var c=a("./utils.js"),d={},e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},f=1;20>f;++f)d[111+f]="f"+f;for(f=0;9>=f;++f)d[f+96]=f.toString();for(f=0;9>=f;++f)d[f+48]=f.toString();for(f=0;25>=f;++f)d[f+65]=String.fromCharCode(f+65);c.extend(d,e),b.exports=d},{"./utils.js":142}],97:[function(a,b){var c=a("./List"),d=a("./GameObject"),e=a("./utils"),f=b.exports=c.extend({childType:d,comparator:"zIndex",init:function(){f.__super__.init.apply(this,arguments),this.on("add",this._onAdd.bind(this)).on("remove",this._onRemove.bind(this)),this.zIndexByCID={}},update:function(){var a=[];this.each(function(b){this.zIndexByCID[b.cid]!==b.zIndex&&a.push(b)},this),a.length>0&&(this._sort(),e.forEach(a,function(a){this.zIndexByCID[a.cid]=a.zIndex,this.emit("change:zIndex",a)},this))},_onAdd:function(a){this.zIndexByCID[a.cid]=a.zIndex},_onRemove:function(a){delete this.zIndexByCID[a.cid]},clear:function(){this.zIndexByCID={},f.__super__.clear.apply(this,arguments)}})},{"./GameObject":90,"./List":98,"./utils":142}],98:[function(a,b){var c=a("./Emitter"),d=a("./utils"),e=b.exports=c.extend({childType:null,length:0,comparator:null,init:function(a,b){if(a&&!Array.isArray(a)&&!(a instanceof e))throw new Error("invalid argument, expected an array or List");this._items=[],this.length=0,this.comparator=b&&b.comparator||this.comparator,a instanceof e?a.each(this._set.bind(this)):a&&a.length>0&&a.forEach(this._set.bind(this))},at:function(a){return this._items[a]},indexOf:function(){var a=arguments[0],b=a;"object"==typeof a&&(b=a.cid);for(var c=0;c<this._items.length;c++)if(this._items[c].cid===b)return c;return-1},get:function(a){return"number"==typeof a?this.at(a):d.find(this._items,{cid:a})},add:function(){var a=arguments[0];return Array.isArray(a)?(a.forEach(this._set.bind(this)),this):a instanceof e?(a.each(this._set.bind(this)),this):(this._set(a),this)},insertAt:function(a,b){if(isNaN(a))throw new Error("expected an index");if(this._validate(b),this._exists(b))throw new Error("item already exists");this._items.splice(a,0,b),this.length++,this.emit("add",b)},_validate:function(a){if(this.childType&&!(a instanceof this.childType))throw new Error("invalid child type");a.hasOwnProperty("cid")||(a.cid=d.uniqueId())},_exists:function(a){return this.get(a.cid)?!0:!1},_sort:function(){var a=this.comparator;if(a&&(!a||"string"==typeof a)){var b=a.replace("-",""),c="-"===a[0]?-1:1;this._items.sort(function(a,d){var e=a[b],f=d[b];return f>e?-c:e>f?c:0})}},_set:function(a){this._validate(a),this._exists(a)||(this._items.push(a),this.length++,this._sort(),this.emit("add",a))},remove:function(){var a=arguments[0],b=a;"object"==typeof a&&(b=a.cid);var c=d.remove(this._items,function(a){return a.cid===b});return c.length>0&&(this.length-=c.length,this.emit("remove",c[0])),this},clear:function(){return this._items.length=0,this.length=0,this.emit("clear"),this},each:function(a,b){return d.forEach(this._items,a,b),this},find:function(a){"string"==typeof a&&(a={name:a});var b=d.filter(this._items,a);return new e(b)},findOne:function(a){return"string"==typeof a&&(a={name:a}),d.find(this._items,a)},last:function(){return d.last(this._items)}})},{"./Emitter":87,"./utils":142}],99:[function(a,b){var c=a("./EngineComponent"),d=a("./Cache"),e=a("./Texture"),f=a("./JsonFile"),g=a("./BitmapFont"),h=a("./utils"),i=c.extend({_resourcesToLoad:0,_resourcesLoaded:0,init:function(a,b){this.game=a,this.game.cache||(this.game.cache=new d),this._initResourceCollections(),this.addResources(b),this.on("complete",this.overwriteGameCache)},_initResourceCollections:function(){h.forEach(this.getResourceTypes(),h.bind(function(a){this[a]=new d},this))},getResourceTypes:function(){return h.keys(this.constructor.ResourceTypes)
},addResource:function(a,b){var c,d;if("string"==typeof b)c=this.constructor.ResolveFileType(b),d=b;else if("object"==typeof b){var e=b;if(c=e.type?e.type:this.constructor.ResolveFileType(e.path),d=h.cloneDeep(e),"images"===c&&e.atlas){var f=this.addResource(a,e.atlas);d.atlas=f}}return this._addResource(a,d,c)},_addResource:function(a,b,c){var d=this.constructor.ResourceTypes[c];if(!d)throw new Error("No type mapping for: "+c);var e=new d(b);return this[c].add(a,e),e},addResources:function(a){h.forIn(a,h.bind(function(a,b){this.addResource(b,a)},this))},getResources:function(){var a=this.getResourceTypes(),b=this;return h(a).map(function(a){return b[a].values()}).flatten().value()},load:function(){this.emit("start");var a=this,b=this.getResources();this._resourcesToLoad=b.length,h.forEach(b,function(b){b.on("load",function(){a._resourcesLoaded++;var b=a._resourcesLoaded/a._resourcesToLoad;b>=1?a.emit("complete"):a.emit("progress",b)}),b.load()})},overwriteGameCache:function(){h.forEach(this.getResourceTypes(),h.bind(function(a){var b=h.omit(this[a].get(),function(a){return a.loaded!==!0});this.game.cache[a]=new d(b)},this))}},{ResourceTypes:{images:e,json:f,bitmapFont:g},ResolveFileType:function(a){if(new RegExp(/^.+(\.png|\.jpg|\.jpeg)$/i).test(a))return"images";if(new RegExp(/^.+(\.json)$/i).test(a))return"json";throw new Error("File type not supported for "+a)}});b.exports=i},{"./BitmapFont":83,"./Cache":84,"./EngineComponent":88,"./JsonFile":94,"./Texture":114,"./utils":142}],100:[function(a,b){var c=a("./Emitter"),d=a("./utils");b.exports=c.extend({childType:null,length:0,init:function(a){this._data={};var b=function(){this.length=d.keys(this._data).length};this.on("add",d.bind(b,this)),this.on("remove",d.bind(b,this)),this.on("clear",d.bind(b,this)),a&&this.add(a)},get:function(a){var b=this._data[a];return"undefined"==typeof b?null:b},add:function(){var a=arguments[0];return"string"==typeof a?(this._set(arguments[1],a),this):(d.forIn(a,d.bind(this._set,this)),this)},_set:function(a,b){if(this.childType&&!(a instanceof this.childType))throw new Error("Error on Add: invalid child type of: "+b);if(null!==this.get(b))throw new Error("duplicate key: "+b);this._data[b]=a,this.emit("add",a,b)},remove:function(a){var b=this.get(a);return null!==b&&delete this._data[a],this.emit("remove",a,b),b},clear:function(){this._data={},this.emit("clear")},each:function(a,b){return d.forIn(this._data,a,b),this},hasKey:function(a){return null!==this.get(a)}})},{"./Emitter":87,"./utils":142}],101:[function(a,b){var c=a("./Input"),d=a("./utils"),e=a("./Point");b.exports=c.extend({init:function(){if(!this.container)throw new Error("Expected a container");this._attachEvents()},_attachEvents:function(){this.events&&this._clearEvents(),this.events={mouseup:this._onmouseup.bind(this),mousedown:this._onmousedown.bind(this),mousemove:this._onmousemove.bind(this)},d.forIn(this.events,function(a,b){this.container.addEventListener(b,a)},this)},_clearEvents:function(){d.forIn(this.events,function(a,b){this.container.removeEventListener(b,a)},this)},_onmouseup:function(a){if(this.enabled){var b=this._getEventPosition(a);this.emit(c.events.UP,b)}},_onmousedown:function(a){if(this.enabled){var b=this._getEventPosition(a);this.emit(c.events.DOWN,b)}},_onmousemove:function(a){var b=this._getEventPosition(a);this.emit(c.events.MOVE,b)},_getEventPosition:function(a){var b=0,c=0,d=document,f=d.body,g=d.documentElement,h=this.container,i=h.parentNode||f;return a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(b=a.clientX+f.scrollLeft+g.scrollLeft,c=a.clientY+f.scrollTop+g.scrollTop),b-=h.offsetLeft+i.offsetLeft,c-=h.offsetTop+i.offsetTop,b+=i.scrollLeft,c+=i.scrollTop,b=Math.round(b/this.scale),c=Math.round(c/this.scale),new e(b,c)}})},{"./Input":92,"./Point":104,"./utils":142}],102:[function(a,b){{var c=a("./Renderer"),d=a("./Sprite"),e=a("./Text"),f=a("./Point"),g=a("./Shape"),h=a("./Rectangle"),i=a("./Circle"),j=a("./Polygon"),k=a("./utils");b.exports=c.extend({size:{width:800,height:600},backgroundColor:"#000000",init:function(){var a=document.createElement("canvas");a.style.backgroundColor=this.backgroundColor,a.width=this.size.width,a.height=this.size.height,this.canvas=a,this.context=a.getContext("2d"),this.container.appendChild(this.canvas),this.viewport=this.canvas,this.layers||(this.layers=[]),this.layers.push("default"),this.backImage=null},setBackTexture:function(a){var b=this.game.cache.images;this.backImage=b.get(a).raw()},clearBackTexture:function(){this.backImage=null},onAddObject:function(a){this._createObject(a)},onRemoveObject:function(){},onZIndexChange:function(){},onLayerFill:function(a){this.stage.get(a).each(function(a){this._createObject(a)},this)},onLayerClear:function(){},_createObject:function(a){if(a instanceof d){var b=this.game.cache.images,c=b.get(a.texture);a.image=c.raw(),a.frames=c.frames}},render:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.backImage&&this.context.drawImage(this.backImage,0,0),this.layers.forEach(function(a){var b=this.stage.get(a);b.each(function(a){this._renderObject(a),this._drawDebug(a),a.children&&a.children.each(function(b){a.visible&&b.visible&&this._renderObject(b),this._drawDebug(b)},this)},this)},this)},_renderObject:function(a){a.visible&&(a instanceof d?this._renderSprite(a):a instanceof e?this._renderText(a):a instanceof g&&this._renderShape(a))},_renderSprite:function(a){if(null!==a.frame&&a.frames){var b=a.frames.get(a.frame);this.context.drawImage(a.image,b.x,b.y,b.width,b.height,a.position.x,a.position.y,a.size.width,a.size.height)}else this.context.drawImage(a.image,a.position.x,a.position.y,a.size.width,a.size.height)},_renderText:function(a){var b=this.context;b.textBaseline="top",b.font=a.font,b.fillStyle=a.fill,b.lineWidth=a.strokeThickness,b.strokeStyle=a.stroke,a.wordWrap?this._wrapTextAndDraw(a):(b.fillText(a.value,a.position.x,a.position.y),a.strikeThickness&&b.strokeText(a.value,a.position.x,a.position.y)),b.restore()},_renderShape:function(a){var b=this.context;b.beginPath(),this._drawShape(a),a.fill&&(b.fillStyle=a.fill,b.fill()),a.stroke&&(b.lineWidth=a.lineWidth||1,b.strokeStyle=a.stroke,b.stroke())},_drawShape:function(a,b){var c=this.context;b=b||new f;var d=a.position.add(b);if(a instanceof h)c.rect(d.x,d.y,a.size.width,a.size.height);else if(a instanceof i)c.arc(d.x,d.y,a.radius,0,2*Math.PI,!1);else{if(!(a instanceof j))return;k.forEach(a.points,function(a,b){var e=d.add(a);0===b?c.moveTo(e.x,e.y):c.lineTo(e.x,e.y)}),c.closePath()}},_wrapTextAndDraw:function(a){for(var b=a.value.split(" "),c="",d=a.position.x,e=a.position.y,f=0;f<b.length;f++){var g=c+b[f]+" ",h=this.context.measureText(g),i=h.width;i>a.wordWrap&&f>0?(this.context.fillText(c,d,e),c=b[f]+" ",e+=parseInt(a.font,10)+2):c=g}this.context.fillText(c,d,e),a.strikeThickness&&this.context.strokeText(a.value,a.position.x,a.position.y)},_drawDebug:function(a){if(pac.DEBUG&&a.shape){var b=this.context;b.beginPath(),this._drawShape(a.shape,a.position),b.fillStyle="rgba(0,255,0,0.4)",a.active||(b.fillStyle="rgba(255,0,0,0.4)"),b.fill()}}})}},{"./Circle":85,"./Point":104,"./Polygon":105,"./Rectangle":106,"./Renderer":107,"./Shape":110,"./Sprite":111,"./Text":113,"./utils":142}],103:[function(a,b){{var c=a("./Renderer"),d=a("./Sprite"),e=a("./Text"),f=a("./Shape"),g=a("./Rectangle"),h=a("./Circle"),i=a("./Polygon"),j=a("pixi.js"),k=a("./utils");b.exports=c.extend({size:{width:800,height:600},backgroundColor:"#000000",init:function(){j.scaleModes.DEFAULT=j.scaleModes.NEAREST;var a=this.backgroundColor.replace("#","0x");this.pixiStage=new j.Stage(a),this.pixiRenderer=j.autoDetectRenderer(this.size.width,this.size.height),this.pixiRenderer.resize(this.size.width*this.scale,this.size.height*this.scale),this.container.appendChild(this.pixiRenderer.view),this.viewport=this.pixiRenderer.view,this.pixiBack=new j.DisplayObjectContainer,this.pixiBack.scale.x=this.pixiBack.scale.y=this.scale,this.pixiStage.addChild(this.pixiBack),this._buildLayers()},setBackTexture:function(a){var b=this.game.cache.images,c=b.get(a).raw(),d=new j.BaseTexture(c),e=new j.Texture(d),f=new j.Sprite(e);this.pixiBack.addChild(f)},clearBackTexture:function(){this.pixiBack.removeChildren()},_createLayer:function(a){var b=new j.DisplayObjectContainer;this.pixiStage.addChild(b),b.scale.x=b.scale.y=this.scale,b.layer=a,this.pixiLayers[a]=b},_buildLayers:function(){this.pixiLayers={},this.layers&&this.layers.forEach(function(a){"default"!==a&&this._createLayer(a)},this),this._createLayer("default")},addChild:function(a,b,c){c>=0?b.addChildAt(a,c):b.addChild(a)},onAddObject:function(a,b){var c=this.stage.get(b).indexOf(a),d=this.pixiLayers[b];this._createPixiObject(a,d,c),this._createChildren(a,d)},onRemoveObject:function(a,b){var c=this.pixiLayers[b];this._clearPixiObjectChildren(a,c),this._removePixiObject(a,c)},onZIndexChange:function(a,b){var c=this.stage.get(b).indexOf(a),d=this.pixiLayers[b],e=this._getPixiObjectByCID(a.cid,d);d.setChildIndex(e,c)},onLayerFill:function(a){this.stage.get(a).each(function(b){var c=this.pixiLayers[a];this._createPixiObject(b,c),this._createChildren(b,c)},this)},onLayerClear:function(a){this.pixiStage&&this.pixiLayers[a]&&this.pixiLayers[a].removeChildren()},_createPixiObject:function(a,b,c){var g=this.game.cache.images;if(a instanceof d){var h=g.get(a.texture).raw(),i=new j.BaseTexture(h),k=new j.Texture(i),l=new j.Sprite(k);this._setSpriteProperties(a,l),l.cid=a.cid,this.addChild(l,b,c)}else if(a instanceof e){var m;m=a.isBitmapText?new j.BitmapText(a.value,a):new j.Text(a.value,a),this._setTextProperties(a,m),m.cid=a.cid,this.addChild(m,b,c)}else if(a instanceof f){var n=new j.Graphics;n.position.x=a.position.x,n.position.y=a.position.y;var o=this._createShape(a,n);o&&(this._setObjectProperties(a,o),o.cid=a.cid,this.addChild(o,b,c))}this._drawDebug(a,b,c)},_createChildren:function(a,b){a.children&&(a.children.each(function(a){this._createPixiObject(a,b)},this),a.children.on("add",k.bind(function(a){this._createPixiObject(a,b)},this)),a.children.on("remove",k.bind(function(a){this._removePixiObject(a,b)},this)),a.children.on("clear",k.bind(function(){},this)))},_removePixiObject:function(a,b){var c=this._getPixiObjectByCID(a.cid,b);if(c&&b.removeChild(c),pac.DEBUG&&a.shape){var d=this._getPixiObjectByCID(a.shape.cid,b);d&&b.removeChild(d)}},_clearPixiObjectChildren:function(a,b){var c=this;a.children&&a.children.each(function(a){c._removePixiObject(a,b)})},render:function(){this._updateProperties(),this.pixiRenderer.render(this.pixiStage)},_setSpriteProperties:function(a,b){var c=this.game.cache.images,d=c.get(a.texture).frames;if(null!==a.frame&&d){var e=d.get(a.frame);b.texture.setFrame(e)}b.anchor.x=0,b.anchor.y=0,b.position.x=a.position.x,b.position.y=a.position.y,b.width=a.size.width,b.height=a.size.height,b.visible=a.visible},_setTextProperties:function(a,b){b.position.x=a.position.x,b.position.y=a.position.y,b.setStyle({font:a.font,fill:a.fill,stroke:a.stroke,strokeThickness:a.strokeThickness,wordWrap:!!a.wordWrap,wordWrapWidth:a.wordWrap}),b.setText(a.isBitmapText&&a.wordWrap?this._wrapBitmapText(a):a.value),a.isBitmapText&&a.tint&&(b.tint=a.tint),b.visible=a.visible,a.wrapToScreen&&a.wordWrap&&(a.position.x+a.wordWrap>this.size.width?b.position.x=this.size.width-a.wordWrap:a.position.x<0&&(b.position=0))},_getPixiObjectByCID:function(a,b){return k.find(b.children,{cid:a})},_updateProperties:function(){this.stage.each(function(a,b){var c=this.pixiLayers[b];a.each(function(a){var b=this._getPixiObjectByCID(a.cid,c);b&&(this._setObjectProperties(a,b),this._drawDebug(a,c)),a.children&&a.children.each(function(d){b=this._getPixiObjectByCID(d.cid,c),b&&(this._setObjectProperties(d,b),b.visible=a.visible&&d.visible,this._drawDebug(d,c))},this)},this)},this)},_setObjectProperties:function(a,b){a&&(a instanceof d?this._setSpriteProperties(a,b):a instanceof e?this._setTextProperties(a,b):a instanceof f&&(b.position.x=a.position.x,b.position.y=a.position.y,b.alpha=a.alpha,this._createShape(a,b)),b.visible=a.visible)},_wrapBitmapText:function(a){var b=new j.BitmapText(a.value,a),c=a.wordWrap;if(b.textWidth<=c)return b.text;for(var d=b.text.split(" "),e=d[0],f=e,g=1;g<d.length;g++)e=f+" "+d[g],b=new j.BitmapText(e,a),b.textWidth>c&&(e=f+"\n"+d[g],b=new j.BitmapText(e,a)),f=e;return f=e},_createShape:function(a,b){return b.clear(),a.fill&&b.beginFill(a.fill.replace("#","0x")),a.stroke?b.lineStyle(a.lineWidth,a.stroke.replace("#","0x"),1):b.lineStyle(1,0,0),a instanceof g?b.drawRect(0,0,a.size.width,a.size.height):a instanceof h?b.drawCircle(0,0,a.radius):a instanceof i?b.drawPolygon(a.getPath()):null},onGameLoaderComplete:function(){var a=function(a,b){var c=0,d=0,e={};return e.font=a.info.face,e.size=a.info.size,e.lineHeight=a.common.lineHeight+d,e.chars={},k.forEach(a.chars,function(a){var d=a.id,f=new j.Rectangle(a.x,a.y,a.width,a.height);e.chars[d]={xOffset:a.xoffset,yOffset:a.yoffset,xAdvance:a.xadvance+c,kerning:{},texture:j.TextureCache[b]=new j.Texture(j.BaseTextureCache[b],f)}}),e};this.game.cache.bitmapFont.each(function(b,c){var d=b.raw();j.BaseTextureCache[c]=new j.BaseTexture(d.texture),j.TextureCache[c]=new j.Texture(j.BaseTextureCache[c]),j.BitmapText.fonts[c]=a(d.definition,c)},this)},_drawDebug:function(a,b,c){if(pac.DEBUG&&a.shape){var d=a.shape,e=this._getPixiObjectByCID(a.shape.cid,b);e||(e=new j.Graphics),e.alpha=.4,d.fill="#00ff00",a.active||(d.fill="#ff0000");var f=a.position.add(d.position);e.position.x=f.x,e.position.y=f.y;var g=this._createShape(d,e);g&&(g.cid=d.cid,this.addChild(g,b,c))}}})}},{"./Circle":85,"./Polygon":105,"./Rectangle":106,"./Renderer":107,"./Shape":110,"./Sprite":111,"./Text":113,"./utils":142,"pixi.js":72}],104:[function(a,b){var c=a("./ClassExtend"),d=a("point2js");d.extend=c.extend,b.exports=d.extend()},{"./ClassExtend":86,point2js:74}],105:[function(a,b){var c=a("./Shape"),d=a("./Point"),e=a("./utils"),f=a("point-in-polygon"),g=a("./Rectangle");b.exports=c.extend({name:"Polygon",constructor:function(a,b){this.points=[];var d=a||b&&b.points||[];c.call(this,b),this._initPoints(d)},_initPoints:function(a){if(!e.isArray(a))throw new Error("Invalid argument: "+a);if(a[0]instanceof d)this.points=a;else if("number"==typeof a[0])for(var b=0;b<a.length;b+=2){var c=new d(a[b],a[b+1]);this.points.push(c.add(this.position))}},isPointInside:function(a,b){var c=[a.x,a.y],g=new d;b&&(g=g.add(b));var h=e.map(this.points,function(a){var c=a.add(b);return[c.x,c.y]});return f(c,h)},getPath:function(){return e(this.points).map(function(a){return[a.x,a.y]}).flatten().valueOf()},isConcave:function(){for(var a=0,b=0,c=this.points.length,d=0;c>d;d++){var e=this.points[d],f=this.points[(d+1)%c],g=this.points[(d+2)%c],h=e.subtract(f),i=f.subtract(g),j=h.cross(i);0>j?b++:a++}return 0!==b&&0!==a},nearestPoint:function(a,b){var c=new d;b&&(c=c.add(b));for(var e,f=this.points.length,g=Number.POSITIVE_INFINITY,h=0;f>h;h++){var i=f-1>h?h+1:0,j=this._getClosestToSegment(a,c.add(this.points[h]),c.add(this.points[i])),k=a.subtract(j).length();g>k&&(g=k,e=j)}return e},getBounds:function(a){for(var b={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},c={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},e=0;e<this.points.length;e++){var f=this.points[e];f.x>b.x&&(b.x=f.x),f.x<c.x&&(c.x=f.x),f.y>b.y&&(b.y=f.y),f.y<c.y&&(c.y=f.y)}var h=new d(c.x,c.y);return a&&(h=h.add(a)),new g({position:h,size:{width:b.x-c.x,height:b.y-c.y}})},_getClosestToSegment:function(a,b,c){var e,f=a.subtract(b),g=c.subtract(b),h=f.dot(g)/g.dot(g);return e=0>h||b.x===c.x&&b.y===c.y?b:h>1?c:b.add(new d(g.x*h,g.y*h))}})},{"./Point":104,"./Rectangle":106,"./Shape":110,"./utils":142,"point-in-polygon":73}],106:[function(a,b){var c=a("./Shape"),d=a("./Point"),e=b.exports=c.extend({name:"Rectangle",size:{width:50,height:50},constructor:function(a){this.size=a&&a.size||this.size,c.apply(this,arguments)},isPointInside:function(a,b){var c=this.position;return b&&(c=c.add(b)),a.x>c.x&&a.x<c.x+this.size.width&&a.y>c.y&&a.y<c.y+this.size.height},nearestPoint:function(a,b){for(var c,d=this.getPoints(b),e=d.length,f=Number.POSITIVE_INFINITY,g=0;e>g;g++){var h=e-1>g?g+1:0,i=this._getClosestToSegment(a,d[g],d[h]),j=a.subtract(i).length();f>j&&(f=j,c=i)}return c},getPoints:function(a){var b=this.position,c=this.size;return a&&(b=b.add(a)),[new d(b),new d(b.x+c.width,b.y),new d(b.x+c.width,b.y+c.height),new d(b.x,b.y+c.height)]},getBounds:function(a){var b=this.position;return a&&(b=b.add(a)),new e({position:b,size:this.size})},getCenter:function(){var a=this.position,b=this.size;return new d(a.x+b.width/2,a.y+b.height/2)},getHead:function(){var a=this.position,b=this.size;return new d(a.x+b.width/2,a.y)},getFeet:function(){var a=this.position,b=this.size;return new d(a.x+b.width/2,a.y+b.height)},_getClosestToSegment:function(a,b,c){var e,f=a.subtract(b),g=c.subtract(b),h=f.dot(g)/g.dot(g);return e=0>h||b.x===c.x&&b.y===c.y?b:h>1?c:b.add(new d(g.x*h,g.y*h))}})},{"./Point":104,"./Shape":110}],107:[function(a,b){{var c=a("./EngineComponent"),d=a("./Stage"),e=(a("./Layer"),a("./utils"));b.exports=c.extend({size:{width:800,height:600},backgroundColor:"#000000",container:null,layers:null,scale:1,constructor:function(a,b){this.game=a,this.game&&this.game.loader&&this.game.loader.on("complete",this.onGameLoaderComplete.bind(this)),this.container=document.body,e.extend(this,e.pick(b,["size","backgroundColor","container","layers","scale"])),this._createStage(),c.apply(this,arguments)},_createStage:function(){this.stage=d.create(this.layers),this.stage.on("layerFill",this.onLayerFill.bind(this)).on("layerClear",this.onLayerClear.bind(this)).on("addToLayer",this.onAddObject.bind(this)).on("removeFromLayer",this.onRemoveObject.bind(this)).on("zIndexChanged",this.onZIndexChange.bind(this))},init:function(){},setBackTexture:function(){},clearBackTexture:function(){},onAddObject:function(){},onRemoveObject:function(){},onZIndexChange:function(){},onLayerFill:function(){throw new Error("Must override renderer.onLayerFill()")},onLayerClear:function(){throw new Error("Must override renderer.onLayerClear()")},render:function(){throw new Error("Must override renderer.render()")},onGameLoaderComplete:function(){}})}},{"./EngineComponent":88,"./Layer":97,"./Stage":112,"./utils":142}],108:[function(a,b){{var c=a("./Emitter"),d=(a("./GameObject"),a("./GameObjectList"));b.exports=c.extend({name:null,size:null,texture:null,objects:null,constructor:function(a){this.name=a&&a.name||this.name,this.size=a&&a.size||this.size,this.texture=a&&a.texture||this.texture,this.objects=new d,this.objects.on("add",this._initObject.bind(this)),this.objects.on("remove",this._clearObject.bind(this)),c.apply(this,arguments)},_initObject:function(a){a.game=this.game,a.scene=this,this.emit("addObject",a)},_clearObject:function(a){a.scene===this&&(a.scene=null),this.emit("removeObject",a)},addObject:function(a){return this.objects.add(a),this},removeObject:function(a){return this.objects.remove(a),this},findOne:function(a){return this.objects.findOne(a)},find:function(a){return this.objects.find(a)},clear:function(){this.objects.each(this._clearObject.bind(this)).clear()},_update:function(a){this.objects.update(a),this.update(a)},init:function(){},onEnter:function(){},onExit:function(){},update:function(){}})}},{"./Emitter":87,"./GameObject":90,"./GameObjectList":91}],109:[function(a,b){var c=a("./MapList"),d=a("./Scene"),e=b.exports=c.extend({current:null,childType:d,init:function(a,b){e.__super__.init.apply(this,arguments),this.game=b&&b.game||this.game,this.size=b&&b.size||this.size,this.on("add",this._initScene.bind(this)),this.each(this._initScene.bind(this)),this.eventAddObj=this._addObject.bind(this),this.eventRemoveObj=this._removeObject.bind(this)},_initScene:function(a,b){a.name=b,a.game=this.game,a.size||(a.size=this.size)},"switch":function(a){var b=this.get(a),c=this.current;if(!b)throw new Error('Scene not found: "'+a+'"');c&&(c.removeListener("addObject",this.eventAddObj).removeListener("removeObject",this.eventRemoveObj),c.onExit(b),this.emit("exit",c)),this.current=b,b.onEnter(c),this.emit("enter",b),c&&c.clear(),b.on("addObject",this.eventAddObj).on("removeObject",this.eventRemoveObj)},_addObject:function(a){this.emit("addObject",a)},_removeObject:function(a){this.emit("removeObject",a)},update:function(a){this.current&&this.current._update(a)}})},{"./MapList":100,"./Scene":108}],110:[function(a,b){var c=a("./GameObject");b.exports=c.extend({name:"Shape",fill:null,stroke:null,lineWidth:1,alpha:1,constructor:function(a){this.fill=a&&a.fill||this.fill,this.stroke=a&&a.stroke||this.stroke,this.lineWidth=a&&a.lineWidth||this.lineWidth,this.alpha=a&&a.alpha||this.alpha,c.apply(this,arguments)},isPointInside:function(){throw new Error("Must Implement Shape.isPointInside()")},nearestPoint:function(){throw new Error("Must Implement Shape.nearestPoint()")},getBounds:function(){throw new Error("Must Implement Shape.getBounds()")}})},{"./GameObject":90}],111:[function(a,b){{var c=a("./GameObject"),d=a("./Point"),e=a("./Rectangle");b.exports=c.extend({name:"Sprite",position:null,size:null,texture:null,frame:null,animations:null,shape:null,constructor:function(a){if(this.texture=a&&a.texture||this.texture,!this.texture)throw new Error("Expected [texture] name of Sprite");this.size=a&&a.size||this.size,this.frame=a&&a.frame||this.frame,this._createHitBox(a),this._initAnimations(a),c.apply(this,arguments)},_createHitBox:function(a){if(this.shape=a&&a.shape||this.shape,this.shape===!0){if(!this.size)throw new Error("Cannot create a shape for this Sprite without a size");this.shape=new e({position:new d,size:this.size}),a&&(a.shape=this.shape)}},_initAnimations:function(a){a&&a.animations&&(this.animations=a.animations,this.animations.owner=this)},init:function(){},update:function(){},updateAnimations:function(a){this.animations&&(this.animations.update(a),this.animations.current&&(this.frame=this.animations.current.frame))}})}},{"./GameObject":90,"./Point":104,"./Rectangle":106}],112:[function(a,b){var c=a("./MapList"),d=a("./Layer"),e=a("./GameObject"),f=a("./List"),g=a("./utils"),h=b.exports=c.extend({childType:d,length:0,init:function(a,b){h.__super__.init.apply(this,arguments),this.defaultName="default",this.hasKey(this.defaultName)||this._set(new d,this.defaultName),this.on("add",this._initLayer.bind(this)),this.each(this._initLayer.bind(this)),this.layers=b&&b.layers||[],0===this.layers.length&&this.each(function(a,b){this.layers.push(b)},this),this.isReady=!1},_initLayer:function(a,b){var c=this;a.on("add",function(a){!function(b){c.isReady&&c.emit("addToLayer",a,b)}(b)}),a.on("remove",function(a){!function(b){c.isReady&&c.emit("removeFromLayer",a,b)}(b)}),a.on("change:zIndex",function(a){!function(b){c.isReady&&c.emit("zIndexChanged",a,b)}(b)}),a.on("clear",function(){!function(a){c.emit("layerClear",a)}(b)})},_addToLayer:function(a){a instanceof e&&(a.layer&&this.hasKey(a.layer)?this.get(a.layer).add(a):this.get(this.defaultName).add(a))},ready:function(){return this.each(function(a,b){this.emit("layerFill",b)},this),this.isReady=!0,this},addObjects:function(){var a=arguments[0];return Array.isArray(a)?(a.forEach(this._addToLayer.bind(this)),this):a instanceof f?(a.each(this._addToLayer.bind(this)),this):(this._addToLayer(a),this)},removeObject:function(a){return a?(a.layer&&this.hasKey(a.layer)?this.get(a.layer).remove(a):this.get(this.defaultName).remove(a),this):void 0},clearLayer:function(a){if(a){var b=this.get(a);return b&&b.clear(),this}return this.isReady=!1,this.each(function(a){a.length>0&&a.clear()}),this},getFrontObject:function(){var a=null;return g.forEachRight(this.layers,function(b){return!a&&(a=this.get(b).last())?!1:void 0},this),a},update:function(a){this.isReady&&this.each(function(b){b.update(a)})}},{create:function(a){var b={};return a&&a.forEach(function(a){b[a]=new d}),new h(b)}})},{"./GameObject":90,"./Layer":97,"./List":98,"./MapList":100,"./utils":142}],113:[function(a,b){{var c=a("./GameObject"),d=(a("./Point"),a("./utils"));b.exports=c.extend({name:"Text",value:"",font:"20px Arial",fill:"black",stroke:"black",strokeThickness:0,wordWrap:0,isBitmapText:!1,wrapToScreen:!1,constructor:function(){var a=this._extractConstructorArgs(arguments);if(this.value=a.value||this.value,a.options){var b=["font","fill","stroke","strokeThickness","wordWrap","isBitmapText","tint","wrapToScreen"];d.extend(this,d.pick(a.options,b))}c.apply(this,[a.options])},_extractConstructorArgs:function(a){var b,c;return"string"==typeof a[0]?(b=a[0],c=a[1]):"object"==typeof a[0]&&(c=a[0],b=c.value),{value:b,options:c}},init:function(){},update:function(){}})}},{"./GameObject":90,"./Point":104,"./utils":142}],114:[function(a,b){var c=a("./Asset"),d=a("./List"),e=a("./MapList"),f=a("./JsonFile"),g=a("./utils");b.exports=c.extend({image:null,frames:null,atlas:null,_imageLoaded:!1,init:function(a){if(this.constructor.__super__.init.call(this,a),!this.url)throw new Error("Expected an URL, image object or a base64");this.image=new Image,this.image.onload=this.onload.bind(this),this.image.onerror=this.onerror.bind(this),a&&a.frames&&this.setFrames(a.frames),a&&a.atlas&&this.setAtlas(a.atlas)},setFrames:function(a){this.frames=g.isArray(a)?new d(a):new e(a)},setAtlas:function(a){if(!(a instanceof f))throw new Error("Invalid atlas type: "+a.constructor.name);this.atlas=a,this.atlas.loaded?(this.setFrames(this.atlas.raw().frames),this.loaded=this._imageLoaded):(this.loaded=!1,this.atlas.on("load",g.bind(function(){this.setFrames(this.atlas.raw().frames),this.loaded=this._imageLoaded,this.loaded&&this.emit("load")},this)))},onload:function(){this._imageLoaded=!0,(!this.atlas||this.atlas&&this.atlas.loaded)&&this.constructor.__super__.onload.call(this)},load:function(){this.image.src=this.url},raw:function(){return this.loaded?this.image:null}})},{"./Asset":81,"./JsonFile":94,"./List":98,"./MapList":100,"./utils":142}],115:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"Animate",init:function(){var a,b,c=arguments[0];if("object"==typeof c?(a=c.animationName,b=c.blocking):(a=c,b=arguments[1]),this.animationName=a,!this.animationName)throw new Error("Animate Action expected an animation name");this.isBlocking=b===!1&&!1||b===!0&&!0||this.isBlocking||!1},onStart:function(){var a=this.actions.owner;if(!a.animations)throw new Error("Animate Action requires [animations] on the Object");if(!a.animations.get(this.animationName))throw new Error("Animate Action animation ["+this.animationName+"] not found");this.startAnimation()},startAnimation:function(){var a=this.actions.owner;this.animation=a.animations.get(this.animationName),this.isBlocking?(this.__finishMe=this._finishMe.bind(this),this.animation.on("end",this.__finishMe)):this._finishMe(),a.animations.play(this.animationName)},_finishMe:function(){this.isFinished=!0,this.__finishMe&&this.animation.removeListener("end",this.__finishMe)},onEnd:function(){},update:function(){}})},{"../Action":77}],116:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"AutoZIndex",init:function(){var a,b,c,d=arguments[0];"object"==typeof d?(a=d.position,b=d.dynamic,c=d.baseZIndex):(b=d,a=arguments[1],c=arguments[2]),this.position=a||"feet",this.baseZIndex=c||0,this.dynamic=b===!1&&b||b===!0&&b||!1,this.isBlocking=!1},onStart:function(){var a=this.actions.owner;if("string"==typeof this.position){if(!a.shape)throw new Error("Action AutoZIndex: Expected a [position] or a [shape]");var b,c=a.shape.getBounds();switch(this.position){case"head":b=c.getHead();break;case"center":b=c.getCenter();break;case"feet":b=c.getFeet()}this.position=b}},onEnd:function(){},update:function(){var a=this.actions.owner,b=a.position,c=this.position.add(b);a.zIndex=c.y+this.baseZIndex,a.zIndex<0&&(a.zIndex=0),this.isFinished=!this.dynamic}})},{"../Action":77}],117:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"BaseCommand",init:function(a){if(this.command="string"==typeof a?a:a&&a.command||this.command,!this.command)throw new Error("Command Action: Expected a command");this.isBlocking=!0},onStart:function(){var a=this.actions.owner.game;if(this.commandBar=a.findOne("CommandBar"),!this.commandBar)throw new Error("A CommandBar was not found.");this.walkableArea=a.findOne("WalkableArea")},onEnd:function(){},update:function(){},hasCommand:function(){var a=this.actions.owner;return a.onCommand&&a.onCommand.hasOwnProperty(this.command)&&"function"==typeof a.onCommand[this.command]}})},{"../Action":77}],118:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"Clickable",init:function(){},onStart:function(){if(!this.actions.owner.shape)throw new Error("Clickable Action requires a [shape] on the Object")},onEnd:function(){},update:function(){var a=this.actions.owner,b=a.game.inputs,c=b.cursor;return a.isClicked?void a.emit("click"):void(a.active&&c.isDown&&a.shape.isPointInside(c.position,a.position)&&b.register("click",a))}})},{"../Action":77}],119:[function(a,b){var c=a("./BaseCommand"),d=b.exports=c.extend({name:"Command",init:function(){d.__super__.init.apply(this,arguments)},onStart:function(){d.__super__.onStart.apply(this,arguments)},onEnd:function(){},update:function(){var b=this.actions.owner,c=this.command;if(this.hasCommand()){var d,e=this.commandBar.inventory;e&&e.current?(d=b.onCommand[c].call(b,e.current),e.current=null):d=b.onCommand[c].call(b),d&&this.commandBar.showCannotMessage(b,d)}else this.commandBar.showCannotMessage(b);b instanceof a("../prefabs/WalkableArea")||this.commandBar.resetCommand(),this.isFinished=!0}})},{"../prefabs/WalkableArea":140,"./BaseCommand":117}],120:[function(a,b){var c=a("../Action"),d=a("./Hoverable"),e=a("./Clickable"),f=a("./Command"),g=a("./InventoryCommand"),h=a("./WalkerCommand");b.exports=c.extend({requires:[d,e],name:"Commander",init:function(a){this.nearness="number"==typeof a?a:a&&a.nearness||this.nearness||30},onStart:function(){var a=this.actions.owner.game;if(this.commandBar=a.findOne("CommandBar"),!this.commandBar)throw new Error("A CommandBar was not found.");this.walkableArea=a.findOne("WalkableArea"),this.hovering=!1},onEnd:function(){},update:function(){var a=this.actions.owner,b=this.commandBar.current;a.isHover&&!this.hovering&&(this.hovering=!0,this.commandBar.showHoverMessage(a)),a.isClicked&&this.onClick(a,b),!a.isHover&&this.hovering&&(this.hovering=!1,this.commandBar.hideHoverMessage(a))},onClick:function(b,c){return b.isInInventory?void this.actions.pushFront(new g(c)):void(!this.walkableArea||b instanceof a("../prefabs/WalkableArea")?this.actions.pushFront(new f(c)):(this.walkableArea.moveWalkersToObject(b,this.nearness),this._runCommand(b,c)&&this.actions.pushFront(new h(c))))},_runCommand:function(a,b){var c=!0;return this.isWalkableCommand(b)&&(c=this.hasCommand(a,b)),c},isWalkableCommand:function(a){return this.walkableArea.commands&&this.walkableArea.commands.indexOf(a)>-1},hasCommand:function(a,b){return a.onCommand&&a.onCommand.hasOwnProperty(b)&&"function"==typeof a.onCommand[b]}})},{"../Action":77,"../prefabs/WalkableArea":140,"./Clickable":118,"./Command":119,"./Hoverable":124,"./InventoryCommand":125,"./WalkerCommand":131}],121:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"Delay",init:function(a){this.isBlocking=!0,this.duration=a||2,this.elapsed=0},onStart:function(){this.elapsed=0},onEnd:function(){},update:function(a){this.elapsed+=a,this.elapsed>=this.duration&&(this.isFinished=!0)}})},{"../Action":77}],122:[function(a,b){var c=a("../Action"),d=a("../utils"),e=a("../prefabs/DialogueManager"),f=a("./Commander");b.exports=c.extend({name:"Dialoguer",requires:[f],options:null,command:"talkto",init:function(a){this.options=a||this.options,this.command=a&&a.command||this.command,this.isRunning=!1},onStart:function(){var a=this.actions.owner;this.options&&!this.options.dialogueOptionsBar&&(this.options.dialogueOptionsBar=a.game.findOne("DialogueOptionsBar")),a.dialogue=new e(this.options),a.onCommand||(a.onCommand={}),a.onCommand[this.command]=d.bind(this.onDialogueCommand,this),a.dialogue.on("end",d.bind(this.onDialogueEnd,this))
},onDialogueEnd:function(){this.isRunning=!1},onEnd:function(){var a=this.actions.owner;delete a.dialogue,delete a.onCommand[this.command]},update:function(){},onDialogueCommand:function(){this.isRunning||(this.actions.owner.dialogue.next(),this.isRunning=!0)}})},{"../Action":77,"../prefabs/DialogueManager":137,"../utils":142,"./Commander":120}],123:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"Execute",init:function(){var a,b=arguments[0];a="object"==typeof b?b.callback:b,this.callback=a,this.isBlocking=!1},onStart:function(){},onEnd:function(){},update:function(a){var b=this.actions.owner,c=this.callback.call(b,a,this);c===!0&&(this.isFinished=!0)}})},{"../Action":77}],124:[function(a,b){var c=a("../Action");b.exports=c.extend({name:"Hoverable",init:function(){},onStart:function(){if(this.isHover=!1,!this.actions.owner.shape)throw new Error("Hoverable Action requires a [shape] on the Object")},onEnd:function(){},update:function(){var a=this.actions.owner,b=a.game.inputs.cursor;return a.isHover=this.isHover,a.active?this.isHover?void(a.shape.isPointInside(b.position,a.position)||(this.isHover=!1,a.isHover=!1,a.emit("hover:out"))):void(a.shape.isPointInside(b.position,a.position)&&(this.isHover=!0,a.isHover=!0,a.emit("hover:in"))):(a.isHover=!1,void(this.isHover=!1))}})},{"../Action":77}],125:[function(a,b){var c=a("./BaseCommand"),d=a("./Command"),e=b.exports=c.extend({name:"InventoryCommand",init:function(){e.__super__.init.apply(this,arguments)},onStart:function(){e.__super__.onStart.apply(this,arguments)},onEnd:function(){},update:function(){var a=this.actions.owner,b=this.commandBar.inventory,c=this.commandBar.inventoryCommands;b&&!b.current&&c&&c.hasOwnProperty(this.command)?(b.current=a.name,this.commandBar.showHoverMessage(a)):this.insertBehindMe(new d(this.command)),this.isFinished=!0}})},{"./BaseCommand":117,"./Command":119}],126:[function(a,b){var c=a("../Action"),d=(a("../Point"),a("../Text"),a("./Speaker")),e=a("../utils");b.exports=c.extend({name:"Speak",requires:[d],text:"",duration:2,minDuration:1,after:null,init:function(a){e.extend(this,e.pick(a,["text","duration","minDuration","after","durationOffsetFn","wordWrapCorrectionFn"])),this.duration+=this.durationOffsetFn(this.text)},onStart:function(){this.elapsed=0;var a=this.actions.owner;a.speakerText.value=this.text,this.wordWrapCorrectionFn(a.speakerText)},onEnd:function(){var a=this.actions.owner;a.speakerText.value="",this.after&&this.after(this)},durationOffsetFn:function(){return 0},wordWrapCorrectionFn:function(){},update:function(a){this.elapsed+=a,(this.elapsed>=this.duration||this.actions.owner.game.inputs.cursor.isDown&&this.elapsed>this.minDuration)&&(this.isFinished=!0)}})},{"../Action":77,"../Point":104,"../Text":113,"../utils":142,"./Speaker":127}],127:[function(a,b){var c=a("../Action"),d=a("../Point"),e=a("../Text");b.exports=c.extend({name:"Speaker",textOptions:{},offset:new d,smartPosition:!0,init:function(a){this.textOptions=a&&a.textOptions||this.textOptions,this.offset=a&&a.offset||this.offset,a&&a.smartPosition===!1&&(this.smartPosition=!1)},onStart:function(){var a=this.actions.owner;a.speakerText=new e("",this.textOptions),a.speakerText.position=this.offset.clone(),a.children.add(a.speakerText),this.smartPosition&&this.fixTextPosition(a.speakerText,a.scene)},onEnd:function(){var a=this.actions.owner;a.children.remove(a.speakerText),delete a.speakerText},update:function(){},fixTextPosition:function(a,b){if(a.wordWrap)if(a.position.x+a.wordWrap>b.size.width)a.position.x=b.size.width-a.wordWrap;else{var c=this.actions.owner.position;a.position.x=Math.max(c.x-a.wordWrap/2,0)}}})},{"../Action":77,"../Point":104,"../Text":113}],128:[function(a,b){var c=a("../Action"),d=a("../utils"),e=a("tween.js");b.exports=c.extend({name:"Tween",field:null,to:null,duration:1,easing:"Linear.None",delay:0,repeat:0,yoyo:!1,init:function(){if(this._init.apply(this,arguments),!this.to||this.to&&0===d.keys(this.to).length)throw new Error("Tween Action: Expected [to] parameter");"string"==typeof this.easing&&(this.easing=this.getEasing(this.easing))},_init:function(){var a=arguments[0];if("object"==typeof a&&1===arguments.length)d.extend(this,d.pick(a||{},["field","to","duration","easing","delay","repeat","yoyo","isBlocking"]));else{var b=0;"string"==typeof a&&(this.field=a,b=1),this.to=arguments[b],this.duration=arguments[++b]||this.duration,this.easing=arguments[++b]||this.easing}},getEasing:function(a){var b=a.split(".");return e.Easing[b[0]][b[1]]},onStart:function(){var a=this.actions.owner;this.tweenedObj=a,this.field&&(this.tweenedObj=a[this.field]),this.tween=new e.Tween(this.tweenedObj).to(this.to,1e3*this.duration).easing(this.easing),this.configureTween();var b=this;this.tween.onComplete(function(){b.isFinished=!0}),this.tween.start(0),this.dtAccum=0},configureTween:function(){if(this.delay&&this.tween.delay(1e3*this.delay),this.repeat){var a=this.repeat===!0?1/0:this.repeat;this.tween.repeat(a)}this.yoyo&&(this.repeat||this.tween.repeat(1),this.tween.yoyo(!0))},onEnd:function(){e.remove(this.tween)},update:function(a){this.dtAccum+=a,this.tween.update(1e3*this.dtAccum)}})},{"../Action":77,"../utils":142,"tween.js":75}],129:[function(a,b){var c=a("../Action"),d=a("../Point");b.exports=c.extend({name:"WalkTo",init:function(a){if(this.target=a&&a.target,!this.target)throw new Error("expected a [target] to Walk To");this.velocity=a&&a.velocity||10,this.pivot=a&&a.pivot||new d,this.nearness=a&&a.nearness||1,this.isBlocking=!0},onStart:function(){var a=this.actions.owner;this.offset=a.position.add(this.pivot),this.dir=this.target.subtract(this.offset).normalize(),this.target.subtract(this.offset).length()>this.nearness&&(a.walkingTo=new d(this.dir)),a.targetReached=!1,a.emit("walk:start")},onEnd:function(){var a=this.actions.owner;a.walkingTo=null,a.emit("walk:stop",a.targetReached),a.targetReached=!1},update:function(a){var b=this.actions.owner;if(b.targetReached)return void(this.isFinished=!0);if(this.target.subtract(this.offset).length()<=this.nearness)return void(b.targetReached=!0);var c=this.velocity*a,d=new pac.Point(c*this.dir.x,c*this.dir.y);this.offset=this.offset.add(d),b.position=this.offset.subtract(this.pivot)}})},{"../Action":77,"../Point":104}],130:[function(a,b){var c=a("../Action"),d=a("../Point");b.exports=c.extend({name:"Walker",init:function(a){this.area=a&&a.area||"WalkableArea",this.velocity=a&&a.velocity||10,this.feet=a&&a.feet||null},onStart:function(){var a=this.actions.owner,b=a.game;return this.walkableArea=b.findOne(this.area),this.walkableArea?(this.feet||this._findFeet(a),a.velocity=this.velocity,a.feet=this.feet,void this.walkableArea.addWalker(a)):void(this.isFinished=!0)},_findFeet:function(a){return a.shape?void(this.feet=a.shape.getBounds().getFeet()):a.size?void(this.feet=new d(a.size.width/2,a.size.height)):void(this.feet=new d)},onEnd:function(){if(this.walkableArea){var a=this.actions.owner;this.walkableArea.removeWalker(a)}},update:function(){}})},{"../Action":77,"../Point":104}],131:[function(a,b){var c=a("./BaseCommand"),d=a("./Command"),e=b.exports=c.extend({name:"WalkerCommand",init:function(){e.__super__.init.apply(this,arguments)},onStart:function(){e.__super__.onStart.apply(this,arguments),this.walkableArea&&(this.walker=this.walkableArea.getWalker())},onEnd:function(){},update:function(){this.walker.targetReached&&this.insertBehindMe(new d(this.command)),this.walker.walkingTo||(this.isFinished=!0)}})},{"./BaseCommand":117,"./Command":119}],132:[function(a,b){b.exports={Delay:a("./Delay"),Animate:a("./Animate"),Execute:a("./Execute"),Tween:a("./Tween"),Clickable:a("./Clickable"),Hoverable:a("./Hoverable"),Command:a("./Command"),InventoryCommand:a("./InventoryCommand"),WalkerCommand:a("./WalkerCommand"),Commander:a("./Commander"),Walker:a("./Walker"),WalkTo:a("./WalkTo"),AutoZIndex:a("./AutoZIndex"),Speaker:a("./Speaker"),Speak:a("./Speak"),Dialoguer:a("./Dialoguer")}},{"./Animate":115,"./AutoZIndex":116,"./Clickable":118,"./Command":119,"./Commander":120,"./Delay":121,"./Dialoguer":122,"./Execute":123,"./Hoverable":124,"./InventoryCommand":125,"./Speak":126,"./Speaker":127,"./Tween":128,"./WalkTo":129,"./Walker":130,"./WalkerCommand":131}],133:[function(a,b){b.exports=function(b){b=b||{};var c=b.pac;return pac=a("./pac"),pac.VERSION=a("../package.json").version,pac.noConflict=function(){return b.pac=c,this},pac.DEBUG=!1,pac}(window)},{"../package.json":76,"./pac":134}],134:[function(a,b){b.exports={ClassExtend:a("./ClassExtend"),Base:a("./Base"),Emitter:a("./Emitter"),Scene:a("./Scene"),Stage:a("./Stage"),Renderer:a("./Renderer"),Loader:a("./Loader"),NativeRenderer:a("./NativeRenderer"),PixiRenderer:a("./PixiRenderer"),Point:a("./Point"),GameObject:a("./GameObject"),Sprite:a("./Sprite"),Text:a("./Text"),Shape:a("./Shape"),Rectangle:a("./Rectangle"),Circle:a("./Circle"),Polygon:a("./Polygon"),prefabs:a("./prefabs"),Texture:a("./Texture"),JsonFile:a("./JsonFile"),BitmapFont:a("./BitmapFont"),Game:a("./Game"),create:a("./Game").create,_:a("./utils"),List:a("./List"),MapList:a("./MapList"),ActionList:a("./ActionList"),Action:a("./Action"),actions:a("./actions"),AnimationList:a("./AnimationList"),Animation:a("./Animation"),Input:a("./Input"),MouseInput:a("./MouseInput"),KeyboardInput:a("./KeyboardInput")}},{"./Action":77,"./ActionList":78,"./Animation":79,"./AnimationList":80,"./Base":82,"./BitmapFont":83,"./Circle":85,"./ClassExtend":86,"./Emitter":87,"./Game":89,"./GameObject":90,"./Input":92,"./JsonFile":94,"./KeyboardInput":95,"./List":98,"./Loader":99,"./MapList":100,"./MouseInput":101,"./NativeRenderer":102,"./PixiRenderer":103,"./Point":104,"./Polygon":105,"./Rectangle":106,"./Renderer":107,"./Scene":108,"./Shape":110,"./Sprite":111,"./Stage":112,"./Text":113,"./Texture":114,"./actions":132,"./prefabs":141,"./utils":142}],135:[function(a,b){var c=a("../Text");b.exports=c.extend({constructor:function(a){this.command=a&&a.command||this.command,c.apply(this,arguments)}})},{"../Text":113}],136:[function(a,b){var c=a("../Rectangle"),d=(a("../GameObjectList"),a("../Point")),e=a("../utils"),f=a("../actions/Hoverable"),g=a("../actions/Clickable"),h=a("./Command"),i=a("../Text");b.exports=c.extend({name:"CommandBar",size:{width:100,height:100},cannotHolder:"Cannot {{action}} that",commands:{},current:null,inventory:null,inventoryCommands:{},messageBox:{},style:{},constructor:function(a){function b(b){this[b]=a&&a[b]||this[b]}var d=["style","cannotHolder","commands","messageBox","current","inventory","inventoryCommands"];d.forEach(b.bind(this)),this.default=this.current,c.apply(this,arguments),this._buildContainer()},_buildContainer:function(){this.messageBox=new i(e.clone(this.messageBox,!0)),this.children.add(this.messageBox),this.style.position||(this.style.position=new d),e.forIn(this.commands,function(a,b){var c=this._createCommand(a,b);this.children.add(c),b===this.current&&(this._current=c)},this)},_createCommand:function(a,b){var d=e.clone(this.style.text,!0)||{fill:"#000"};b===this.current&&(d=e.clone(this.style.active,!0)||{}),e.extend(d,{command:b,value:a,position:this._getPosition(b),shape:new c({size:this.style.size}),actions:[new f,new g]});var i=new h(d);return i.on("hover:in",this.onCommandHoverIn.bind(this,i)).on("hover:out",this.onCommandHoverOut.bind(this,i)).on("click",this.onCommandClick.bind(this,i)),i},_getPosition:function(a){for(var b=this.style.size,c=this.style.margin,e=this.style.grid,f=0,g=0,h=0;h<e.length;h++)for(var i=e[h],j=0;j<i.length;j++)if(i[j]===a){g=h,f=j;break}f=f*b.width+f*c.x+c.x,g=g*b.height+g*c.y+c.y;var k=this.style.position;return new d(f+k.x,g+k.y)},_setCommandStyle:function(a,b){e.forIn(b,function(b,c){a[c]=b})},onCommandHoverIn:function(a){this.current!==a.command&&this._setCommandStyle(a,this.style.hover)},onCommandHoverOut:function(a){this.current!==a.command&&this._setCommandStyle(a,this.style.text)},onCommandClick:function(a){var b=a.command;this.setCommand(b)&&this.emit("command",b)},setCommand:function(a){if(a!==this.current){var b=this.children.findOne({command:a});return b?(this._current&&this._setCommandStyle(this._current,this.style.text),this.current=a,this._current=b,this._setCommandStyle(b,this.style.active),this.resetBar(),!0):!1}},_getJoin:function(){if(this.inventory&&this.inventory.current){var a=this.inventoryCommands;return a[this.current]}return null},_isCommandDisabled:function(a){return a&&a.onCommand&&a.onCommand[this.current]===!1},_isCommandHidden:function(a){if(a&&a.hasOwnProperty("hiddenCommands")){if(a.hiddenCommands===!0)return!0;if(Array.isArray(a.hiddenCommands)&&a.hiddenCommands.indexOf(this.current)>-1)return!0}return!1},showHoverMessage:function(a){if(!this._isCommandDisabled(a)&&!this._isCommandHidden(a)){var b=this._current.value,c=a.name,d=(this.current,this._getJoin()),e=d?c+" "+d:c;d&&this.inventory&&this.inventory.current!==c&&(e=this.inventory.current+" "+d+" "+c),this.messageBox.value=b+" "+e,this.lastRequestOf=a.cid}},hideHoverMessage:function(a){this._isCommandDisabled(a)||this._isCommandHidden(a)||this._getJoin()||a&&this.lastRequestOf&&this.lastRequestOf!==a.cid||(this.messageBox.value="")},showCannotMessage:function(a,b){this._isCommandDisabled(a)||this._isCommandHidden(a)||(this.lastRequestOf=a&&a.cid||null,b||(b=this.cannotHolder.replace(/{{action}}/gi,this._current.value)),this.messageBox.value=b)},init:function(){},update:function(){this.game.inputs.deadClick&&(this.resetCommand(),this.resetBar())},resetCommand:function(){this.default&&this.setCommand(this.default)},resetBar:function(){this.inventory&&(this.inventory.current=null),this.lastRequestOf=null,this.hideHoverMessage()},onEnterScene:function(){this.resetCommand(),this.resetBar()}})},{"../GameObjectList":91,"../Point":104,"../Rectangle":106,"../Text":113,"../actions/Clickable":118,"../actions/Hoverable":124,"../utils":142,"./Command":135}],137:[function(a,b){var c=a("../Emitter"),d=a("../List"),e=a("../actions/Speak"),f=a("../utils"),g=c.extend({rootDialogue:null,characters:null,currentDialogue:null,currentIndex:-1,dialogueOptionsBar:null,speakClass:e,constructor:function(a){a&&this.setDialogue(a),c.apply(this,arguments)},setDialogue:function(a){if(!a.characters)throw new Error("No characters provided");if(!a.dialogue)throw new Error("No dialogue provided");if(!a.dialogueOptionsBar)throw new Error("No dialogueOptionsBar provided");this.rootDialogue=g.transformConfig(a.dialogue),this.currentDialogue=this.rootDialogue,this.characters=a.characters,this.dialogueOptionsBar=a.dialogueOptionsBar,this.currentIndex=-1,this.speakClass=a.speakClass||this.speakClass},say:function(a){var b=this.characters[a.owner];if(!b)throw new Error("Unknown dialogue owner");var c;c=a.random?f.sample(a.random):a.value,b.actions.pushBack(new this.speakClass({text:c,after:f.bind(this.next,this)}))},showOptions:function(a){var b=f.map(a.options._items,function(a){return f.pick(a,["code","value"])});this.dialogueOptionsBar.showOptions(b,f.bind(this.onOptionSelected,this))},next:function(){var a=this.currentDialogue.at(this.currentIndex);if(a&&a.options)throw new Error("Cannot call next when in options mode");this.currentIndex++;var b=this.currentDialogue.at(this.currentIndex);return b?void(b.options?this.showOptions(b):this.say(b)):(this.currentIndex--,void this.end())},onOptionSelected:function(a){var b=this.currentDialogue.at(this.currentIndex).options.findOne({code:a});if(!b)throw new Error("Invalid option");this.currentDialogue=b.dialogue||new d,this.currentIndex=-1,this.next()},end:function(){this.emit("end"),this.currentDialogue=this.rootDialogue,this.currentIndex=-1},get:function(a){var b=function(a,c){var d=a.findOne({code:c});return d||a.each(function(a){return a.options&&(a.options.each(function(a){return a.dialogue&&(d=b(a.dialogue,c))?!1:void 0}),d)?!1:void 0}),d};return b(this.rootDialogue,a)}},{transformConfig:function(a){var b=new d(a);return b.each(function(a){a.options&&(a.options=new d(a.options),a.options.each(function(a){a.dialogue&&(a.dialogue=g.transformConfig(a.dialogue))}))}),b}});b.exports=g},{"../Emitter":87,"../List":98,"../actions/Speak":126,"../utils":142}],138:[function(a,b){var c=a("../Rectangle"),d=a("../Point"),e=a("../utils"),f=a("../actions/Hoverable"),g=a("../actions/Clickable"),h=a("../Text");b.exports=c.extend({name:"DialogueOptionsBar",size:{width:100,height:100},style:{},optionSelectedCb:null,constructor:function(a){function b(b){this[b]=a&&a[b]||this[b]}var d=["style"];d.forEach(b.bind(this)),c.apply(this,arguments),this.active=!1,this.visible=!1},init:function(){},showOptions:function(a,b){e.forEach(a,function(a,b){var d=e.clone(this.style.text,!0)||{fill:"#000"};e.extend(d,{value:a.value,position:this._getOptionPosition(b),shape:new c({size:this.style.size}),actions:[new f,new g]});var i=new h(d);i.code=a.code,i.on("hover:in",this.onOptionHoverIn.bind(this,i)).on("hover:out",this.onOptionHoverOut.bind(this,i)).on("click",this.onOptionClick.bind(this,i)),this.children.add(i)},this),this.optionSelectedCb=b,this.active=!0,this.visible=!0},update:function(){},onEnterScene:function(){},_getOptionPosition:function(a){var b=this.style.margin&&this.style.margin.x||0,c=this.style.margin&&this.style.margin.y||0,e=c*(a+1)+this.style.size.height*a;return new d(b,e)},onOptionHoverIn:function(a){e.extend(a,this.style.hover)},onOptionHoverOut:function(a){e.extend(a,this.style.text)},onOptionClick:function(a){this.onOptionSelected(a.code)},onOptionSelected:function(a){this.active=!1,this.visible=!1,this.optionSelectedCb(a);var b=e.map(this.children._items,function(a){return{cid:a.cid}});e.forEach(b,function(a){this.children.remove(a)},this)}})},{"../Point":104,"../Rectangle":106,"../Text":113,"../actions/Clickable":118,"../actions/Hoverable":124,"../utils":142}],139:[function(a,b){{var c=a("../Rectangle"),d=a("../Point"),e=a("../utils");a("./Command"),a("../Text")}b.exports=c.extend({name:"Inventory",size:{width:100,height:100},commands:{},maxItems:8,style:{},constructor:function(a){function b(b){this[b]=a&&a[b]||this[b]}var d=["style","commands","maxItems"];d.forEach(b.bind(this)),this.current=null,c.apply(this,arguments),this._buildContainer()},_buildContainer:function(){this.style.position||(this.style.position=new d),e.times(this.maxItems,this._createItemHolder.bind(this))},_createItemHolder:function(a){var b=e.clone(this.style.holder,!0);e.extend(b,{position:this._getPosition(a),size:this.style.size}),this.children.add(new c(b))},_rePositionItems:function(){if(this.children.length>=this.maxItems)for(var a=this.maxItems;a<this.children.length;a++){var b=a-this.maxItems,c=this.children.at(a);c.localPosition=this._getPosition(b),c.position=this.position.add(c.localPosition)}},_getPosition:function(a){for(var b=this.style.size,c=this.style.margin,e=this.style.itemsPerRow,f=Math.floor(this.maxItems/e),g=0,h=0,i=0;f>i;i++)for(var j=0;e>j;j++)if(j+i*e===a){h=i,g=j;break}g=g*b.width+g*c.x+c.x,h=h*b.height+h*c.y+c.y;var k=this.style.position;return new d(g+k.x,h+k.y)},has:function(a){var b=this.children.findOne(a);return b&&!0||!1},add:function(a){var b=this.children.length-this.maxItems;a.position=this._getPosition(b),a.size=this.style.size,a.shape=new c({size:this.style.size}),a.isInInventory=!0,this.children.add(a)},remove:function(a){var b=this.children.findOne(a);b&&(b.isInInventory=!1,this.children.remove(b),this._rePositionItems())},init:function(){},update:function(){},onEnterScene:function(){this.current=null}})},{"../Point":104,"../Rectangle":106,"../Text":113,"../utils":142,"./Command":135}],140:[function(a,b){{var c=a("../GameObject"),d=a("../GameObjectList"),e=a("../actions/Clickable"),f=a("../actions/Commander"),g=a("../actions/WalkTo");a("../Point")}b.exports=c.extend({name:"WalkableArea",shape:null,commands:null,constructor:function(a){if(this.shape=a&&a.shape||this.shape,this.commands=a&&a.commands||this.commands,!this.shape)throw new Error("expected a shape");this._buildActions(),this.walkers=new d,c.apply(this,arguments)},_buildActions:function(){return this.commands&&this.commands.length>0?(this.actions=[new f],this.onCommand={},void this.commands.forEach(function(a){this.onCommand[a]=this._onAreaMove.bind(this)},this)):(this.actions=[new e],void this.on("click",this._onAreaMove.bind(this)))},_onAreaMove:function(){var a=this.game.inputs.cursor.position;this.moveWalkers(a)},moveWalkers:function(a,b){this.walkers.each(function(c){c.actions.removeAll(g),c.actions.pushFront(new g({target:a,velocity:c.velocity,pivot:c.feet,nearness:b||1}))})},moveWalkersToObject:function(a,b){var c=a.position;a.shape&&(c=a.shape.getBounds(c).getCenter()),this.shape.isPointInside(c,this.position)||(c=this.shape.nearestPoint(c,this.position)),this.moveWalkers(c,b)},addWalker:function(a){this.walkers.add(a)},removeWalker:function(a){this.walkers.remove(a)},clearWalkers:function(){this.walkers.clear()},getWalker:function(){return this.walkers.get(0)}})},{"../GameObject":90,"../GameObjectList":91,"../Point":104,"../actions/Clickable":118,"../actions/Commander":120,"../actions/WalkTo":129}],141:[function(a,b){b.exports={CommandBar:a("./CommandBar"),Inventory:a("./Inventory"),Command:a("./Command"),WalkableArea:a("./WalkableArea"),DialogueManager:a("./DialogueManager"),DialogueOptionsBar:a("./DialogueOptionsBar")}},{"./Command":135,"./CommandBar":136,"./DialogueManager":137,"./DialogueOptionsBar":138,"./Inventory":139,"./WalkableArea":140}],142:[function(a,b){b.exports=a("lodash")},{lodash:71}]},{},[36]);